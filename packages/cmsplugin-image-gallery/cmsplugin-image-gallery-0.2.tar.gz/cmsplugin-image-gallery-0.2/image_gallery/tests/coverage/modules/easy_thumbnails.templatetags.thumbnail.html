<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
    <title>Test coverage report: easy_thumbnails.templatetags.thumbnail</title>
    <style type="text/css" media="screen">
      a
      {
        color: #3d707a;
      }
      
      a:hover, a:active
      {
        color: #bf7d18;
      }
    
      body 
      {
        font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
        font-size: 13px;
      }
      
      .nav 
      {
        font-size: 12px;
        margin-left: 50px;
      }

      .ignored
      {
        color: #707070;
      }

      .executed 
      {
        color: #3d9900;
      }

      .missed 
      {
        color: red;
        font-weight: bold;
      }

      .excluded 
      {
        color: #6090f0;
        font-weight: lighter;
      }
    
      #content-header 
      {
        font-size: 12px;
        padding: 18px 0 18px 50px;
      }

      #content-header h1 
      {
        font-size: 16px;
        margin: 10px 0 0 0;
        color: #909090;
      }
      
      #module-name
      {
        color: #583707;
      }
    
      #content-header p
      {
        font-size: 13px;
        margin: 0;
        color: #909090;
      }

      #content-header .normal 
      {
        color: #609030;
      }

      #content-header .warning 
      {
        color: #d0a000;
      }

      #content-header .critical 
      {
        color: red;
      }
      
      #source-listing 
      {
        margin-bottom: 24px;
      }

      #source-listing ol 
      {
        padding: 0 0 0 50px;
        width: 90%;
        font-family: monospace;
        list-style-position: outside;
      }

      #source-listing ol li 
      {
        line-height: 18px;
        font-size: small;
      }
        
      #source-listing ol code 
      {
        padding:  0 .001em 0 0; /* Firefox doesn't render empty li's properly */
        font-size: medium;
        white-space: pre;
      }
   </style>
  </head>

  <body>

<div class="nav">
  <a href="easy_thumbnails.storage.html">easy_thumbnails.storage</a> &lt;&lt;
  <a href="../index.html">index</a>
  &gt;&gt; <a href="easy_thumbnails.test.html">easy_thumbnails.test</a>
</div>

<div id="content-header">
  <h1>
    <span id="module-name">easy_thumbnails.templatetags.thumbnail</span>:
    115 total statements,
    <span class="critical">0.0% covered</span>
  </h1>
  <p>Generated: Wed 2013-03-13 10:33 CET</p>
  <p>Source file: /media/Envs/Envs/filer-gallery/lib/python2.7/site-packages/easy_thumbnails/templatetags/thumbnail.py</p>
  <p>
    Stats:
    <span class="executed">0 executed</span>,
    <span class="missed">109 missed</span>,
    <span class="excluded">6 excluded</span>,
    <span class="ignored">152 ignored</span> 
  </p> 
</div>

<div id="source-listing">
  <ol>
    <li class="excluded"><code>import re</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>from django.template import Library, Node, VariableDoesNotExist, \</code></li>
<li class="ignored"><code>    TemplateSyntaxError</code></li>
<li class="excluded"><code>from django.utils.html import escape</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>from easy_thumbnails import utils</code></li>
<li class="excluded"><code>from easy_thumbnails.conf import settings</code></li>
<li class="excluded"><code>from easy_thumbnails.files import get_thumbnailer</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>register = Library()</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>RE_SIZE = re.compile(r'(\d+)x(\d+)$')</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>VALID_OPTIONS = utils.valid_processor_options()</code></li>
<li class="missed"><code>VALID_OPTIONS.remove('size')</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>def split_args(args):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Split a list of argument strings into a dictionary where each key is an</code></li>
<li class="ignored"><code>    argument name.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    An argument looks like ``crop``, ``crop="some option"`` or ``crop=my_var``.</code></li>
<li class="ignored"><code>    Arguments which provide no value get a value of ``True``.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="missed"><code>    args_dict = {}</code></li>
<li class="missed"><code>    for arg in args:</code></li>
<li class="missed"><code>        split_arg = arg.split('=', 1)</code></li>
<li class="missed"><code>        if len(split_arg) &gt; 1:</code></li>
<li class="missed"><code>            value = split_arg[1]</code></li>
<li class="ignored"><code>        else:</code></li>
<li class="missed"><code>            value = True</code></li>
<li class="missed"><code>        args_dict[split_arg[0]] = value</code></li>
<li class="missed"><code>    return args_dict</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class ThumbnailNode(Node):</code></li>
<li class="missed"><code>    def __init__(self, source_var, opts, context_name=None):</code></li>
<li class="missed"><code>        self.source_var = source_var</code></li>
<li class="missed"><code>        self.opts = opts</code></li>
<li class="missed"><code>        self.context_name = context_name</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def render(self, context):</code></li>
<li class="ignored"><code>        # Note that this isn't a global constant because we need to change the</code></li>
<li class="ignored"><code>        # value for tests.</code></li>
<li class="missed"><code>        raise_errors = settings.THUMBNAIL_DEBUG</code></li>
<li class="ignored"><code>        # Get the source file.</code></li>
<li class="missed"><code>        try:</code></li>
<li class="missed"><code>            source = self.source_var.resolve(context)</code></li>
<li class="missed"><code>        except VariableDoesNotExist:</code></li>
<li class="missed"><code>            if raise_errors:</code></li>
<li class="missed"><code>                raise VariableDoesNotExist("Variable '%s' does not exist." %</code></li>
<li class="ignored"><code>                        self.source_var)</code></li>
<li class="missed"><code>            return self.bail_out(context)</code></li>
<li class="missed"><code>        if not source:</code></li>
<li class="missed"><code>            if raise_errors:</code></li>
<li class="missed"><code>                raise TemplateSyntaxError(</code></li>
<li class="ignored"><code>                    "Variable '%s' is an invalid source." % self.source_var</code></li>
<li class="ignored"><code>                )</code></li>
<li class="missed"><code>            return self.bail_out(context)</code></li>
<li class="ignored"><code>        # Resolve the thumbnail option values.</code></li>
<li class="missed"><code>        try:</code></li>
<li class="missed"><code>            opts = {}</code></li>
<li class="missed"><code>            for key, value in self.opts.iteritems():</code></li>
<li class="missed"><code>                if hasattr(value, 'resolve'):</code></li>
<li class="missed"><code>                    value = value.resolve(context)</code></li>
<li class="missed"><code>                opts[str(key)] = value</code></li>
<li class="missed"><code>        except Exception:</code></li>
<li class="missed"><code>            if raise_errors:</code></li>
<li class="missed"><code>                raise</code></li>
<li class="missed"><code>            return self.bail_out(context)</code></li>
<li class="ignored"><code>        # Size variable can be either a tuple/list of two integers or a</code></li>
<li class="ignored"><code>        # valid string.</code></li>
<li class="missed"><code>        size = opts['size']</code></li>
<li class="missed"><code>        if isinstance(size, basestring):</code></li>
<li class="missed"><code>            m = RE_SIZE.match(size)</code></li>
<li class="missed"><code>            if m:</code></li>
<li class="missed"><code>                opts['size'] = (int(m.group(1)), int(m.group(2)))</code></li>
<li class="ignored"><code>            else:</code></li>
<li class="missed"><code>                if raise_errors:</code></li>
<li class="missed"><code>                    raise TemplateSyntaxError("%r is not a valid size." % size)</code></li>
<li class="missed"><code>                return self.bail_out(context)</code></li>
<li class="ignored"><code>        # Ensure the quality is an integer.</code></li>
<li class="missed"><code>        if 'quality' in opts:</code></li>
<li class="missed"><code>            try:</code></li>
<li class="missed"><code>                opts['quality'] = int(opts['quality'])</code></li>
<li class="missed"><code>            except (TypeError, ValueError):</code></li>
<li class="missed"><code>                if raise_errors:</code></li>
<li class="missed"><code>                    raise TemplateSyntaxError("%r is an invalid quality." %</code></li>
<li class="ignored"><code>                                              opts['quality'])</code></li>
<li class="missed"><code>                return self.bail_out(context)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        try:</code></li>
<li class="missed"><code>            thumbnail = get_thumbnailer(source).get_thumbnail(opts)</code></li>
<li class="missed"><code>        except Exception, e:</code></li>
<li class="missed"><code>            if raise_errors:</code></li>
<li class="missed"><code>                raise TemplateSyntaxError(u"Couldn't get the thumbnail %s: %s" %</code></li>
<li class="ignored"><code>                                          (source, e))</code></li>
<li class="missed"><code>            return self.bail_out(context)</code></li>
<li class="ignored"><code>        # Return the thumbnail file url, or put the file on the context.</code></li>
<li class="missed"><code>        if self.context_name is None:</code></li>
<li class="missed"><code>            return escape(thumbnail.url)</code></li>
<li class="ignored"><code>        else:</code></li>
<li class="missed"><code>            context[self.context_name] = thumbnail</code></li>
<li class="missed"><code>            return ''</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def bail_out(self, context):</code></li>
<li class="missed"><code>        if self.context_name:</code></li>
<li class="missed"><code>            context[self.context_name] = ''</code></li>
<li class="missed"><code>        return ''</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>def thumbnail(parser, token):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Creates a thumbnail of an ImageField.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    Basic tag Syntax::</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>        {% thumbnail [source] [size] [options] %}</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    *source* must be a ``File`` object, usually an Image/FileField of a model</code></li>
<li class="ignored"><code>    instance.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    *size* can either be:</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    * the size in the format ``[width]x[height]`` (for example,</code></li>
<li class="ignored"><code>      ``{% thumbnail person.photo 100x50 %}``) or</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    * a variable containing a valid size (i.e. either a string in the</code></li>
<li class="ignored"><code>      ``[width]x[height]`` format or a tuple containing two integers):</code></li>
<li class="ignored"><code>      ``{% thumbnail person.photo size_var %}``.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    *options* are a space separated list of options which are used when</code></li>
<li class="ignored"><code>    processing the image to a thumbnail such as ``sharpen``, ``crop`` and</code></li>
<li class="ignored"><code>    ``quality=90``.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    The thumbnail tag can also place a</code></li>
<li class="ignored"><code>    :class:`~easy_thumbnails.files.ThumbnailFile` object in the context,</code></li>
<li class="ignored"><code>    providing access to the properties of the thumbnail such as the height and</code></li>
<li class="ignored"><code>    width::</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>        {% thumbnail [source] [size] [options] as [variable] %}</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    When ``as [variable]`` is used, the tag doesn't output anything.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    **Debugging**</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    By default, if there is an error creating the thumbnail or resolving the</code></li>
<li class="ignored"><code>    image variable then the thumbnail tag will just return an empty string (and</code></li>
<li class="ignored"><code>    if there was a context variable to be set then it will also be set to an</code></li>
<li class="ignored"><code>    empty string).</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    For example, you will not see an error if the thumbnail could not</code></li>
<li class="ignored"><code>    be written to directory because of permissions error. To display those</code></li>
<li class="ignored"><code>    errors rather than failing silently, set ``THUMBNAIL_DEBUG = True`` in</code></li>
<li class="ignored"><code>    your Django project's settings module.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    """</code></li>
<li class="missed"><code>    args = token.split_contents()</code></li>
<li class="missed"><code>    tag = args[0]</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    # Check to see if we're setting to a context variable.</code></li>
<li class="missed"><code>    if len(args) &gt; 4 and args[-2] == 'as':</code></li>
<li class="missed"><code>        context_name = args[-1]</code></li>
<li class="missed"><code>        args = args[:-2]</code></li>
<li class="ignored"><code>    else:</code></li>
<li class="missed"><code>        context_name = None</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    if len(args) &lt; 3:</code></li>
<li class="missed"><code>        raise TemplateSyntaxError("Invalid syntax. Expected "</code></li>
<li class="ignored"><code>            "'{%% %s source size [option1 option2 ...] %%}' or "</code></li>
<li class="ignored"><code>            "'{%% %s source size [option1 option2 ...] as variable %%}'" %</code></li>
<li class="ignored"><code>            (tag, tag))</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    opts = {}</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    # The first argument is the source file.</code></li>
<li class="missed"><code>    source_var = parser.compile_filter(args[1])</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    # The second argument is the requested size. If it's the static "10x10"</code></li>
<li class="ignored"><code>    # format, wrap it in quotes so that it is compiled correctly.</code></li>
<li class="missed"><code>    size = args[2]</code></li>
<li class="missed"><code>    match = RE_SIZE.match(size)</code></li>
<li class="missed"><code>    if match:</code></li>
<li class="missed"><code>        size = '"%s"' % size</code></li>
<li class="missed"><code>    opts['size'] = parser.compile_filter(size)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    # All further arguments are options.</code></li>
<li class="missed"><code>    args_list = split_args(args[3:]).items()</code></li>
<li class="missed"><code>    for arg, value in args_list:</code></li>
<li class="missed"><code>        if arg in VALID_OPTIONS:</code></li>
<li class="missed"><code>            if value and value is not True:</code></li>
<li class="missed"><code>                value = parser.compile_filter(value)</code></li>
<li class="missed"><code>            opts[arg] = value</code></li>
<li class="ignored"><code>        else:</code></li>
<li class="missed"><code>            raise TemplateSyntaxError("'%s' tag received a bad argument: "</code></li>
<li class="ignored"><code>                                      "'%s'" % (tag, arg))</code></li>
<li class="missed"><code>    return ThumbnailNode(source_var, opts=opts, context_name=context_name)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>def thumbnailer(obj):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Creates a thumbnailer from an object (usually a ``FileField``).</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    Example usage::</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>        {% with photo=person.photo|thumbnailer %}</code></li>
<li class="ignored"><code>        {% if photo %}</code></li>
<li class="ignored"><code>            &lt;a href="{{ photo.large.url }}"&gt;</code></li>
<li class="ignored"><code>                {{ photo.square.tag }}</code></li>
<li class="ignored"><code>            &lt;/a&gt;</code></li>
<li class="ignored"><code>        {% else %}</code></li>
<li class="ignored"><code>            &lt;img href="{% static 'template/fallback.png' %}" alt="" /&gt;</code></li>
<li class="ignored"><code>        {% endif %}</code></li>
<li class="ignored"><code>        {% endwith %}</code></li>
<li class="ignored"><code>    """</code></li>
<li class="missed"><code>    return get_thumbnailer(obj)</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>def thumbnailer_passive(obj):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Creates a thumbnailer from an object (usually a ``FileFile``) that won't</code></li>
<li class="ignored"><code>    generate new thumbnails.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    This is useful if you are using another process to generate the thumbnails</code></li>
<li class="ignored"><code>    rather than having them generated on the fly if they are missing.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    Example usage::</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>        {% with avatar=person.avatar|thumbnailer_passive %}</code></li>
<li class="ignored"><code>            {% with avatar_thumb=avatar.small %}</code></li>
<li class="ignored"><code>                {% if avatar_thumb %}</code></li>
<li class="ignored"><code>                    &lt;img src="{{ avatar_thumb.url }}" alt="" /&gt;</code></li>
<li class="ignored"><code>                {% else %}</code></li>
<li class="ignored"><code>                    &lt;img src="{% static 'img/default-avatar-small.png' %}" alt="" /&gt;</code></li>
<li class="ignored"><code>                {% endif %}</code></li>
<li class="ignored"><code>            {% endwith %}</code></li>
<li class="ignored"><code>        {% endwith %}</code></li>
<li class="ignored"><code>    """</code></li>
<li class="missed"><code>    thumbnailer = get_thumbnailer(obj)</code></li>
<li class="missed"><code>    thumbnailer.generate = False</code></li>
<li class="missed"><code>    return thumbnailer</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>def thumbnail_url(source, alias):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Return the thumbnail url for a source file using an aliased set of</code></li>
<li class="ignored"><code>    thumbnail options.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    If no matching alias is found, returns an empty string.</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>    Example usage::</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>        &lt;img href="{{ person.photo|thumbnail_url:'small' }}" alt=""&gt;</code></li>
<li class="ignored"><code>    """</code></li>
<li class="missed"><code>    try:</code></li>
<li class="missed"><code>        thumb = get_thumbnailer(source)[alias]</code></li>
<li class="missed"><code>    except Exception:</code></li>
<li class="missed"><code>        return ''</code></li>
<li class="missed"><code>    return thumb.url</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>register.tag(thumbnail)</code></li>
<li class="missed"><code>register.filter(thumbnailer)</code></li>
<li class="missed"><code>register.filter(thumbnailer_passive)</code></li>
<li class="missed"><code>register.filter(thumbnail_url)</code></li>
  </ol>
</div>

<div class="nav">
  <a href="easy_thumbnails.storage.html">easy_thumbnails.storage</a> &lt;&lt;
  <a href="../index.html">index</a>
  &gt;&gt; <a href="easy_thumbnails.test.html">easy_thumbnails.test</a>
</div>

  </body>
</html>

