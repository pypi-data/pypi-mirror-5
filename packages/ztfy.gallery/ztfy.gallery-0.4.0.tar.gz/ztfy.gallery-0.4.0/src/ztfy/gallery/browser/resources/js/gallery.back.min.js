(function(a){a.ZBlog.gallery={sorter:function(b){a(b).sortable(a.ZBlog.gallery.sort_options)},sort_options:{handle:"DIV.image",containment:"parent",placeholder:"sorting-holder",stop:function(c,e){var b=new Array();a("FIELDSET.gallery DIV.image").each(function(f){b[b.length]=a(this).attr("id")});var d={ids:b};a.ZTFY.ajax.post(window.location.href+"/@@ajax/ajaxUpdateOrder",d,null,function(h,f,g){jAlert(h.responseText,a.ZTFY.I18n.ERROR_OCCURED,window.location.reload)})}},remove:function(b,c){jConfirm(a.ZTFY.I18n.CONFIRM_REMOVE,a.ZTFY.I18n.CONFIRM,function(e){if(e){var d={id:b};a.ZTFY.form.ajax_source=a('DIV[id="'+c+'"]');a.ZTFY.ajax.post(window.location.href+"/@@ajax/ajaxRemove",d,a.ZBlog.gallery._removeCallback,null,"text")}})},_removeCallback:function(b,c){if((c=="success")&&(b=="OK")){a(a.ZTFY.form.ajax_source).parents("DIV.image_wrapper").remove()}},paypal_switch:function(c){var b=window.location.href;var f=b.substr(0,b.lastIndexOf("/"));var e=f+"/++gallery++/"+c+"/++paypal++/@@switch.html";var d=a("A.paypal",a('DIV[id="'+c+'"]').parents("DIV.image_wrapper"));a.ZTFY.form.ajax_source=c;if(d.hasClass("disabled")){a.ZTFY.ajax.post(e,{},a.ZBlog.gallery._paypalEnableCallback,function(i,g,h){jAlert(i.responseText,a.ZTFY.I18n.ERROR_OCCURED,window.location.reload)},"json")}else{a.ZTFY.dialog.open(e)}},paypal_edit:function(b,c){a.ZTFY.form.edit(b,c,a.ZBlog.gallery._editCallback)},_editCallback:function(b,c){a.ZTFY.form._editCallback(b,c);if((c=="success")&&(b.output=="OK")){var d=a.ZTFY.form.ajax_source;var e=a("A.paypal",a('DIV[id="'+d+'"]').parents("DIV.image_wrapper"));if(b.enabled){e.removeClass("disabled").addClass("enabled");a("IMG",e).attr("src","/--static--/ztfy.gallery.back/img/paypal-enabled.png")}else{e.removeClass("enabled").addClass("disabled");a("IMG",e).attr("src","/--static--/ztfy.gallery.back/img/paypal-disabled.png")}}},_paypalEnableCallback:function(b,c){if((c=="success")&&(b.output=="OK")){var d=a.ZTFY.form.ajax_source;var e=a("A.paypal",a('DIV[id="'+d+'"]').parents("DIV.image_wrapper"));if(e.hasClass("disabled")){e.removeClass("disabled").addClass("enabled");a("IMG",e).attr("src","/--static--/ztfy.gallery.back/img/paypal-enabled.png")}}}}})(jQuery);