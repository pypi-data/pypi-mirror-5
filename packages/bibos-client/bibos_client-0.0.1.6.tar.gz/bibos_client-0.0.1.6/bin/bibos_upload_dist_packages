#!/usr/bin/env python

import hashlib
import uuid
import os
import sys
import csv

from bibos_utils.bibos_config import BibOSConfig
from bibos_client.admin_client import BibOSAdmin

config = BibOSConfig()
data = config.get_data()

admin_url = data['admin_url']
distribution = data['distribution']

admin = BibOSAdmin(admin_url, verbose=False)


#os.system('get_package_data /tmp/packages.csv')

with open('/tmp/packages.csv') as f:
    package_reader = csv.reader(f, delimiter=';')
    package_data = [{'name': n, 'status': s, 'version': v, 'description': d}  
                    for  (n, s, v, d) in package_reader]

print package_data

try:
    admin.upload_dist_packages(distribution, package_data)
except Exception as e:
    print >> sys.stderr, 'Error:', str(e)
    sys.exit(1)

