<!DOCTYPE html><html dir="ltr" id="developer-mozilla-org" lang="en-US" xmlns:fb="http://www.facebook.com/2008/fbml" xmlns:og="http://ogp.me/ns#"><head>
    <title>Mozilla Developer Network</title>
  
  <meta charset="utf-8">
  <meta content="index, follow" name="robots">
  <link href="https://developer.mozilla.org/" rel="home"></link>
  <link href="https://developer.mozilla.org/#copyright" rel="copyright"></link>
  <link href="https://developer.mozilla.org/media/img/favicon.ico" rel="shortcut icon"></link>

    <!--[if !IE 6]><!-->
  <link href="https://developer.mozilla.org/media/css/fonts.css" media="screen,projection,tv" rel="stylesheet"></link>
<link href="https://developer.mozilla.org/media/css/mdn-screen.css" media="screen,projection,tv" rel="stylesheet"></link>
<link href="https://developer.mozilla.org/media/css/modals.css" media="screen,projection,tv" rel="stylesheet"></link>
<link href="https://developer.mozilla.org/media/css/video-player.css" media="screen,projection,tv" rel="stylesheet"></link>
<link href="https://developer.mozilla.org/media/css/mdn-calendar.css" media="screen,projection,tv" rel="stylesheet"></link>
<link href="https://developer.mozilla.org/media/css/redesign-transition.css" media="screen,projection,tv" rel="stylesheet"></link>
    <!--<![endif]-->
  <!--[if IE]><link rel="stylesheet" type="text/css" media="all" href="/media/css/ie.css"><![endif]-->
  <!--[if lte IE 7]><link rel="stylesheet" type="text/css" media="all" href="/media/css/ie7.css"><![endif]-->
  <!--[if lte IE 6]><link rel="stylesheet" type="text/css" media="all" href="/media/css/ie6.css"><![endif]-->
  <link href="https://developer.mozilla.org/media/css/libs/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"></link>
  <link href="https://developer.mozilla.org/media/css/mdn-print.css" media="print" rel="stylesheet" type="text/css"></link>
  <link href="//mozorg.cdn.mozilla.net/media/css/tabzilla-min.css" rel="stylesheet"></link>
  
  <link href="https://developer-local.allizom.org/en-US/search/xml" rel="search" title="Mozilla Developer Network" type="application/opensearchdescription+xml"></link>
  
  <!--[if IE]>
  <meta http-equiv="imagetoolbar" content="no">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <script src="https://developer-local.allizom.org//media/js/libs/html5.js"></script>
  <![endif]-->

  <script type="text/javascript">
    // This represents the site configuration
    // TODO:  Move this to its own module when we're AMD-ready
    window.mdn = {
      build: 'dev',
      // Setting these objects up for later use
      ckeditor: {},
      mediaPath: '/media/',
      wiki: {
        autosuggestTitleUrl: '/docs/get-documents'
      }
    };
  </script>

      <link href="https://developer.mozilla.org/media/css/wiki.css" media="screen,projection,tv" rel="stylesheet"></link>
<link href="https://developer.mozilla.org/media/css/modals.css" media="screen,projection,tv" rel="stylesheet"></link>
<link href="https://developer.mozilla.org/media/css/wiki-screen.css" media="screen,projection,tv" rel="stylesheet"></link>
<link href="https://developer.mozilla.org/media/css/jqueryui/jqueryui.css" media="screen,projection,tv" rel="stylesheet"></link>
<link href="https://developer.mozilla.org/media/css/jqueryui/jquery-ui-1.8.14.custom.css" media="screen,projection,tv" rel="stylesheet"></link>
<link href="https://developer.mozilla.org/media/css/jqueryui/moz-jquery-plugins.css" media="screen,projection,tv" rel="stylesheet"></link>

  </head>

<body class="html-ltr " id="" role="document">
<!--[if lte IE 8]>
<noscript><div class="global-notice">
<p><strong>Warning:</strong> The Mozilla Developer Network website employs emerging web standards that may not be fully supported in some versions of Microsoft Internet Explorer. You can improve your experience of this website by enabling JavaScript.</p></div></noscript>
<![endif]-->
  <header class="minor new-menu" id="masthead">
    <div class="wrap">
      <ul id="nav-access">
        <li><a href="https://developer.mozilla.org/#language">Select language</a></li>
                <li><a href="https://developer.mozilla.org/#content">Skip to main content</a></li>
      </ul>
    
      <div id="branding">
                <div id="logo"><a href="https://developer.mozilla.org/"><img alt="Mozilla Developer Network" height="71" src="https://developer.mozilla.org/media/img/mdn-logo-sm.png" title="Mozilla Developer Network" width="62"></img> Mozilla Developer Network</a></div>
              </div>
      
              <nav id="nav">
          <ul id="nav-main" role="menubar">
            <li class="menu" id="nav-main-docs" rel="menuitem"><a aria-haspopup="true" aria-labelledby="nav-main-docs" class="toggle" href="https://developer.mozilla.org/#nav-sub-docs" title="Read Documentation">Read<br><em>Docs</em></a>
              <div aria-hidden="true" class="sub-menu" id="nav-sub-docs">
                <ul>
                  <li>
                    <ul>

                      <li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML?menu">HTML</a></li>
                      <li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS?menu">CSS</a></li>
                      <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript?menu">JavaScript</a></li>
                      <li><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/Graphics?menu">Graphics</a></li>
                      <li><a href="https://developer.mozilla.org/en-US/docs/Web/API?menu">APIs / DOM</a></li>
                      <li><a href="https://developer.mozilla.org/en-US/docs/Web/Apps?menu">Apps</a></li>
                      <li><a href="https://developer.mozilla.org/en-US/docs/tools?menu">Dev Tools</a></li>
                      <li><a href="https://developer.mozilla.org/en-US/docs/Web/MathML?menu">MathML</a></li>
                    </ul>
                  </li>
                  <li>
                    <ul>
                      <li><a href="https://developer.mozilla.org/en-US/docs/Web/Tutorials?menu">Tutorials</a></li>
                      <li><a href="https://developer.mozilla.org/en-US/docs/Web/Reference?menu">References</a></li>
                      <li><a href="https://developer.mozilla.org/en-US/docs/Web/Guide?menu">Developer Guides</a></li>
                      <li><a href="https://developer.mozilla.org/en-US/docs/Accessibility?menu">Accessibility</a></li>
                      <li><a href="https://developer.mozilla.org/demos/?menu">Demos</a></li>
                      <li><br><br><a href="https://developer.mozilla.org/docs?menu">...more docs</a></li>
                    </ul>
                  </li>
                </ul>
              </div>
            </li>
            <li id="nav-main-apps"><a href="https://marketplace.firefox.com/developers/?menu">Make<br><em>Apps</em></a>
            </li>
            <li class="menu" id="nav-main-firefox" role="menuitem"><a aria-haspopup="true" aria-labelledby="nav-main-firefox" class="firefox toggle" href="https://developer.mozilla.org/#nav-sub-firefox">Build &amp; Use<br><em>Firefox</em></a>
              <ul class="sub-menu" id="nav-sub-firefox">
                <li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Firefox_OS?menu">Firefox OS</a></li>
                <li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Firefox?menu">Firefox Desktop</a></li>
                <li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Mobile?menu">Mobile</a></li>
                <li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons?menu">Add-ons</a></li>
              </ul>
            </li>
            <li id="nav-main-demos" role="menuitem"><a class="demos" href="https://developer.mozilla.org/demos/?menu">See &amp; Submit<br><em>Demos</em></a></li>
            <li class="menu" id="nav-main-community" role="menuitem"><a aria-haspopup="true" aria-labelledby="nav-main-community" class="community toggle" href="https://developer.mozilla.org/#nav-sub-community">Get<br><em>Involved</em></a>
              <ul class="sub-menu" id="nav-sub-community">
                <li><a href="https://developer.mozilla.org/en-US/docs/Project:MDN/Contributing/Join_the_community?menu">Join the Community</a></li>
                <li><a href="https://developer.mozilla.org/en-US/docs/Project:MDN/Contributing?menu">Contribute to MDN</a></li>
                <li><a href="https://developer.mozilla.org/events?menu">Events</a></li>
                <li><a href="https://developer.mozilla.org/en-US/docs/Project:MDN/Contributing/Follow_what_s_happening?menu">Tweets, Blogs, and More</a></li>
              </ul>
            </li>
          </ul>
        </nav>

            
      
      <a href="//www.mozilla.org/" id="tabzilla">mozilla</a>
    </div>
  </header>

    

<!-- top toolbar -->
<section id="nav-toolbar"><div><div class="wrap">
  
  <!-- left crumb navigation -->
  <nav class="crumbs" role="navigation">
    <ol>
        <li class="crumb"><a href="https://developer.mozilla.org/index.html">django-valet-keys 0.0.1 documentation</a></li>
        <li class="crumb">Usage</li>
    </ol>
  </nav>
  
</div></div></section>

<section id="content">
    <div class="wrap">
        <div class="full" id="content-main">
            <article class="article" role="main">
                                <div class="page-content boxed" id="wikiArticle">
                    <div id="article-nav">
                      <div class="page-toc">
                        <h2>Table of Contents</h2>
                        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="overview.html#what-is-django-valet-keys">What is django-valet-keys?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#configuration">Configuration</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#views-included">Views included</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-accepts-valet-key-decorator">The <tt class="docutils literal"><span class="pre">&#64;accepts_valet_key</span></tt> decorator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-key-model-and-activity-logging">The <tt class="docutils literal"><span class="pre">Key</span></tt> model and activity logging</a></li>
</ul>
</li>
</ul>

                      </div>
                    </div>
                    
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="views-included">
<h2>Views included<a class="headerlink" href="#views-included" title="Permalink to this headline">¶</a></h2>
<p>There are four views provided by django-valet-keys:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">valet_keys.views.list</span></tt></dt>
<dd>The &#8220;home page&#8221; for django-valet-keys, listing all of a user&#8217;s keys
and offering a link to create a new one. It&#8217;s handy to offer a link to
this view from a profile or settings page.</dd>
<dt><tt class="docutils literal"><span class="pre">valet_keys.views.new</span></tt></dt>
<dd>Accepts a user-authored description and generates a new key.</dd>
<dt><tt class="docutils literal"><span class="pre">valet_keys.views.disable</span></tt></dt>
<dd>Allows a user to disable a key, linked from the list view. Note that keys
are never <em>deleted</em>, only disabled. This preserves recorded history and
allows later investigation of robot misbehavior.</dd>
<dt><tt class="docutils literal"><span class="pre">valet_keys.views.history</span></tt></dt>
<dd>Paginated view of usage history for a key, linked from the list view.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There&#8217;s no <em>edit</em> view. Keys can be created or disabled, but are otherwise
immutable. The only user-serviceable part is the description of the key;
user name and password are randomly generated.</p>
</div>
</div>
<div class="section" id="the-accepts-valet-key-decorator">
<h2>The <tt class="docutils literal"><span class="pre">&#64;accepts_valet_key</span></tt> decorator<a class="headerlink" href="#the-accepts-valet-key-decorator" title="Permalink to this headline">¶</a></h2>
<p>In your views, the <tt class="docutils literal"><span class="pre">&#64;accepts_valet_key</span></tt> decorator is the primary way to
support valet keys. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">valet_keys.decorators</span> <span class="kn">import</span> <span class="n">accepts_valet_key</span>

<span class="nd">@accepts_valet_key</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">valet_key</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;HELLO ROBOT, I SEE YOU ARE IMPERSONATING </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Why, hello there Mr. User!&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Welcome, guest.&#39;</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">response</span><span class="p">[</span><span class="s">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;text/plain&#39;</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
<p>The above demonstrates the features of the <tt class="docutils literal"><span class="pre">&#64;accepts_valet_key</span></tt> decorator:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">request.valet_key</span></tt> is set to <tt class="docutils literal"><span class="pre">None</span></tt>, if the request did not present a
valid key in HTTP Basic Auth.</li>
<li><tt class="docutils literal"><span class="pre">request.valet_key</span></tt> contains an instance of <tt class="docutils literal"><span class="pre">valet_keys.models.Key</span></tt> if
there <em>was</em> a valid key presented via HTTP Basic Auth.</li>
<li>Additionally, <tt class="docutils literal"><span class="pre">request.user</span></tt> is set to the Django <tt class="docutils literal"><span class="pre">User</span></tt> who owns the
valet key.</li>
</ul>
</div>
<div class="section" id="the-key-model-and-activity-logging">
<h2>The <tt class="docutils literal"><span class="pre">Key</span></tt> model and activity logging<a class="headerlink" href="#the-key-model-and-activity-logging" title="Permalink to this headline">¶</a></h2>
<p>As mentioned above, views decorated with <tt class="docutils literal"><span class="pre">&#64;accepts_valet_key</span></tt> will receive
an instance of <tt class="docutils literal"><span class="pre">valet_keys.models.Key</span></tt> in <tt class="docutils literal"><span class="pre">request.valet_key</span></tt> if a valid
key was presented via HTTP Basic Auth.</p>
<p>The presence of this instance (ie. not <tt class="docutils literal"><span class="pre">None</span></tt>) is useful for detecting
access by an authorized robot. However, there is also a logging method
presented by the <tt class="docutils literal"><span class="pre">Key</span></tt> model object which is useful for recording what the
robot did while acting on a user&#8217;s behalf. It works like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@accepts_valet_key</span>
<span class="k">def</span> <span class="nf">comment</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">slug</span><span class="p">):</span>
    <span class="n">blog_post</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">BlogPost</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>

    <span class="k">if</span> <span class="s">&#39;POST&#39;</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">valet_key</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;comment&#39;</span><span class="p">]</span>
        <span class="n">blog_post</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">valet_key</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;blog.commented&#39;</span><span class="p">,</span> <span class="n">blog_post</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<p>As demonstrated in this pseudo-code, the <tt class="docutils literal"><span class="pre">Key</span></tt> model offers a <tt class="docutils literal"><span class="pre">log</span></tt> method
that accepts these parameters:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">action</span></tt></dt>
<dd>Arbitrary string naming an action, handy when prefixed with an app name.</dd>
<dt><tt class="docutils literal"><span class="pre">content_object</span></tt></dt>
<dd>An optional content object on which the action was performed.</dd>
<dt><tt class="docutils literal"><span class="pre">notes</span></tt></dt>
<dd>Arbitrary text offering further description of the action.</dd>
</dl>
<p>Calls to <tt class="docutils literal"><span class="pre">log</span></tt> result in entries visible on the <tt class="docutils literal"><span class="pre">valet_keys.views.history</span></tt>
view, thus offering rudimentary key usage tracking.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is a pretty cruddy logging API, so <a class="reference external" href="https://github.com/lmorchard/django-valet-keys/pulls">pull requests welcome!</a></p>
</div>
</div>
</div>


                </div>
            </article>
        </div>
    </div>
</section>


<section id="footbar">
<div class="wrap">
  <p>
  Is MDN helpful to you? Please <a href="https://developer.mozilla.org/en-US/docs/Project:Feedback">share your feedback</a> with us. Or join our <a href="//lists.mozilla.org/listinfo/dev-mdc" id="dev-mdc-link">mailing list about improving MDN content</a>.  </p>
</div>
</section>
<footer class="footer" id="site-info" role="contentinfo">
<div class="wrap">
    <div id="legal">
      <img alt="" height="48" src="https://developer.mozilla.org/media/img/mdn-logo-tiny.png" width="42"></img>
      <p id="copyright">© 2005 - 2013 Mozilla Developer Network and individual contributors</p>
      <p>
      Content is available under <a href="https://developer.mozilla.org/en-US/docs/Project:Copyrights">these licenses</a>      • <a href="https://developer.mozilla.org/en-US/docs/Project:About">About MDN</a>
      • <a href="//github.com/mozilla/kuma">Contribute to the code</a>
      • <a href="//www.mozilla.org/en-US/privacy">Privacy Policy</a>
    </p></div>
    </div>
</footer>

<script src="https://developer.mozilla.org/jsi18n/build:dev"></script>
  <script async src="//mozorg.cdn.mozilla.net/en-US/tabzilla/tabzilla.js"></script>
  <script src="//www.google.com/jsapi" type="text/javascript"></script>
  <script src="https://login.persona.org/include.js" type="text/javascript"></script>
  <script src="https://developer.mozilla.org/media/js/libs/jquery-1.9.1.js"></script>
<script src="https://developer.mozilla.org/media/js/jquery-upgrade-compat.js"></script>
<script src="https://developer.mozilla.org/media/js/init.js"></script>
<script src="https://developer.mozilla.org/media/js/gsearch.js"></script>
<script src="https://developer.mozilla.org/media/js/libs/jquery.cycle.js"></script>
<script src="https://developer.mozilla.org/media/js/libs/slideshow.js"></script>
<script src="https://developer.mozilla.org/media/js/libs/video-player.js"></script>
<script src="https://developer.mozilla.org/media/js/libs/jquery.simplemodal.1.4.1.min.js"></script>
  
  <script type="text/javascript">
    // Event tracking for the new menu
    $(function() {
      $('#nav-main').on('click', 'a', function(e) {
        window._gaq && _gaq.push(['_trackEvent', 'Menu', 'Click', e.target.innerHTML, e.target.href]);
      });
    });
  </script>
    <script src="https://developer.mozilla.org/media/js/libs/jquery.simplemodal.1.4.1.min.js"></script>
<script src="https://developer.mozilla.org/media/js/libs/jqueryui.min.js"></script>
<script src="https://developer.mozilla.org/media/js/moz-jquery-plugins.js"></script>
<script src="https://developer.mozilla.org/media/js/main.js"></script>
<script src="https://developer.mozilla.org/media/js/wiki.js"></script>
<script src="https://developer.mozilla.org/media/js/libs/tag-it.js"></script>
<script src="https://developer.mozilla.org/media/js/wiki-tags-edit.js"></script>

<script async src="https://developer.mozilla.org/en-US/waffles.js" type="text/javascript"></script>

</body></html>