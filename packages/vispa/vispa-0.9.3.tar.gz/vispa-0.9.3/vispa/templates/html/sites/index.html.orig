## sites/index.html
<%! import os.path%>
<%! from vispa import url %>
<%inherit file="${os.path.join('..','base.html')}" />
<%namespace name="base" file="${os.path.join('..','base.html')}"/>

<%block name="title">Vispa</%block>

<%block name="favicon">"${url.static('img/ico/favicon.png')}"</%block>

<%block name="meta">
    <!-- activate iOS WebApp Mode -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    
    <!-- iOS status bar style in WebApp Mode -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    
    <!-- iOS Start Screens in WepApp Mode -->
    <!-- iPad - portrait -->
    <link rel="apple-touch-startup-image" href="${url.static('img/vispa/ipad-splashscreen-portrait.png')}" media="screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:portrait)" />
    <!-- iPad - landscape -->
    <link rel="apple-touch-startup-image" href="${url.static('img/vispa/ipad-splashscreen-landscape.png')}" media="screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:landscape)" />
    <!-- iPhone -->
    <link rel="apple-touch-startup-image" href="${url.static('img/vispa/iphone-splashscreen-portrait.png')}" media="screen and (max-device-width: 480px)" />
    <!-- iPhone4 -->
    <link rel="apple-touch-startup-image" href="${url.static('img/vispa/iphone4-splashscreen-portrait.png')}" media="screen and (max-device-width: 480px) and (-webkit-min-device-pixel-ratio: 2)" />
    
    <!-- iOS HomeScreen icos -->
    <link rel="apple-touch-icon-precomposed" href="${url.static('img/vispa/iphone-icon.png')}" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="${url.static('img/vispa/ipad-icon.png')}" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="${url.static('img/vispa/iphone4-icon.png')}" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="${url.static('img/vispa/ipad3-icon.png')}" />
</%block>

<%block name="js_imports_pre">
    <%
        jquery_scripts = ["jquery.min.js",
                          "jquery.migrate.min.js",
                          "mobile/jquery.mobile.min.js",
                          "ui/jquery.ui.min.js",
                          "ui/jquery.ui.touch-punch.min.js",
                          "jgestures/jquery.jgestures.min.js",
                          "hotkeys/jquery.hotkeys.min.js",
                          "qtip/jquery.qtip.min.js",
                          "topics/jquery.topics.min.js",
                          "polling/jquery.polling.min.js",
                          "shortcuts/jquery.shortcuts.min.js",
                          "history/jquery.history.min.js",
                          "slimscroll/jquery.slimscroll-horizontal.min.js",
                          "slimscroll/jquery.slimscroll.min.js",
                          "jqbrowser/jquery.jqbrowser.min.js",
                          "logger/jquery.logger.min.js",
                          "ludo-jquery-treetable/jquery.treeTable.js",
                          "persist/persist-min.js",
                          "tablesorter/jquery.tablesorter.min.js",
                          "tablesorter/jquery.tablesorter.pager.min.js",
                          "tablesorter/jquery.tablesorter.widgets.min.js",
                          "selectBoxIt/jquery.selectBoxIt.min.js",
                          "resizablesnap/jquery.ui.resizable.snap.ext.min.js",
                          "isotope/jquery.isotope.min.js",
                          "transparency/jquery.transparency.min.js"]
        framework_scripts = ["class/class.min.js",
                             "json/json2.js",
                             #"bootstrap/js/bootstrap.min.js"
                             "three/three.min.js",
                             "three/TinyTrackballControls.js",
                             "ace/ace.js"]
        base_scripts = ["jquerymods.js",
                        "socket.js",
                        "bus.js",
                        "messenger.js",
                        "url.js",
                        "menu.js",
                        "helpers.js",
                        "file/filebase/base.js",
                        "file/filebase/view.js",
                        "file/filebase/events.js",
                        "file/filebase/actions.js",
                        "file/filebase/selections.js",
                        "file/filebase/items.js",
                        "file/filebase/views/symbol/view.js",
                        "file/fileselector/fileselector.js"]
        site_scripts = ["index.js",
                        "view.js",
                        "extensionview.js",
                        "commandpalette.js",
                        "pathbar.js",
                        "extensionmanager.js",
                        "workspacemanager.js",
                        "preferencehandler.js",
                        "preferenceview.js"]

        for script in jquery_scripts:
            base.import_js(url.static(url.join("frameworks/jquery", script)))
        for script in framework_scripts:
            base.import_js(url.static(url.join("frameworks", script)))
        for script in base_scripts:
            base.import_js(url.static(url.join("js/base", script)))
        for script in site_scripts:
            base.import_js(url.static(url.join("js/sites/index", script)))
    %>
</%block>

<%block name="js_imports_post">
    <%
        for script in common_js:
            base.import_js(script)
    %>
</%block>

<%block name="css_imports">
    <%
        base.import_css(url.static("css/base/resets.css"))

        jquery_scripts = ["ui/css/overcast/jquery-ui-1.10.2.custom.min.css",
                          "ludo-jquery-treetable/css/jquery.treeTable.css",
                          "tablesorter/css/jquery.tablesorter.min.css",
                          "tablesorter/css/jquery.tablesorter.pager.css",
                          "selectBoxIt/css/jquery.selectBoxIt.min.css"]
        framework_scripts = []#["bootstrap/css/bootstrap.min.css"]
        base_scripts = ["menu.css",
                        "overlay.css",
                        "messenger.css"]
        site_scripts = ["view.css",
                        "extensionview.css",
                        "preferenceview.css",
                        "pathbar.css"]
        file_scripts = ["filebase/filebase.css",
                        "filebase/views/symbol/style.css"]

        for script in jquery_scripts:
            base.import_css(url.static(url.join("frameworks/jquery", script)))
        for script in framework_scripts:
            base.import_css(url.static(url.join("frameworks", script)))
        for script in base_scripts:
            base.import_css(url.static(url.join("css/base", script)))
        for script in site_scripts:
            base.import_css(url.static(url.join("css/sites/index", script)))
        for script in file_scripts:
            base.import_css(url.static(url.join("css/base/file", script)))
        for script in common_css:
            base.import_css(script)
    %>
</%block>

<%block name="js_inline_post">
$(function() {
% if logging_enabled:
    $.Logger().enable().level('${logging_level}');
% for elem in logging_ignore:
    $.Logger('${elem}').disable();
% endfor
% endif

    // show the inner startup overlay (css transition)
    $('#startup-overlay-inner').toggleClass('visible');

    // store template data
    var wsPath = $.Helpers.joinPath(location.host, '${base_dynamic}', 'bus/');
    var templateData = {
        devMode: ${'true' if devmode else 'false'},
        userName: '${username}',
        addWorkspaces: ${'true' if add_workspaces else 'false'},
        profileId: ${profile_id},
        urlHandler: {
            dynamicBase: '${base_dynamic}',
            staticBase: '${base_static}'
        },
        bus: {
            address: $.Helpers.strFormat('ws{0}://{1}', '${'s' if secure_websockets else ''}', wsPath),
            forceFallback: ${'false' if use_websockets else 'true'},
            fallbackPollUrl: $.Helpers.strFormat('{0}//{1}poll', location.protocol, wsPath),
            fallbackSendUrl: $.Helpers.strFormat('{0}//{1}receive', location.protocol, wsPath)
        }
    };

    // store the preferences
    var preferences = {
        vispa_preference: $.parseJSON('${vispa_preference}'),
        extension_preference: $.parseJSON('${extension_preference}')
    };

    // merge the templateData and preferences
    var config = $.extend(true, {}, templateData, preferences.vispa_preference);

    // prepare the workspace data
    var workspaceData = {
        connected: ${workspace_ids},
        all: $.parseJSON("${workspace_data}".replace(/\'/g, '"'))
    };

    // startup vispa with template data and preferences
    window.Vispa = new Vispa(config, preferences.extension_preference, workspaceData);
    window.Vispa.startup();
});
</%block>

## Main GUI Markup
<div id='body-wrapper' class='body-wrapper'>

    <div id='startup-overlay' class='startup-overlay'>
        <div id='startup-overlay-inner' class='startup-overlay-inner'>
            <img src='${url.static("img/maingui/loading_250.png")}' />
        </div>
    </div>

    <div id='header' class='header'>
        <div id='header-wrapper' class='header-wrapper'>
            <div id='header-left' class='header-left'>
                <div id='menu-button-outer-ws' class='menu-button-outer'>
                    <div id='menu-button-ws' class='menu-button-inner menu-button-image-ws'></div>
                </div>
                <div id='header-left-label' class='header-left-label'></div>
            </div>
            <div id='header-left-shadow' class='header-left-shadow'></div>
            <div id='header-center' class='header-center'>
                <div id='extension-badges' class='extension-badges'></div>
            </div>
            <div id='header-right-shadow' class='header-right-shadow'></div>
            <div id='header-right' class='header-right'>
                <div id='menu-button-outer-main' class='menu-button-outer'>
                    <div id='menu-button-main' class='menu-button-inner menu-button-image-main'></div>
                </div>
            </div>
        </div>
    </div>
    <div id='center' class='center'>
        <div id='center-wrapper' class='center-wrapper'>

            <div id='sidebar' class='sidebar'>
                <div id='sidebar-wrapper' class='sidebar-wrapper'>
                    <div id='sidebar-header' class='sidebar-header'>
                        sidebar header
                    </div>
                    <div id='sidebar-body' class='sidebar-body'>
                        sidebar content
                    </div>
                </div>
            </div>

            <div id='content' class='content'>
                <div id='content-wrapper' class='content-wrapper'>
                    <div id='content-header' class='content-header'>
                        <div id='content-header-left' class='content-header-left'></div>
                        <div id='content-header-right' class='content-header-right'></div>
                    </div>
                    <div id='content-main' class='content-main'>
                        <div id='content-welcome' class='content-welcome'>
                            <div id='content-welcome-inner' class='content-welcome-inner'>
                                <img src='${url.static("img/vispa/Vispa2.0Logo_300.png")}' />
                                <br /><br /><br /><br /><br />
                                <a href='http://www.rwth-aachen.de/' target='_blanc'>
                                    <img src='${url.static("img/vispa/rwth_logo.png")}' style='cursor:pointer;' />
                                </a>
                            </div>
                        </div>
                        <div id='content-body' class='content-body'></div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <!--    <div id='footer' class='footer'></div> -->

</div>