
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Part 4: Useful tricks &mdash; Django RPC 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Django RPC 0.1 documentation" href="../index.html" />
    <link rel="up" title="Tutorial" href="index.html" />
    <link rel="next" title="API Guide" href="../api/index.html" />
    <link rel="prev" title="Part 3: Javascript API" href="part3.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../api/index.html" title="API Guide"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="part3.html" title="Part 3: Javascript API"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Django RPC 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Tutorial</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="part-4-useful-tricks">
<span id="tutorial-part-4"></span><h1>Part 4: Useful tricks<a class="headerlink" href="#part-4-useful-tricks" title="Permalink to this headline">¶</a></h1>
<p>Here I&#8217;ll try show some useful trick that can save you time and explain how Django RPC works.</p>
<p>Real examples of code you can find in <a class="reference external" href="https://github.com/Alerion/Django-RPC/tree/master/example/">example project</a>,
<cite>tricks</cite> app.</p>
<div class="section" id="passing-extra-arguments">
<h2>Passing extra arguments<a class="headerlink" href="#passing-extra-arguments" title="Permalink to this headline">¶</a></h2>
<p>Real situation is when you need access to Django request object in your RPC method.
My idea was do not pass <tt class="docutils literal"><span class="pre">request</span></tt> to hide how we do method call. So in future we can
use our action class for some other API or send request via WebSocket+Torando
(In current version you can&#8217;t do this, but with a little patching I did for one project).</p>
<p>I&#8217;ll show you few ways how to pass extra arguments from request to our methods.</p>
<div class="section" id="router-level">
<h3>Router level<a class="headerlink" href="#router-level" title="Permalink to this headline">¶</a></h3>
<p>You can subclass <a class="reference internal" href="../api/base.html#djangorpc.RpcRouter" title="djangorpc.RpcRouter"><tt class="xref py py-class docutils literal"><span class="pre">djangorpc.RpcRouter</span></tt></a> and rewrite <tt class="docutils literal"><span class="pre">extra_kwargs</span></tt> method. Original method looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">extra_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;user&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>You can see <tt class="docutils literal"><span class="pre">*args</span></tt> and <tt class="docutils literal"><span class="pre">**kwargs</span></tt>. This is important here. These are arguments parsed with
Django URL patterns that are passed to views. So you can get some ID from URL and pass it to every
method. You will see this later.</p>
<p>Lets add <tt class="docutils literal"><span class="pre">request</span></tt> here:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">djangorpc</span> <span class="kn">import</span> <span class="n">RpcRouter</span><span class="p">,</span> <span class="n">Error</span><span class="p">,</span> <span class="n">Msg</span>

<span class="k">class</span> <span class="nc">CustomRouter</span><span class="p">(</span><span class="n">RpcRouter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">extra_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&#39;request&#39;</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span>
            <span class="s">&#39;user&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="p">}</span>

<span class="n">custom_router</span> <span class="o">=</span> <span class="n">CustomRouter</span><span class="p">()</span>
</pre></div>
</div>
<p>Now create some actions classes for testing. Do not forget about new <tt class="docutils literal"><span class="pre">request</span></tt> arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TricksApiClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Msg</span><span class="p">(</span><span class="s">u&#39;func1&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TricksOneApiClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">func2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Msg</span><span class="p">(</span><span class="s">u&#39;func2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And add theme to our router:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">custom_router</span> <span class="o">=</span> <span class="n">CustomRouter</span><span class="p">(</span><span class="s">&#39;tricks:custom_router&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s">&#39;TricksApi&#39;</span><span class="p">:</span> <span class="n">TricksApiClass</span><span class="p">(),</span>
    <span class="s">&#39;TricksOneApi&#39;</span><span class="p">:</span> <span class="n">TricksOneApiClass</span><span class="p">()</span>
<span class="p">})</span>
</pre></div>
</div>
<p>Just to have full example, lets show <tt class="docutils literal"><span class="pre">urls.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">actions</span> <span class="kn">import</span> <span class="n">custom_router</span>


<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;example.tricks.views&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;index&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;index&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^custom_router/$&#39;</span><span class="p">,</span> <span class="n">custom_router</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;custom_router&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^custom_router/api/$&#39;</span><span class="p">,</span> <span class="n">custom_router</span><span class="o">.</span><span class="n">api</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;custom_router_api&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>and our template:</p>
<div class="highlight-python"><pre>&lt;script src="{% url 'tricks:custom_router_api' %}"&gt;&lt;/script&gt;
&lt;script&gt;
    TricksApi.func1(function(response){
        console.log(response.msg);
    });

    TricksOneApi.func2(1, function(response){
        console.log(response.msg);
    });
&lt;/script&gt;</pre>
</div>
<p>It works, every method get <tt class="docutils literal"><span class="pre">request</span></tt> object.</p>
</div>
<div class="section" id="action-level">
<h3>Action level<a class="headerlink" href="#action-level" title="Permalink to this headline">¶</a></h3>
<p>You can add <tt class="docutils literal"><span class="pre">_extra_kwargs</span></tt> method for action class. It works like router level:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TricksTwoApiClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">func3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Msg</span><span class="p">(</span><span class="s">u&#39;func3&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extra_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&#39;request&#39;</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span>
            <span class="s">&#39;user&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="method-level">
<h3>Method level<a class="headerlink" href="#method-level" title="Permalink to this headline">¶</a></h3>
<p>You can add <tt class="docutils literal"><span class="pre">_extra_kwargs</span></tt> attribute for method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">extra_kwargs</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;request&#39;</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span>
        <span class="s">&#39;user&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">TricksThreeApiClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">func4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Msg</span><span class="p">(</span><span class="s">u&#39;func4&#39;</span><span class="p">)</span>

    <span class="n">func4</span><span class="o">.</span><span class="n">_extra_kwargs</span> <span class="o">=</span> <span class="n">extra_kwargs</span>
</pre></div>
</div>
<p>Or you can use <a class="reference internal" href="../api/decorators.html#djangorpc.decorators.add_request_to_kwargs" title="djangorpc.decorators.add_request_to_kwargs"><tt class="xref py py-func docutils literal"><span class="pre">add_request_to_kwargs()</span></tt></a> decorator.</p>
</div>
</div>
<div class="section" id="rpcexceptionevent">
<h2>RpcExceptionEvent<a class="headerlink" href="#rpcexceptionevent" title="Permalink to this headline">¶</a></h2>
<p>To raise <cite>exception</cite> event in client, you can use <a class="reference internal" href="../api/exceptions.html#djangorpc.exceptions.RpcExceptionEvent" title="djangorpc.exceptions.RpcExceptionEvent"><tt class="xref py py-class docutils literal"><span class="pre">RpcExceptionEvent</span></tt></a>.
For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TricksThreeApiClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">func6</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">RpcExceptionEvent</span><span class="p">(</span><span class="s">&#39;Login please!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>and catch it with javascript:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">jQuery</span><span class="p">.</span><span class="nx">Rpc</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;exception&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Error during RPC request: &#39;</span><span class="o">+</span><span class="nx">event</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>For required login you use decorator <a class="reference internal" href="../api/decorators.html#djangorpc.decorators.login_required" title="djangorpc.decorators.login_required"><tt class="xref py py-func docutils literal"><span class="pre">login_required()</span></tt></a>.</p>
</div>
<div class="section" id="passing-arguments-from-url">
<h2>Passing arguments from URL<a class="headerlink" href="#passing-arguments-from-url" title="Permalink to this headline">¶</a></h2>
<p>TBD</p>
</div>
<div class="section" id="pre-execute">
<h2>_pre_execute<a class="headerlink" href="#pre-execute" title="Permalink to this headline">¶</a></h2>
<p>TBD</p>
</div>
<div class="section" id="turn-off-butch">
<h2>Turn off butch<a class="headerlink" href="#turn-off-butch" title="Permalink to this headline">¶</a></h2>
<p>TBD</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Part 4: Useful tricks</a><ul>
<li><a class="reference internal" href="#passing-extra-arguments">Passing extra arguments</a><ul>
<li><a class="reference internal" href="#router-level">Router level</a></li>
<li><a class="reference internal" href="#action-level">Action level</a></li>
<li><a class="reference internal" href="#method-level">Method level</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rpcexceptionevent">RpcExceptionEvent</a></li>
<li><a class="reference internal" href="#passing-arguments-from-url">Passing arguments from URL</a></li>
<li><a class="reference internal" href="#pre-execute">_pre_execute</a></li>
<li><a class="reference internal" href="#turn-off-butch">Turn off butch</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="part3.html"
                        title="previous chapter">Part 3: Javascript API</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../api/index.html"
                        title="next chapter">API Guide</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/tutorial/part4.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../api/index.html" title="API Guide"
             >next</a> |</li>
        <li class="right" >
          <a href="part3.html" title="Part 3: Javascript API"
             >previous</a> |</li>
        <li><a href="../index.html">Django RPC 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Tutorial</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Dmitriy Kostochko.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>