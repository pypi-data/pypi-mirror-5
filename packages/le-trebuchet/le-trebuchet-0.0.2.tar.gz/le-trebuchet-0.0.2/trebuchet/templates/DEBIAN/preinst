#!/bin/bash

# create user if not exist
USER="hero"

if ! id -u $USER >/dev/null 2>&1; then
    echo "user does not exist"
    useradd --create-home --shell /bin/bash $USER
fi


# create folders if not exist
CORE_DIRS="/var/log/trebuchet /opt/trebuchet /etc/trebuchet"

for dir in $CORE_DIRS; do
    if [ ! -d $dir ]; then
        mkdir -p $dir
    fi
    chown -R ${USER} $dir
done


# stop the services (if running)
{% for package in package_service_dependencies %}
initctl emit {{ package | upper }}_STOP_ALL
{% endfor %}

{% if settings.debian_scripts and settings.debian_scripts.preinst %}
{% for script in settings.debian_scripts.preinst %}
{{ script }}
{% endfor %}
{% endif %}