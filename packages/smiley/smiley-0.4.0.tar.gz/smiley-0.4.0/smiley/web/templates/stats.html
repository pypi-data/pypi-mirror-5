<%inherit file="layout.html" />

<%! from pprint import pformat %>
<%! from smiley.web.syntax import syntax %>

<div class="page-header">
  <ul class="breadcrumb">
    <li><a href="/runs">Runs</a> <span class="divider">|</span></li>
    <li><a href="/runs/${run_id}">${run_id}</a></li>
    <li class="active">Stats</li>
  </ul>
  <table class="table">
    <tr><th>CWD</th><td>${run.cwd}</td></tr>
    <tr><th>Description</th><td>${run.description}</td></tr>
    <tr><th>Start</th><td>${run.start_time}</td></tr>
    <tr><th>End</th><td>${run.end_time}</td></tr>
% if run.error_message:
    <tr class="error"><th>Error</th><td>${run.error_message}</td></tr>
% endif
  </table>
</div>

<div class="row-fluid">
  <div id="content" class="span12">
    <ul class="nav nav-pills">
      <li><a href="/runs/${run_id}">Details</a></li>
      <li><a href="/runs/${run_id}/files">Files</a></li>
      <li class="active"><a href="/runs/${run_id}/stats">Stats</a></li>
    </ul>
  </div>
</div>

% if run.stats:
<div class="row-fluid">
  <div id="content" class="span12">
    <table class="table">
      <tr><th>Function calls</th><td>${run.stats.total_calls}</td></tr>
% if run.stats.total_calls != run.stats.prim_calls:
      <tr><th>Primitive calls</th><td>${run.stats.prim_calls}</td></tr>
% endif
      <tr><th>Total time</th><td>${run.stats.total_tt}</td></tr>
    </table>
  </div>
</div>

<div class="row-fluid">
  <div id="content" class="span12">

    <table class="table table-striped table-condensed stats-table">
      <thead>
        <tr>
          <th>ncalls</th>
          <th>tottime</th>
          <th>percall</th>
          <th>cumtime</th>
          <th>percall</th>
          <th>function</th>
          <th>filename</th>
          <th>lineno</th>
        </tr>
      </thead>
      <tbody>
% for s in stats_data:
        <tr>
          <td style="text-align: right">${s['ncalls']}</td>
          <td>${'%8.3f' % s['tottime']}</td>
          <td>${'%8.3f' % s['percall_nc']}</td>
          <td>${'%8.3f' % s['cumtime']}</td>
          <td>${'%8.3f' % s['percall_cc']}</td>
          <td class="text">${s['function']}</td>
          <td class="text">
% if s['file_url']:
            <a href="/runs/${run_id}/files/${getfileid(filename=s['filename'])}">${s['filename']|self.display_filename}</a>
% else:
            ${s['filename']|self.display_filename}
% endif
          </td>
          <td>${s['lineno']}</td>
        </tr>
% endfor        
      </tbody>
    </table>

  </div>
</div>
% else:
<div class="row-fluid">
  <div id="content" class="span12">
    <p>No profile data was collected.</p>
  </div>
</div>
% endif

<%def name="style()">
    <link href="/css/stats.css" rel="stylesheet">
</%def>
