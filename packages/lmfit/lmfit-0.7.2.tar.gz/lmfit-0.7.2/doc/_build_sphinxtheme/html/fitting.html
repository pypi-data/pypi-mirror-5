

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Performing Fits, Analyzing Outputs &mdash; Least-Squares Minimization with Constraints for Python</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Least-Squares Minimization with Constraints for Python" href="index.html" />
    <link rel="next" title="Calculation of confidence intervals" href="confidence.html" />
    <link rel="prev" title="Getting started with Non-Linear Least-Squares Fitting" href="parameters.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="confidence.html" title="Calculation of confidence intervals"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="parameters.html" title="Getting started with Non-Linear Least-Squares Fitting"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Least-Squares Minimization with Constraints for Python</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Performing Fits, Analyzing Outputs</a><ul>
<li><a class="reference internal" href="#the-minimize-function">The <tt class="docutils literal"><span class="pre">minimize()</span></tt> function</a></li>
<li><a class="reference internal" href="#writing-a-fitting-function">Writing a Fitting Function</a></li>
<li><a class="reference internal" href="#choosing-different-fitting-methods">Choosing Different Fitting Methods</a></li>
<li><a class="reference internal" href="#goodness-of-fit-and-estimated-uncertainty-and-correlations">Goodness-of-Fit and estimated uncertainty and correlations</a></li>
<li><a class="reference internal" href="#using-the-minimizer-class">Using the <tt class="docutils literal"><span class="pre">Minimizer</span></tt> class</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="parameters.html"
                        title="previous chapter">Getting started with Non-Linear Least-Squares Fitting</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="confidence.html"
                        title="next chapter">Calculation of confidence intervals</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/fitting.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="performing-fits-analyzing-outputs">
<h1>Performing Fits, Analyzing Outputs<a class="headerlink" href="#performing-fits-analyzing-outputs" title="Permalink to this headline">¶</a></h1>
<p>As shown in the previous sections, a simple fit can be performed with
the <a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a> function.    For more sophisticated modeling,
the <a class="reference internal" href="#Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> class can be used to gain a bit more control,
especially when using complicated constraints.</p>
<div class="section" id="the-minimize-function">
<h2>The <a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a> function<a class="headerlink" href="#the-minimize-function" title="Permalink to this headline">¶</a></h2>
<p>The minimize function takes a function to minimize, a dictionary of
<a class="reference internal" href="parameters.html#Parameter" title="Parameter"><tt class="xref py py-class docutils literal"><span class="pre">Parameter</span></tt></a> , and several optional arguments.    See
<a class="reference internal" href="#fit-func-label"><em>Writing a Fitting Function</em></a> for details on writing the function to minimize.</p>
<dl class="function">
<dt id="minimize">
<tt class="descname">minimize</tt><big>(</big><em>function</em>, <em>params</em>, <em>args=None</em>, <em>kws=None</em>, <em>method='leastsq'</em>, <em>**leastsq_kws</em><big>)</big><a class="headerlink" href="#minimize" title="Permalink to this definition">¶</a></dt>
<dd><p>find values for the params so that the sum-of-squares of the returned array
from function is minimized.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>function</strong> (<em>callable.</em>) -- function to return fit residual.  See <a class="reference internal" href="#fit-func-label"><em>Writing a Fitting Function</em></a> for details.</li>
<li><strong>params</strong> (<em>dict</em>) -- a dictionary of Parameters.  Keywords must be strings
that match <tt class="docutils literal"><span class="pre">[a-z_][a-z0-9_]*</span></tt> and is not a python
reserved word.  Each value must be <a class="reference internal" href="parameters.html#Parameter" title="Parameter"><tt class="xref py py-class docutils literal"><span class="pre">Parameter</span></tt></a>.</li>
<li><strong>args</strong> (<em>tuple</em>) -- arguments tuple to pass to the residual function as  positional arguments.</li>
<li><strong>kws</strong> (<em>dict</em>) -- dictionary to pass to the residual function as keyword arguments.</li>
<li><strong>method</strong> (<em>string</em>) -- name of fitting method to use. See  <a class="reference internal" href="#fit-engines-label"><em>Choosing Different Fitting Methods</em></a> for details</li>
<li><strong>leastsq_kws</strong> (<em>dict</em>) -- dictionary to pass to scipy.optimize.leastsq</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Minimizer object, which can be used to inspect goodness-of-fit
statistics, or to re-run fit.</p>
</td>
</tr>
</tbody>
</table>
<p>For backward compatibility, the keyword <cite>engine</cite> is retained as a synonym for <cite>method</cite>,
but this should be considered depracated.</p>
<p>On output, the params will be updated with best-fit values and, where
appropriate, estimated uncertainties and correlations.  See
<a class="reference internal" href="#fit-results-label"><em>Goodness-of-Fit and estimated uncertainty and correlations</em></a> for further details.</p>
</dd></dl>

</div>
<div class="section" id="writing-a-fitting-function">
<span id="fit-func-label"></span><h2>Writing a Fitting Function<a class="headerlink" href="#writing-a-fitting-function" title="Permalink to this headline">¶</a></h2>
<p>An important component of a fit is writing a function to be minimized in
the least-squares sense.   Since this function will be called by other
routines, there are fairly stringent requirements for its call signature
and return value.   In principle, your function can be any python callable,
but it must look like this:</p>
<dl class="function">
<dt>
<tt class="descname">func(params, *args, **kws):</tt></dt>
<dd><p>calculate objective residual to be minimized from parameters.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>params</strong> (<em>dict</em>) -- parameters.</li>
<li><strong>args</strong> -- positional arguments.  Must match <tt class="docutils literal"><span class="pre">args</span></tt> argument to <a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a></li>
<li><strong>kws</strong> -- keyword arguments.  Must match <tt class="docutils literal"><span class="pre">kws</span></tt> argument to <a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">residual array (generally data-model) to be minimized in the least-squares sense.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">numpy array.  The length of this array cannot change between calls.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>A common use for the positional and keyword arguments would be to pass in other
data needed to calculate the residual, including such things as the data array,
dependent variable, uncertainties in the data, and other data structures for the
model calculation.</p>
<p>The objective function should return the value to be minimized.  For the
Levenberg-Marquardt algorithm from <a class="reference internal" href="#leastsq" title="leastsq"><tt class="xref py py-meth docutils literal"><span class="pre">leastsq()</span></tt></a>, this returned value <strong>must</strong> be an
array, with a length greater than or equal to the number of fitting variables in the
model.  For the other methods, the return value can either be a scalar or an array.  If an
array is returned, the sum of squares of the array will be sent to the underlying fitting
method, effectively doing a least-squares optimization of the return values.</p>
<p>Since the function will be passed in a dictionary of <a class="reference internal" href="parameters.html#Parameters" title="Parameters"><tt class="xref py py-class docutils literal"><span class="pre">Parameters</span></tt></a>, it is advisable
to unpack these to get numerical values at the top of the function.  A simple example
would look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">residual</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c"># unpack parameters:</span>
    <span class="c">#  extract .value attribute for each parameter</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s">&#39;amp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s">&#39;period&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s">&#39;shift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">decay</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s">&#39;decay&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="n">sign</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span>

    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-10</span><span class="p">:</span>
        <span class="n">period</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">period</span><span class="p">)</span><span class="o">*</span><span class="mf">1.e-10</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x</span><span class="o">/</span><span class="n">period</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">decay</span><span class="o">*</span><span class="n">decay</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">model</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">model</span> <span class="o">-</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, <tt class="docutils literal"><span class="pre">x</span></tt> is a positional (required) argument, while the <tt class="docutils literal"><span class="pre">data</span></tt>
array is actually optional (so that the function returns the model calculation
if the data is neglected).   Also note that the model calculation will divide
<tt class="docutils literal"><span class="pre">x</span></tt> by the varied value of the 'period' Parameter.  It might be wise to
make sure this parameter cannot be 0.   It would be possible to use the bounds
on the <a class="reference internal" href="parameters.html#Parameter" title="Parameter"><tt class="xref py py-class docutils literal"><span class="pre">Parameter</span></tt></a> to do this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">params</span><span class="p">[</span><span class="s">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1.e-10</span><span class="p">)</span>
</pre></div>
</div>
<p>but might be wiser to put this directly in the function with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-10</span><span class="p">:</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">period</span><span class="p">)</span><span class="o">*</span><span class="mf">1.e-10</span>
</pre></div>
</div>
</div>
<div class="section" id="choosing-different-fitting-methods">
<span id="fit-engines-label"></span><h2>Choosing Different Fitting Methods<a class="headerlink" href="#choosing-different-fitting-methods" title="Permalink to this headline">¶</a></h2>
<p>By default, the <a class="reference external" href="http://en.wikipedia.org/wiki/Levenberg-Marquardt_algorithm">Levenberg-Marquardt</a> algorithm is
used for fitting.  While often criticized, including the fact it finds a
<em>local</em> minima, this approach has some distinct advantages.  These include
being fast, and well-behaved for most curve-fitting needs, and making it
easy to estimate uncertainties for and correlations between pairs of fit
variables, as discussed in <a class="reference internal" href="#fit-results-label"><em>Goodness-of-Fit and estimated uncertainty and correlations</em></a>.</p>
<p>Alternative algorithms can also be used. These include <a class="reference external" href="http://en.wikipedia.org/wiki/Simulated_annealing">simulated annealing</a> which promises a
better ability to avoid local minima, and <a class="reference external" href="http://en.wikipedia.org/wiki/Limited-memory_BFGS">BFGS</a>, which is a
modification of the quasi-Newton method.</p>
<p>To select which of these algorithms to use, use the <tt class="docutils literal"><span class="pre">method</span></tt> keyword to the
<a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a> function or use the corresponding method name from the
<a class="reference internal" href="#Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> class as listed in the
<a class="reference internal" href="#fit-engine-table"><em>Table of Supported Fitting Methods</em></a>.</p>
<blockquote id="fit-engine-table">
<div><p>Table of Supported Fitting Methods:</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="22%" />
<col width="24%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Fitting
Method</th>
<th class="head"><tt class="docutils literal"><span class="pre">method</span></tt> arg to
<a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a></th>
<th class="head"><a class="reference internal" href="#Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a>
method</th>
<th class="head"><tt class="docutils literal"><span class="pre">method</span></tt> arg to
<a class="reference internal" href="#scalar_minimize" title="scalar_minimize"><tt class="xref py py-meth docutils literal"><span class="pre">scalar_minimize()</span></tt></a></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Levenberg-Marquardt</td>
<td><tt class="docutils literal"><span class="pre">leastsq</span></tt></td>
<td><a class="reference internal" href="#leastsq" title="leastsq"><tt class="xref py py-meth docutils literal"><span class="pre">leastsq()</span></tt></a></td>
<td>Not available</td>
</tr>
<tr class="row-odd"><td>Nelder-Mead</td>
<td><tt class="docutils literal"><span class="pre">nelder</span></tt></td>
<td><a class="reference internal" href="#fmin" title="fmin"><tt class="xref py py-meth docutils literal"><span class="pre">fmin()</span></tt></a></td>
<td><tt class="docutils literal"><span class="pre">Nelder-Mead</span></tt></td>
</tr>
<tr class="row-even"><td>L-BFGS-B</td>
<td><tt class="docutils literal"><span class="pre">lbfgsb</span></tt></td>
<td><a class="reference internal" href="#lbfgsb" title="lbfgsb"><tt class="xref py py-meth docutils literal"><span class="pre">lbfgsb()</span></tt></a></td>
<td><tt class="docutils literal"><span class="pre">L-BFGS-B</span></tt></td>
</tr>
<tr class="row-odd"><td>Simulated Annealing</td>
<td><tt class="docutils literal"><span class="pre">anneal</span></tt></td>
<td><a class="reference internal" href="#anneal" title="anneal"><tt class="xref py py-meth docutils literal"><span class="pre">anneal()</span></tt></a></td>
<td><tt class="docutils literal"><span class="pre">Anneal</span></tt></td>
</tr>
<tr class="row-even"><td>Powell</td>
<td><tt class="docutils literal"><span class="pre">powell</span></tt></td>
<td>&nbsp;</td>
<td><tt class="docutils literal"><span class="pre">Powell</span></tt></td>
</tr>
<tr class="row-odd"><td>Conjugate Gradient</td>
<td><tt class="docutils literal"><span class="pre">cg</span></tt></td>
<td>&nbsp;</td>
<td><tt class="docutils literal"><span class="pre">CG</span></tt></td>
</tr>
<tr class="row-even"><td>Newtown-CG</td>
<td><tt class="docutils literal"><span class="pre">newton</span></tt></td>
<td>&nbsp;</td>
<td><tt class="docutils literal"><span class="pre">Newton-CG</span></tt></td>
</tr>
<tr class="row-odd"><td>COBYLA</td>
<td><tt class="docutils literal"><span class="pre">cobyla</span></tt></td>
<td>&nbsp;</td>
<td><tt class="docutils literal"><span class="pre">COBYLA</span></tt></td>
</tr>
<tr class="row-even"><td>Sequential Linear
Squares Programming</td>
<td><tt class="docutils literal"><span class="pre">slsqp</span></tt></td>
<td>&nbsp;</td>
<td><tt class="docutils literal"><span class="pre">SLSQP</span></tt></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use of <tt class="xref py py-meth docutils literal"><span class="pre">scipy.optimize.minimize()</span></tt> requires scipy 0.11 or higher.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The objective function for the Levenberg-Marquardt method <strong>must</strong> return an array,
with more elements than variables.  All other methods can return either a scalar value
or an array.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The Levenberg-Marquardt method is <em>by far</em> the most tested fit method,
and much of this documentation assumes that this is the method used.  For
example, many of the fit statistics and estimates for uncertainties in
parameters discussed in <a class="reference internal" href="#fit-results-label"><em>Goodness-of-Fit and estimated uncertainty and correlations</em></a> are done only for the
<tt class="docutils literal"><span class="pre">leastsq</span></tt> method.</p>
</div>
<p>In particular, the simulated annealing method appears to not work
correctly.... understanding this is on the ToDo list.</p>
</div>
<div class="section" id="goodness-of-fit-and-estimated-uncertainty-and-correlations">
<span id="fit-results-label"></span><h2>Goodness-of-Fit and estimated uncertainty and correlations<a class="headerlink" href="#goodness-of-fit-and-estimated-uncertainty-and-correlations" title="Permalink to this headline">¶</a></h2>
<p>On a successful fit using the <cite>leastsq</cite> method, several goodness-of-fit
statistics and values related to the uncertainty in the fitted variables will be
calculated.  These are all encapsulated in the <a class="reference internal" href="#Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> object for the
fit, as returned by <a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a>.  The values related to the entire fit are
stored in attributes of the <a class="reference internal" href="#Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> object, as shown in <a class="reference internal" href="#goodfit-table"><em>Table
of Fit Results</em></a> while those related to each fitted variables are
stored as attributes of the corresponding <a class="reference internal" href="parameters.html#Parameter" title="Parameter"><tt class="xref py py-class docutils literal"><span class="pre">Parameter</span></tt></a>.</p>
<blockquote id="goodfit-table">
<div>Table of Fit Results:  These values, including the standard Goodness-of-Fit statistics,
are all attributes of the <a class="reference internal" href="#Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> object returned by <a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a>.</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><a class="reference internal" href="#Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a>
Attribute</th>
<th class="head">Description / Formula</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>nfev</td>
<td>number of function evaluations</td>
</tr>
<tr class="row-odd"><td>success</td>
<td>boolean (<tt class="docutils literal"><span class="pre">True</span></tt>/<tt class="docutils literal"><span class="pre">False</span></tt>) for whether fit succeeded.</td>
</tr>
<tr class="row-even"><td>errorbars</td>
<td>boolean (<tt class="docutils literal"><span class="pre">True</span></tt>/<tt class="docutils literal"><span class="pre">False</span></tt>) for whether uncertainties were estimated.</td>
</tr>
<tr class="row-odd"><td>message</td>
<td>message about fit success.</td>
</tr>
<tr class="row-even"><td>ier</td>
<td>integer error value from scipy.optimize.leastsq</td>
</tr>
<tr class="row-odd"><td>lmdif_message</td>
<td>message from scipy.optimize.leastsq</td>
</tr>
<tr class="row-even"><td>nvarys</td>
<td>number of variables in fit  <img class="math" src="_images/math/9c67908b81133366b1b38f30fd7194f1bbd83b04.png" alt="N_{\rm varys}"/></td>
</tr>
<tr class="row-odd"><td>ndata</td>
<td>number of data points:  <img class="math" src="_images/math/fc97ef67268cd4e91bacdf12b8901d7036c9a056.png" alt="N"/></td>
</tr>
<tr class="row-even"><td>nfree `</td>
<td>degrees of freedom in fit:  <img class="math" src="_images/math/373c4bb33c40cda719bf67cfffab2fffd862eed1.png" alt="N - N_{\rm varys}"/></td>
</tr>
<tr class="row-odd"><td>residual</td>
<td>residual array (return of <tt class="xref py py-func docutils literal"><span class="pre">func()</span></tt>:  <img class="math" src="_images/math/b66aa1fe66958e09a90fda9742f8e0fe3fbe6695.png" alt="{\rm Resid}"/></td>
</tr>
<tr class="row-even"><td>chisqr</td>
<td>chi-square: <img class="math" src="_images/math/aba2739fd441f25640dbe529605937e1f5928adb.png" alt="\chi^2 = \sum_i^N [{\rm Resid}_i]^2"/></td>
</tr>
<tr class="row-odd"><td>redchi</td>
<td>reduced chi-square: <img class="math" src="_images/math/42c17311585fbaeea64e3b4f9bde0bcee61537ec.png" alt="\chi^2_{\nu}= {\chi^2} / {(N - N_{\rm varys})}"/></td>
</tr>
</tbody>
</table>
<p>Note that the calculation of chi-square and reduced chi-square assume that the
returned residual function is scaled properly to the uncertainties in the data.
For these statistics to be meaningful, the person writing the function to
be minimized must scale them properly.</p>
<p>After a fit using using the <a class="reference internal" href="#leastsq" title="leastsq"><tt class="xref py py-meth docutils literal"><span class="pre">leastsq()</span></tt></a> method has completed succsessfully,
standard errors for the fitted variables and correlations between pairs of
fitted variables are automatically calculated from the covariance matrix.
The standard error (estimated <img class="math" src="_images/math/070fe743455ad95e644411607dc18d8e72f1d23f.png" alt="1\sigma"/> error-bar) go into the
<a class="reference internal" href="parameters.html#stderr" title="stderr"><tt class="xref py py-attr docutils literal"><span class="pre">stderr</span></tt></a> attribute of the Parameter.  The correlations with all other
variables will be put into the <a class="reference internal" href="parameters.html#correl" title="correl"><tt class="xref py py-attr docutils literal"><span class="pre">correl</span></tt></a> attribute of the Parameter --
a dictionary with keys for all other Parameters and values of the
corresponding correlation.</p>
<p>In some cases, it may not be possible to estimate the errors and
correlations.  For example, if a variable actually has no practical effect
on the fit, it will likely cause the covariance matrix to be singular,
making standard errors impossible to estimate.  Placing bounds on varied
Parameters makes it more likely that errors cannot be estimated, as being
near the maximum or minimum value makes the covariance matrix singular.  In
these cases, the <tt class="xref py py-attr docutils literal"><span class="pre">errorbars</span></tt> attribute of the fit result
(<a class="reference internal" href="#Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> object) will be <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
</div>
<div class="section" id="using-the-minimizer-class">
<span id="fit-minimizer-label"></span><h2>Using the <a class="reference internal" href="#Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> class<a class="headerlink" href="#using-the-minimizer-class" title="Permalink to this headline">¶</a></h2>
<p>For full control of the fitting process, you'll want to create a
<a class="reference internal" href="#Minimizer" title="Minimizer"><tt class="xref py py-class docutils literal"><span class="pre">Minimizer</span></tt></a> object, or at least use the one returned from the
<a class="reference internal" href="#minimize" title="minimize"><tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt></a> function.</p>
<dl class="class">
<dt id="Minimizer">
<em class="property">class </em><tt class="descname">Minimizer</tt><big>(</big><em>function</em>, <em>params</em>, <em>fcn_args=None</em>, <em>fcn_kws=None</em>, <em>iter_cb=None</em>, <em>scale_covar=True</em>, <em>**kws</em><big>)</big><a class="headerlink" href="#Minimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>creates a Minimizer, for fine-grain access to fitting methods and attributes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>function</strong> (<em>callable.</em>) -- objective function to return fit residual.  See <a class="reference internal" href="#fit-func-label"><em>Writing a Fitting Function</em></a> for details.</li>
<li><strong>params</strong> (<em>dict</em>) -- a dictionary of Parameters.  Keywords must be strings
that match <tt class="docutils literal"><span class="pre">[a-z_][a-z0-9_]*</span></tt> and is not a python
reserved word.  Each value must be <a class="reference internal" href="parameters.html#Parameter" title="Parameter"><tt class="xref py py-class docutils literal"><span class="pre">Parameter</span></tt></a>.</li>
<li><strong>fcn_args</strong> (<em>tuple</em>) -- arguments tuple to pass to the residual function as  positional arguments.</li>
<li><strong>fcn_kws</strong> (<em>dict</em>) -- dictionary to pass to the residual function as keyword arguments.</li>
<li><strong>iter_cb</strong> (callable or <tt class="docutils literal"><span class="pre">None</span></tt>) -- function to be called at each fit iteration</li>
<li><strong>scale_covar</strong> -- flag for scaling covariance matrix and uncertainties to reduced chi-square (<tt class="docutils literal"><span class="pre">leastsq</span></tt> only)</li>
<li><strong>kws</strong> (<em>dict</em>) -- dictionary to pass as keywords to the underlying scipy.optimize method.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Minimizer object, which can be used to inspect goodness-of-fit
statistics, or to re-run fit.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>The Minimizer object has a few public methods:</p>
<dl class="method">
<dt id="leastsq">
<tt class="descname">leastsq</tt><big>(</big><em>scale_covar=True</em>, <em>**kws</em><big>)</big><a class="headerlink" href="#leastsq" title="Permalink to this definition">¶</a></dt>
<dd><p>perform fit with Levenberg-Marquardt algorithm.  Keywords will be passed directly to
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.leastsq.html">scipy.optimize.leastsq</a>.
By default, numerical derivatives are used, and the following arguments are set:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="17%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><a class="reference internal" href="#leastsq" title="leastsq"><tt class="xref py py-meth docutils literal"><span class="pre">leastsq()</span></tt></a>
arg</th>
<th class="head">Default Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>xtol</td>
<td>1.e-7</td>
<td>Relative error in the approximate solution</td>
</tr>
<tr class="row-odd"><td>ftol</td>
<td>1.e-7</td>
<td>Relative error in the desired sum of squares</td>
</tr>
<tr class="row-even"><td>maxfev</td>
<td>2000*(nvar+1)</td>
<td>maximum number of function calls (nvar= # of variables)</td>
</tr>
<tr class="row-odd"><td>Dfun</td>
<td><tt class="docutils literal"><span class="pre">None</span></tt></td>
<td>function to call for Jacobian calculation</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="anneal">
<tt class="descname">anneal</tt><big>(</big><em>**kws</em><big>)</big><a class="headerlink" href="#anneal" title="Permalink to this definition">¶</a></dt>
<dd><p>perform fit with Simulated Annealing.  Keywords will be passed directly to
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.anneal.html">scipy.optimize.anneal</a>.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="17%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><a class="reference internal" href="#anneal" title="anneal"><tt class="xref py py-meth docutils literal"><span class="pre">anneal()</span></tt></a>
arg</th>
<th class="head">Default Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>schedule</td>
<td><tt class="docutils literal"><span class="pre">cauchy</span></tt></td>
<td>annealing schedule</td>
</tr>
<tr class="row-odd"><td>maxiter</td>
<td>2000*(nvar+1)</td>
<td>maximum number of iterations</td>
</tr>
</tbody>
</table>
<p>For me, this Simulated Annealing appears to never work.</p>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="lbfgsb">
<tt class="descname">lbfgsb</tt><big>(</big><em>**kws</em><big>)</big><a class="headerlink" href="#lbfgsb" title="Permalink to this definition">¶</a></dt>
<dd><p>perform fit with L-BFGS-B algorithm.  Keywords will be passed directly to
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.fmin_l_bfgs_b.html">scipy.optimize.fmin_l_bfgs_b</a>.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="17%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><a class="reference internal" href="#lbfgsb" title="lbfgsb"><tt class="xref py py-meth docutils literal"><span class="pre">lbfgsb()</span></tt></a>
arg</th>
<th class="head">Default Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>factr</td>
<td>1000.0</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>approx_grad</td>
<td><tt class="docutils literal"><span class="pre">True</span></tt></td>
<td>calculate approximations of gradient</td>
</tr>
<tr class="row-even"><td>maxfun</td>
<td>2000*(nvar+1)</td>
<td>maximum number of function calls (nvar= # of variables)</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="fmin">
<tt class="descname">fmin</tt><big>(</big><em>**kws</em><big>)</big><a class="headerlink" href="#fmin" title="Permalink to this definition">¶</a></dt>
<dd><p>perform fit with Nelder-Mead downhill simplex algorithm.  Keywords will be passed directly to
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.fmin.html">scipy.optimize.fmin</a>.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="17%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><a class="reference internal" href="#fmin" title="fmin"><tt class="xref py py-meth docutils literal"><span class="pre">fmin()</span></tt></a>
arg</th>
<th class="head">Default Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ftol</td>
<td>1.e-4</td>
<td>function tolerance</td>
</tr>
<tr class="row-odd"><td>xtol</td>
<td>1.e-4</td>
<td>parameter tolerance</td>
</tr>
<tr class="row-even"><td>maxfun</td>
<td>5000*(nvar+1)</td>
<td>maximum number of function calls (nvar= # of variables)</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="scalar_minimize">
<tt class="descname">scalar_minimize</tt><big>(</big><em>method='Nelder-Mead'</em>, <em>hess=None</em>, <em>tol=None</em>, <em>**kws</em><big>)</big><a class="headerlink" href="#scalar_minimize" title="Permalink to this definition">¶</a></dt>
<dd><p>perform fit with any of the scalar minimimization algorithms supported by
<a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html">scipy.optimize.minimize</a>.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="18%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><a class="reference internal" href="#scalar_minimize" title="scalar_minimize"><tt class="xref py py-meth docutils literal"><span class="pre">scalar_minimize()</span></tt></a>
arg</th>
<th class="head">Default Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>method</td>
<td><tt class="docutils literal"><span class="pre">Nelder-Mead</span></tt></td>
<td>fitting method</td>
</tr>
<tr class="row-odd"><td>tol</td>
<td>1.e-7</td>
<td>fitting and parameter tolerance</td>
</tr>
<tr class="row-even"><td>hess</td>
<td>None</td>
<td>Hessian of objective function</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="prepare_fit">
<tt class="descname">prepare_fit</tt><big>(</big><em>**kws</em><big>)</big><a class="headerlink" href="#prepare_fit" title="Permalink to this definition">¶</a></dt>
<dd><p>prepares and initializes model and Parameters for subsequent
fitting. This routine prepares the conversion of <a class="reference internal" href="parameters.html#Parameters" title="Parameters"><tt class="xref py py-class docutils literal"><span class="pre">Parameters</span></tt></a>
into fit variables, organizes parameter bounds, and parses, checks and
&quot;compiles&quot; constrain expressions.</p>
<p>This is called directly by the fitting methods, and it is generally not
necessary to call this function explicitly.  An exception is when you
would like to call your function to minimize prior to running one of the
minimization routines, for example, to calculate the initial residual
function.  In that case, you might want to do something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">myfit</span> <span class="o">=</span> <span class="n">Minimizer</span><span class="p">(</span><span class="n">my_residual</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span>  <span class="n">fcn_args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,),</span> <span class="n">fcn_kws</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;data&#39;</span><span class="p">:</span><span class="n">data</span><span class="p">})</span>

<span class="n">myfit</span><span class="o">.</span><span class="n">prepare_fit</span><span class="p">()</span>
<span class="n">init</span> <span class="o">=</span> <span class="n">my_residual</span><span class="p">(</span><span class="n">p_fit</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="s">&#39;b--&#39;</span><span class="p">)</span>

<span class="n">myfit</span><span class="o">.</span><span class="n">leastsq</span><span class="p">()</span>
</pre></div>
</div>
<p>That is, this method should be called prior to your fitting function being called.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="confidence.html" title="Calculation of confidence intervals"
             >next</a> |</li>
        <li class="right" >
          <a href="parameters.html" title="Getting started with Non-Linear Least-Squares Fitting"
             >previous</a> |</li>
        <li><a href="index.html">Least-Squares Minimization with Constraints for Python</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Matthew Newville, The University of Chicago,  Till Stensitzki, Freie Universitat Berlin.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>