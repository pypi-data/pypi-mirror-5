<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Programming API &mdash; Tallywallet manual v0.002</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.002',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Tallywallet manual v0.002" href="index.html" />
    <link rel="prev" title="Tallywallet - a Money framework in Python" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="index.html" title="Tallywallet - a Money framework in Python"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Tallywallet manual v0.002</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Programming API</a><ul>
<li><a class="reference internal" href="#module-tallywallet.common.currency">Currency</a></li>
<li><a class="reference internal" href="#trade">Trade</a></li>
<li><a class="reference internal" href="#module-tallywallet.common.exchange">Exchange</a></li>
<li><a class="reference internal" href="#module-tallywallet.common.ledger">Ledger</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example">Example</a><ul>
<li><a class="reference internal" href="#jan-1">Jan 1</a></li>
<li><a class="reference internal" href="#jan-2">Jan 2</a></li>
<li><a class="reference internal" href="#jan-3">Jan 3</a></li>
<li><a class="reference internal" href="#jan-5">Jan 5</a></li>
<li><a class="reference internal" href="#jan-7">Jan 7</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Tallywallet - a Money framework in Python</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/api.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="programming-api">
<h1>Programming API<a class="headerlink" href="#programming-api" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-tallywallet.common.currency">
<span id="currency"></span><h2>Currency<a class="headerlink" href="#module-tallywallet.common.currency" title="Permalink to this headline">¶</a></h2>
<p>The currency module defines currencies of various types. As of this
release, there are only a handful yet defined.</p>
<dl class="class">
<dt id="tallywallet.common.currency.Currency">
<em class="property">class </em><tt class="descclassname">tallywallet.common.currency.</tt><tt class="descname">Currency</tt><a class="reference internal" href="_modules/tallywallet/common/currency.html#Currency"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.currency.Currency" title="Permalink to this definition">¶</a></dt>
<dd><p>This is an enumeration class which captures the codes defined in
<a class="reference external" href="http://en.wikipedia.org/wiki/ISO_4217">ISO 4217</a> for international currencies.</p>
</dd></dl>

</div>
<div class="section" id="trade">
<h2>Trade<a class="headerlink" href="#trade" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="tallywallet.common.trade.TradePath">
<em class="property">class </em><tt class="descclassname">tallywallet.common.trade.</tt><tt class="descname">TradePath</tt><a class="headerlink" href="#tallywallet.common.trade.TradePath" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>TradePath(rcv, work, out)</cite></p>
<p>A 3-tuple of <a class="reference internal" href="#currency">Currency</a> objects, describing the path of a foreign
exchange trade. The first element is the source currency, the second the
reference currency of the account, and the third the destination currency.</p>
</dd></dl>

<dl class="class">
<dt id="tallywallet.common.trade.TradeGain">
<em class="property">class </em><tt class="descclassname">tallywallet.common.trade.</tt><tt class="descname">TradeGain</tt><a class="headerlink" href="#tallywallet.common.trade.TradeGain" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>TradeGain(rcv, gain, out)</cite></p>
<p>A 3-tuple of numerical values, describing the result of a change in foreign
exchange rates. The first element is the value due to the prior rate, the
second is the gain due to the rate change, and the third element is the final
sum.</p>
</dd></dl>

</div>
<div class="section" id="module-tallywallet.common.exchange">
<span id="exchange"></span><h2>Exchange<a class="headerlink" href="#module-tallywallet.common.exchange" title="Permalink to this headline">¶</a></h2>
<p>The exchange module contains functionality to enable conversion between
currencies.</p>
<dl class="class">
<dt id="tallywallet.common.exchange.Exchange">
<em class="property">class </em><tt class="descclassname">tallywallet.common.exchange.</tt><tt class="descname">Exchange</tt><a class="headerlink" href="#tallywallet.common.exchange.Exchange" title="Permalink to this definition">¶</a></dt>
<dd><p>An exchange is a lookup container for currency exchange rates.</p>
<p>It behaves just like a Python dictionary, but has some extra methods.</p>
<p>The approach Tallywallet uses is to associate each rate against a key
which is a 2-tuple of <a class="reference internal" href="#currency">Currency</a>.
By convention, the first element of this key is the source currency,
and the second is the destination. The values of the exchange mapping can
therefore be considered as <cite>gain</cite> from one currency to the next.</p>
<dl class="method">
<dt id="tallywallet.common.exchange.Exchange.get">
<tt class="descname">get</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#tallywallet.common.exchange.Exchange.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the value stored against <cite>key</cite>.</p>
<p>This method overrides the standard behaviour of <cite>dict.get</cite>. It infers the
values of missing keys as follows:</p>
<blockquote>
<div><ul class="simple">
<li>The rate of a currency against itself is unity.</li>
<li>The rate of one currency against another is the reciprocal of the
reverse rate (if defined).</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="tallywallet.common.exchange.Exchange.convert">
<tt class="descname">convert</tt><big>(</big><em>val</em>, <em>path</em>, <em>fees=TradeFees(rcv=0</em>, <em>out=0)</em><big>)</big><a class="headerlink" href="#tallywallet.common.exchange.Exchange.convert" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the calculated outcome of converting the amount <cite>val</cite>
via the TradePath <cite>path</cite>.</p>
</dd></dl>

<dl class="method">
<dt id="tallywallet.common.exchange.Exchange.gain">
<tt class="descname">gain</tt><big>(</big><em>val</em>, <em>path</em>, <em>prior=None</em>, <em>fees=TradeFees(rcv=0</em>, <em>out=0)</em><big>)</big><a class="headerlink" href="#tallywallet.common.exchange.Exchange.gain" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the gain related to a change in exchange rates.
The <cite>self</cite> object contains the latest rates, and the historic
ones are passed as an argument to this method.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>prior</strong> &#8211; An <a class="reference internal" href="#exchange">Exchange</a> object which contains the rates
existing prior to those in the <cite>self</cite> object.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TradeGain</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-tallywallet.common.ledger">
<span id="ledger"></span><h2>Ledger<a class="headerlink" href="#module-tallywallet.common.ledger" title="Permalink to this headline">¶</a></h2>
<p>The ledger module defines Ledger and some associated classes.</p>
<dl class="class">
<dt id="tallywallet.common.ledger.Role">
<em class="property">class </em><tt class="descclassname">tallywallet.common.ledger.</tt><tt class="descname">Role</tt><a class="reference internal" href="_modules/tallywallet/common/ledger.html#Role"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.ledger.Role" title="Permalink to this definition">¶</a></dt>
<dd><p>This enumeration contains definitions for the roles played by
a column in a Ledger.</p>
</dd></dl>

<dl class="class">
<dt id="tallywallet.common.ledger.Column">
<em class="property">class </em><tt class="descclassname">tallywallet.common.ledger.</tt><tt class="descname">Column</tt><a class="headerlink" href="#tallywallet.common.ledger.Column" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>Column(name, currency, role)</cite></p>
<p>A 3-tuple, describing a column in a Ledger.</p>
</dd></dl>

<dl class="class">
<dt id="tallywallet.common.ledger.Ledger">
<em class="property">class </em><tt class="descclassname">tallywallet.common.ledger.</tt><tt class="descname">Ledger</tt><big>(</big><em>ref</em>, <em>*args</em><big>)</big><a class="reference internal" href="_modules/tallywallet/common/ledger.html#Ledger"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.ledger.Ledger" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements the fundamental operations you need to perform
Adjusted Cost Base accounting.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ref</strong> &#8211; (optional) the base <a class="reference internal" href="#currency">Currency</a> type for the Ledger</li>
<li><strong>args</strong> &#8211; One or more Column objects</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="tallywallet.common.ledger.Ledger.equation">
<tt class="descname">equation</tt><a class="reference internal" href="_modules/tallywallet/common/ledger.html#Ledger.equation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.ledger.Ledger.equation" title="Permalink to this definition">¶</a></dt>
<dd><p>The <cite>Fundamental Accounting Equation</cite> is this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Assets</span> <span class="o">-</span> <span class="n">Liabilities</span> <span class="o">=</span> <span class="n">Capital</span> <span class="o">+</span> <span class="n">Income</span> <span class="o">-</span> <span class="n">Expenses</span>
</pre></div>
</div>
<p>(currency trading gains are counted as income).
For practical purposes, it is often rearranged to be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Assets</span> <span class="o">+</span> <span class="n">Expenses</span> <span class="o">=</span> <span class="n">Capital</span> <span class="o">+</span> <span class="n">Income</span> <span class="o">+</span> <span class="n">Liabilities</span>
</pre></div>
</div>
<p>This property evaluates both sides of this second equation,
and determines if they are equal or not.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A tuple of <cite>lhs</cite>, <cite>rhs</cite>, <cite>status</cite></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tallywallet.common.ledger.Ledger.adjustments">
<tt class="descname">adjustments</tt><big>(</big><em>exchange</em>, <em>cols=None</em><big>)</big><a class="headerlink" href="#tallywallet.common.ledger.Ledger.adjustments" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the effects of a change in exchange rates.</p>
<p>Supply an Exchange object and an optional sequence of columns.
If no columns are specified then all are assumed.</p>
<p>The columns are recalculated (but not committed) against the new
exchange rates.</p>
<p>This method will generate a sequence of 3-tuples;
<cite>(TradeGain, Column, Exchange)</cite>.</p>
<p>This output is compatible with the arguments accepted by the <cite>commit</cite>
method.</p>
</dd></dl>

<dl class="method">
<dt id="tallywallet.common.ledger.Ledger.commit">
<tt class="descname">commit</tt><big>(</big><em>trade</em>, <em>col</em>, <em>exchange=None</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/tallywallet/common/ledger.html#Ledger.commit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.ledger.Ledger.commit" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies a trade to the ledger.</p>
<p>If you supply an exchange argument, <cite>trade</cite> may be a TradeGain
object. In this usage, a trading account in the currency of the
ledger column will accept any exchange gain or loss.</p>
<p>Otherwise, <cite>trade</cite> should be a number. It will be added to the
specified column in the ledger.</p>
</dd></dl>

<dl class="method">
<dt id="tallywallet.common.ledger.Ledger.value">
<tt class="descname">value</tt><big>(</big><em>name</em><big>)</big><a class="reference internal" href="_modules/tallywallet/common/ledger.html#Ledger.value"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.ledger.Ledger.value" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the current value of a column in the ledger.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> &#8211; The name of the column</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="example">
<h1>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h1>
<p>This example is taken from <a class="reference external" href="http://www.mscs.dal.ca/~selinger/accounting/">Peter Selinger&#8217;s tutorial</a> on multiple currency
accounting. We&#8217;ll use a Ledger to track the transactions set out below,
which comprise both actual expenses and incurred gains/losses due to variations
in currency rates.</p>
<p>The scenario is a brief trip from Canada to the USA, which requires buying US
dollars, spending some during exchange rate fluctuations, and changing back
to Canadian money at the end.</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="24%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">date</th>
<th class="head">&nbsp;</th>
<th class="head">asset</th>
<th class="head">asset</th>
<th class="head">capital</th>
<th class="head">expense</th>
<th class="head">trading</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Jan 1</td>
<td>Opening balance</td>
<td>CAD 200</td>
<td>USD 0</td>
<td>CAD 200</td>
<td>CAD 0</td>
<td>USD 0 CAD 0</td>
</tr>
<tr class="row-odd"><td>Jan 2</td>
<td>1 USD==1.20CAD</td>
<td>CAD-120</td>
<td>USD 100</td>
<td>.</td>
<td>.</td>
<td>USD 100 CAD 120</td>
</tr>
<tr class="row-even"><td>.</td>
<td>Balance</td>
<td>CAD 80</td>
<td>USD 100</td>
<td>CAD 200</td>
<td>CAD 0</td>
<td>USD 100 CAD 120</td>
</tr>
<tr class="row-odd"><td>Jan 3</td>
<td>1 USD==1.30CAD</td>
<td>.</td>
<td>USD-40</td>
<td>.</td>
<td>CAD 52</td>
<td>USD-40 CAD 52</td>
</tr>
<tr class="row-even"><td>.</td>
<td>Balance</td>
<td>CAD 80</td>
<td>USD 60</td>
<td>CAD 200</td>
<td>CAD 52</td>
<td>USD 60 CAD-68</td>
</tr>
<tr class="row-odd"><td>Jan 5</td>
<td>1 USD==1.25CAD</td>
<td>CAD 75</td>
<td>USD-60</td>
<td>.</td>
<td>.</td>
<td>USD-60 CAD 75</td>
</tr>
<tr class="row-even"><td>.</td>
<td>Balance</td>
<td>CAD 155</td>
<td>USD 0</td>
<td>CAD 200</td>
<td>CAD 52</td>
<td>USD 0  CAD 07</td>
</tr>
<tr class="row-odd"><td>Jan 7</td>
<td>Buy food</td>
<td>CAD-20</td>
<td>.</td>
<td>.</td>
<td>CAD 20</td>
<td>.</td>
</tr>
<tr class="row-even"><td>.</td>
<td>Balance</td>
<td>CAD 135</td>
<td>USD 0</td>
<td>CAD 200</td>
<td>CAD 72</td>
<td>USD 0  CAD 07</td>
</tr>
</tbody>
</table>
<p>Throughout, we&#8217;ll assume this boilerplate:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span> <span class="k">as</span> <span class="n">Dl</span>
<span class="kn">from</span> <span class="nn">tallywallet.common.currency</span> <span class="kn">import</span> <span class="n">Currency</span> <span class="k">as</span> <span class="n">Cy</span>
<span class="kn">from</span> <span class="nn">tallywallet.common.ledger</span> <span class="kn">import</span> <span class="n">Ledger</span>
<span class="kn">from</span> <span class="nn">tallywallet.common.ledger</span> <span class="kn">import</span> <span class="n">Role</span>
</pre></div>
</div>
<div class="section" id="jan-1">
<h2>Jan 1<a class="headerlink" href="#jan-1" title="Permalink to this headline">¶</a></h2>
<p>First, we&#8217;ll establish a ledger with the necessary columns. We needn&#8217;t
define a currency trading account; that will be created for us:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ldgr</span> <span class="o">=</span> <span class="n">Ledger</span><span class="p">(</span>
    <span class="n">Column</span><span class="p">(</span><span class="s">&quot;Canadian cash&quot;</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">,</span> <span class="n">Role</span><span class="o">.</span><span class="n">asset</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s">&quot;US cash&quot;</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">USD</span><span class="p">,</span> <span class="n">Role</span><span class="o">.</span><span class="n">asset</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s">&quot;Capital&quot;</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">,</span> <span class="n">Role</span><span class="o">.</span><span class="n">capital</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s">&quot;Expense&quot;</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">,</span> <span class="n">Role</span><span class="o">.</span><span class="n">expense</span><span class="p">),</span>
    <span class="n">ref</span><span class="o">=</span><span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point, there&#8217;s no balance, and no rates defined for the currencies.
<tt class="docutils literal"><span class="pre">ldgr.equation.status</span></tt> will evaluate to <tt class="docutils literal"><span class="pre">Status.failed</span></tt>.</p>
<p>The scenario begins with an opening balance of CAD 200. In double entry
book-keeping, this becomes an asset on the left hand side, and capital on the
right. We can define the opening balance like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">amount</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="p">(</span><span class="n">Dl</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">Dl</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Dl</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">Dl</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="p">):</span>
    <span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span>
        <span class="n">amount</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span>
        <span class="n">ts</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">note</span><span class="o">=</span><span class="s">&quot;Opening balance&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="jan-2">
<h2>Jan 2<a class="headerlink" href="#jan-2" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s apply the initial currency exchange rate. We do that by instantiating an
Exchange object, and creating a sequence of trades to apply to our ledger:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">exchange</span> <span class="o">=</span> <span class="n">Exchange</span><span class="p">({(</span><span class="n">Cy</span><span class="o">.</span><span class="n">USD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">):</span> <span class="n">Dl</span><span class="p">(</span><span class="s">&quot;1.2&quot;</span><span class="p">)})</span>
<span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">adjustments</span><span class="p">(</span><span class="n">exchange</span><span class="p">):</span>
    <span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="n">note</span><span class="o">=</span><span class="s">&quot;1 USD = 1.20 CAD&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The next step is to buy CAD 120 worth of US dollars. How many USD will that
give us?:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">usd</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="n">TradePath</span><span class="p">(</span><span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">USD</span><span class="p">))</span>
</pre></div>
</div>
<p>So we add that to our US cash account:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="n">usd</span><span class="p">,</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="s">&quot;US cash&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>If we should check <tt class="docutils literal"><span class="pre">ldgr.equation.status</span></tt> we&#8217;d get <tt class="docutils literal"><span class="pre">Status.failed</span></tt>.
Our book is unbalanced. We must remember to deduct from our Canadian cash:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="s">&quot;Canadian cash&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>And now, <tt class="docutils literal"><span class="pre">ldgr.equation.status</span></tt> will evaluate to <tt class="docutils literal"><span class="pre">Status.ok</span></tt>.</p>
</div>
<div class="section" id="jan-3">
<h2>Jan 3<a class="headerlink" href="#jan-3" title="Permalink to this headline">¶</a></h2>
<p>Our book holds both American and Canadian dollars, so it&#8217;s exposed to
fluctuations in the exchange rate. On 3rd January, you can get $1.30 Canadian
for one American greenback. Let&#8217;s apply that to our ledger:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">exchange</span> <span class="o">=</span> <span class="n">Exchange</span><span class="p">({(</span><span class="n">Cy</span><span class="o">.</span><span class="n">USD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">):</span> <span class="n">Dl</span><span class="p">(</span><span class="s">&quot;1.3&quot;</span><span class="p">)})</span>
<span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">adjustments</span><span class="p">(</span><span class="n">exchange</span><span class="p">):</span>
    <span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="n">note</span><span class="o">=</span><span class="s">&quot;1 USD = 1.30 CAD&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point in the story, we spend forty US dollars. On the left hand side of
the ledger, it&#8217;s clear that this needs to come from our US assets. But on the
right hand side, our expense account is in Canadian dollars. So we need to make
a calculation to determine how much to deduct from there:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cad</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">TradePath</span><span class="p">(</span><span class="n">Cy</span><span class="o">.</span><span class="n">USD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">))</span>
</pre></div>
</div>
<p>And so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="s">&quot;US cash&quot;</span><span class="p">])</span>
<span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="n">cad</span><span class="p">,</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="s">&quot;Expense&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="jan-5">
<h2>Jan 5<a class="headerlink" href="#jan-5" title="Permalink to this headline">¶</a></h2>
<p>The exchange rate shifts a bit today in favour of the Canadian dollar. We don&#8217;t
make any purchases, but we do convert all our US dollars back to Canadian. So
there should be no change to the right hand side of our ledger, only movement
of our assets on the left.</p>
<p>First we apply the new rate:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">exchange</span> <span class="o">=</span> <span class="n">Exchange</span><span class="p">({(</span><span class="n">Cy</span><span class="o">.</span><span class="n">USD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">):</span> <span class="n">Dl</span><span class="p">(</span><span class="s">&quot;1.25&quot;</span><span class="p">)})</span>
<span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">adjustments</span><span class="p">(</span><span class="n">exchange</span><span class="p">):</span>
    <span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="n">note</span><span class="o">=</span><span class="s">&quot;1 USD = 1.25 CAD&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>... then work out how much our US dollars are worth:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">usd</span> <span class="o">=</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s">&quot;US cash&quot;</span><span class="p">)</span>
<span class="n">cad</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">usd</span><span class="p">,</span> <span class="n">TradePath</span><span class="p">(</span><span class="n">Cy</span><span class="o">.</span><span class="n">USD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">,</span> <span class="n">Cy</span><span class="o">.</span><span class="n">CAD</span><span class="p">))</span>
</pre></div>
</div>
<p>... and finish by committing that to our book:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="o">-</span><span class="n">usd</span><span class="p">,</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="s">&quot;US cash&quot;</span><span class="p">])</span>
<span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="n">cad</span><span class="p">,</span> <span class="n">ldgr</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="s">&quot;Canadian cash&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="jan-7">
<h2>Jan 7<a class="headerlink" href="#jan-7" title="Permalink to this headline">¶</a></h2>
<p>We are now back in Canada but stuck in the airport waiting for our transfer
home. We want food. So we cough up twenty dollars for a nasty burger and a
bottle of fizzy beer. Here&#8217;s the transaction for that:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">cols</span><span class="p">[</span><span class="s">&quot;Canadian cash&quot;</span><span class="p">],</span> <span class="n">note</span><span class="o">=</span><span class="s">&quot;Buy food&quot;</span><span class="p">)</span>
<span class="n">ldgr</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">cols</span><span class="p">[</span><span class="s">&quot;Expense&quot;</span><span class="p">],</span> <span class="n">note</span><span class="o">=</span><span class="s">&quot;Buy food&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>How much money do we have left? <tt class="docutils literal"><span class="pre">ldgr.value(&quot;Canadian</span> <span class="pre">cash&quot;)</span></tt> says $135.00.
Looking at the other columns it seems we spent CAD 72.00 during our trip. We
accidentally made CAD 7.00 due to the fluctuations in the exchange rate while
we were away.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="index.html" title="Tallywallet - a Money framework in Python"
             >previous</a> |</li>
        <li><a href="index.html">Tallywallet manual v0.002</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, D Haynes.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>