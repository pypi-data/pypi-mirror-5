define("serrano/channels",[],function(){return{DATACONTEXT_CHANGED:"datacontext/changed",DATACONTEXT_SYNCING:"datacontext/syncing",DATACONTEXT_SYNCED:"datacontext/synced",DATACONTEXT_PAUSE:"datacontext/pause",DATACONTEXT_RESUME:"datacontext/resume",DATACONTEXT_ADD:"datacontext/add",DATACONTEXT_REMOVE:"datacontext/remove",DATACONTEXT_CLEAR:"datacontext/clear",DATACONTEXT_HISTORY:"datacontext/history",DATAVIEW_CHANGED:"dataview/changed",DATAVIEW_SYNCING:"dataview/syncing",DATAVIEW_SYNCED:"dataview/synced",DATAVIEW_PAUSE:"dataview/pause",DATAVIEW_RESUME:"dataview/resume",DATAVIEW_COLUMNS:"dataview/columns",DATAVIEW_ORDERING:"dataview/ordering",DATAVIEW_HISTORY:"dataview/history"}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("serrano/datafield",["backbone"],function(e){var t,n,r,i;return t=function(e){function t(){return r=t.__super__.constructor.apply(this,arguments),r}return __extends(t,e),t}(e.Model),n=function(e){function n(){return i=n.__super__.constructor.apply(this,arguments),i}return __extends(n,e),n.prototype.model=t,n}(e.Collection),{DataField:t,DataFields:n}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("serrano/dataconcept",["backbone"],function(e){var t,n,r,i;return t=function(e){function t(){return r=t.__super__.constructor.apply(this,arguments),r}return __extends(t,e),t}(e.Model),n=function(e){function n(){return i=n.__super__.constructor.apply(this,arguments),i}return __extends(n,e),n.prototype.model=t,n}(e.Collection),{DataConcept:t,DataConcepts:n}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__slice=[].slice,__bind=function(e,t){return function(){return e.apply(t,arguments)}};define("serrano/datacontext",["mediator","underscore","backbone","./channels"],function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d;return u=function(e){var t;return(e.type==="and"||e.type==="or")&&((t=e.children)!=null?t.length:void 0)>=2},f=function(e){return e.operator&&e.id&&e.value!=null},a=function(e){return e.composite===!0&&e.id},s=function(e){function n(){return h=n.__super__.constructor.apply(this,arguments),h}return __extends(n,e),n.prototype.validate=function(e){var t,n;if(u(e)||f(e)||a(e))return;for(t in e){n=e[t];if(n!=null)return"Unknown node type"}},n.prototype.toJSON=function(){var e;return e=null,this.isBranch()?e={type:this.get("type"),children:t.map(this.get("children"),function(e){return e.toJSON!=null?e.toJSON():e})}:this.isComposite()?e={id:this.get("id"),composite:this.get("composite")}:this.isCondition()&&(e={id:this.get("id"),operator:this.get("operator"),value:this.get("value")}),e},n.prototype.isRoot=function(){return this.parent==null},n.prototype.isEmpty=function(){return t.isEmpty(this.attributes)},n.prototype.isBranch=function(){return u(this.attributes)},n.prototype.isCondition=function(){return f(this.attributes)},n.prototype.isComposite=function(){return a(this.attributes)},n.prototype.siblings=function(){return this.isRoot()?!1:t.without(this.parent.get("children"),this)},n.prototype.promote=function(){var e,n,r,i=this;n=1<=arguments.length?__slice.call(arguments,0):[];if(n.length===0)throw new Error("At least one node must be supplied");return this.isRoot()?r="and":r=this.parent.get("type")==="and"?"or":"and",e=t.map([this.attributes].concat(__slice.call(n)),function(e){return l(e,i)}),this.clear({slient:!0}),this.set({type:r,children:e}),this},n.prototype.demote=function(){return this.isRoot()?!1:this.parent.isRoot()?this.siblings().length===0?(this.parent.clear({silent:!0}),this.parent.set(this.attributes),this.parent):!1:(this.parent.parent.get("children").push(this.remove()),this)},n.prototype.add=function(){var e,t;e=1<=arguments.length?__slice.call(arguments,0):[];if(!this.isBranch())throw new Error('Node is not a branch. Use "promote" to convert it into one');return(t=this.get("children")).push.apply(t,e),this},n.prototype.remove=function(){var e,t;return this.isRoot()?this.clear():(e=this.parent.get("children"),(t=e.indexOf(this))>=0&&(e.splice(t,1)[0],e.length===1&&e[0].demote())),this},n}(n.Model),l=function(e,n,r){var i,o;if(!e||t.isEmpty(e))o=new s;else if(e instanceof s)o=e;else if(u(e))o=new s({type:e.type}),i=t.map(e.children,function(e){return l(e,o,r)}),o.set({children:i});else if(f(e))o=new s(e);else{if(!a(e))throw new Error("Unknown node type");o=new s(e)}return n&&(o.parent=n),typeof r=="function"&&r(o),o},c=function(e,t){var n,r,i,s,o,u,a;if(e.isBranch()){n=e.get("children"),u=t.children,a=[];for(r=s=0,o=u.length;s<o;r=++s)i=u[r],a.push(c(n[r],i));return a}return e.set(t)},i=function(n){function i(){return this._deferenceNode=__bind(this._deferenceNode,this),this._referenceNode=__bind(this._referenceNode,this),this._nodeSave=__bind(this._nodeSave,this),this.save=__bind(this.save,this),this.parse=__bind(this.parse,this),p=i.__super__.constructor.apply(this,arguments),p}return __extends(i,n),i.prototype.deferred={save:!0,clear:!0,add:!1,remove:!1},i.prototype.url=function(){return this.isNew()?i.__super__.url.apply(this,arguments):this.get("_links").self.href},i.prototype.initialize=function(){var n,o,u,a=this;i.__super__.initialize.apply(this,arguments),(n=this.nodes)==null&&(this.nodes={}),(o=this.clientNodes)==null&&(this.clientNodes={}),(u=this.root)==null&&(this.root=new s);if(this.isArchived()){this.resolve();return}return this.on("sync",function(){return this.resolve(),e.publish(r.DATACONTEXT_SYNCED,this,"success")}),this.on("error",function(){return e.publish(r.DATACONTEXT_SYNCED,this,"error")}),this.on("change",function(){return e.publish(r.DATACONTEXT_CHANGED,this)}),e.subscribe(r.DATACONTEXT_PAUSE,function(e){if(a.id===e||!e&&a.isSession())return a.pending()}),e.subscribe(r.DATACONTEXT_RESUME,function(e){if(a.id===e||!e&&a.isSession())return a.resolve()}),e.subscribe(r.DATACONTEXT_ADD,function(e,n){t.isNumber(e)||(n=e,e=null);if(a.id===e||!e&&a.isSession())return a.add(n)}),e.subscribe(r.DATACONTEXT_REMOVE,function(e,n){t.isNumber(e)||(n=e,e=null);if(a.id===e||!e&&a.isSession())return a.remove(n)}),e.subscribe(r.DATACONTEXT_CLEAR,function(e){if(a.id===e||!e&&a.isSession())return a.clear()}),this.resolve()},i.prototype.parse=function(e){return e&&(this.root?c(this.root,e.json):(this.nodes={},this.clientNodes={},this.root=l(e.json,null,this._referenceNode))),e},i.prototype.save=function(){return this.set("json",this.root.toJSON()),i.__super__.save.apply(this,arguments),e.publish(r.DATACONTEXT_SYNCING,this),this.pending()},i.prototype.toJSON=function(){var e;return e={id:this.id,name:this.get("name"),json:null,description:this.get("description"),keywords:this.get("keywords"),published:this.get("published"),archived:this.get("archived"),composite:this.get("composite"),session:this.get("session")},this.root&&!this.root.isEmpty()&&(e.json=this.root.toJSON()),e},i.prototype._nodeSave=function(e){if(e.get("id")!=null&&e.get("value")!=null)return this.save()},i.prototype._referenceNode=function(e){var t;if(e.id==null)return;return(t=this.nodes[e.id])||(t=this.nodes[e.id]=[]),t.indexOf(e)===-1&&t.push(e),this.clientNodes[e.cid]=e,e.on("change",this._nodeSave)},i.prototype._deferenceNode=function(e){var t,n;return(t=this.nodes[e.id])&&(n=t.indexOf(e))>=0&&t.splice(n,1),delete this.clientNodes[e.cid],e.off("change",this._nodeSave)},i.prototype.isSession=function(){return this.get("session")},i.prototype.isArchived=function(){return this.get("archived")},i.prototype.getNodes=function(e){return this.nodes[e]||[]},i.prototype.add=function(e){var t;if(!this.clientNodes[e.cid])return this._referenceNode(e),this.root.isEmpty()?this.root=e:this.root.isBranch()&&!this.root.id?this.root.get("children").push(e):(t=new s({type:"and",children:[this.root,e]}),this.root=t),this.save()},i.prototype.remove=function(e){var t,n;if(this.clientNodes[e.cid])return e===this.root?this.root=new s:this.root.isBranch()&&(t=this.root.get("children"),(n=t.indexOf(e))>=0&&t.splice(n,1)[0],t.length===1&&(this.root=t[0])),this._deferenceNode(e),this.save()},i.prototype.clear=function(){var e,t,n;n=this.clientNodes;for(e in n)t=n[e],t.off("change",this._nodeSave);return this.nodes={},this.clientNodes={},this.root.id?this.root=new s:this.root.clear(),this.save()},i}(n.Model),o=function(e){function t(){return d=t.__super__.constructor.apply(this,arguments),d}return __extends(t,e),t.prototype.model=i,t.prototype.initialize=function(){return t.__super__.initialize.apply(this,arguments),this.on("reset",function(e){var t,n,r,i;this.resolve(),i=e.models;for(n=0,r=i.length;n<r;n++)t=i[n],t.trigger("sync")})},t.prototype.getSession=function(){return this.filter(function(e){return e.get("session")})[0]},t.prototype.hasSession=function(){return!!this.getSession()},t}(n.Collection),{DataContextNode:s,DataContext:i,DataContexts:o}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("serrano/dataview",["environ","mediator","underscore","backbone","./channels"],function(e,t,n,r,i){var s,o,u,a;return s=function(e){function r(){return u=r.__super__.constructor.apply(this,arguments),u}return __extends(r,e),r.prototype.deferred={save:!0},r.prototype.url=function(){return this.isNew()?r.__super__.url.apply(this,arguments):this.get("_links").self.href},r.prototype.initialize=function(){var e=this;r.__super__.initialize.apply(this,arguments);if(this.isArchived()){this.resolve();return}return this.on("sync",function(){return this.resolve(),t.publish(i.DATAVIEW_SYNCED,this,"success")}),this.on("error",function(){return t.publish(i.DATAVIEW_SYNCED,this,"error")}),this.on("change",function(){return t.publish(i.DATAVIEW_CHANGED,this)}),t.subscribe(i.DATAVIEW_PAUSE,function(t){if(e.id===t||!t&&e.isSession())return e.pending()}),t.subscribe(i.DATAVIEW_RESUME,function(t){if(e.id===t||!t&&e.isSession())return e.resolve()}),t.subscribe(i.DATAVIEW_COLUMNS,function(t,r){var i;n.isArray(t)&&(r=t,t=null);if(e.id===t||!t&&e.isSession())return i=e.get("json")||{},i.columns=r,e.set("json",i),e.save()}),t.subscribe(i.DATAVIEW_ORDERING,function(t,r){var i;n.isArray(t)&&(r=t,t=null);if(e.id===t||!t&&e.isSession())return i=e.get("json")||{},i.ordering=r,e.set("json",i),e.save()}),this.resolve()},r.prototype.isSession=function(){return this.get("session")},r.prototype.isArchived=function(){return this.get("archived")},r.prototype.toJSON=function(){return{id:this.id,json:this.get("json"),session:this.get("session"),archived:this.get("archived"),published:this.get("published")}},r.prototype.save=function(){return r.__super__.save.apply(this,arguments),t.publish(i.DATAVIEW_SYNCING,this),this.pending()},r}(r.Model),o=function(e){function t(){return a=t.__super__.constructor.apply(this,arguments),a}return __extends(t,e),t.prototype.model=s,t.prototype.initialize=function(){return t.__super__.initialize.apply(this,arguments),this.on("reset",function(e){var t,n,r,i;this.resolve(),i=e.models;for(n=0,r=i.length;n<r;n++)t=i[n],t.trigger("sync")})},t.prototype.getSession=function(){return this.filter(function(e){return e.get("session")})[0]},t.prototype.hasSession=function(){return!!this.getSession()},t}(r.Collection),{DataView:s,DataViews:o}});var __slice=[].slice;define("serrano",["underscore","serrano/channels","serrano/datafield","serrano/dataconcept","serrano/datacontext","serrano/dataview"],function(){var e,t;return t=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],t.extend.apply(t,[{}].concat(__slice.call(e)))});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("views/columns",["environ","mediator","jquery","underscore","backbone","serrano/channels"],function(e,t,n,r,i,s){var o,u;return o=function(e){function i(){return this.remove=__bind(this.remove,this),this.add=__bind(this.add,this),this.render=__bind(this.render,this),u=i.__super__.constructor.apply(this,arguments),u}return __extends(i,e),i.prototype.template=r.template('            <div id=columns-modal class="modal fade">                <div class=modal-header>                    <a class=close data-dismiss=modal>×</a>                    <h3>Data Columns</h3>                </div>                <div class=modal-body>                    <ul class="available-columns span5"></ul>                    <ul class="selected-columns span5"></ul>                </div>                <div class=modal-footer>                    <button data-save class="btn btn-primary">Save</button>                    <button data-close class=btn>Close</button>                </div>            </div>        '),i.prototype.availableItemTemplate=r.template('            <li data-id={{ id }}>                {{ name }}                <span class=controls>                    <button class="btn btn-success btn-mini">+</button>                </span>            </li>        '),i.prototype.selectedItemTemplate=r.template('            <li data-id={{ id }}>                {{ name }}                <span class=controls>                    <button class="btn btn-danger btn-mini">-</button>                </span>            </li>        '),i.prototype.events={"click [data-close]":"hide","click [data-save]":"save","click .available-columns button":"clickAdd","click .selected-columns button":"clickRemove"},i.prototype.deferred={add:!1,remove:!1},i.prototype.initialize=function(){var e=this;return i.__super__.initialize.apply(this,arguments),this.setElement(this.template()),this.$available=this.$(".available-columns"),this.$selected=this.$(".selected-columns").sortable({cursor:"move",forcePlaceholderSize:!0,placeholder:"placeholder"}),this.$el.addClass("loading"),this.collection.when(function(){return e.$el.removeClass("loading"),e.render(),e.resolve()}),t.subscribe(s.DATAVIEW_SYNCED,function(t){var n,r,i,s,o;if(t.isSession()&&(r=t.get("json"))){o=r.columns;for(i=0,s=o.length;i<s;i++)n=o[i],e.add(n)}})},i.prototype.render=function(){var e,t,n,r,i,s;e=[],n=[],s=this.collection.filter(function(e){return e.get("formatter_name")});for(r=0,i=s.length;r<i;r++)t=s[r],e.push(this.availableItemTemplate(t.attributes)),n.push(this.selectedItemTemplate(t.attributes));return this.$available.html(e.join("")),this.$selected.html(n.join("")),this},i.prototype.show=function(){return this.$el.modal("show")},i.prototype.hide=function(){return this.$el.modal("hide")},i.prototype.save=function(){var e;return this.hide(),e=n.map(this.$selected.children(),function(e){var t;if((t=n(e).data()).selected&&t.id)return t.id}),t.publish(s.DATAVIEW_COLUMNS,e)},i.prototype.add=function(e){return this.$available.find("[data-id="+e+"]").closest("li").hide(),this.$selected.find("[data-id="+e+"]").appendTo(this.$selected).show().data("selected",!0)},i.prototype.remove=function(e){return this.$selected.find("[data-id="+e+"]").hide().data("selected",!1),this.$available.find("[data-id="+e+"]").closest("li").show()},i.prototype.clickAdd=function(e){return e.preventDefault(),this.add(n(e.target).closest("li").data("id"))},i.prototype.clickRemove=function(e){return e.preventDefault(),this.remove(n(e.target).closest("li").data("id"))},i}(i.View)});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("views/table",["environ","mediator","jquery","underscore","backbone"],function(e,t,n,r,i){var s,o;return s=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return __extends(t,e),t.prototype.template=r.template('            <div id="report-container">                <div id="report-alert" class="alert alert-block">                    <h4 class="alert-heading" data-alert-heading></h4>                    <span data-alert-message></span>                </div>                <table id="report-table" class="table table-striped">                    <div class="pinned-thead"></div>                    <thead></thead>                    <tbody></tbody>                </table>            </div>        '),t.prototype.events={scroll:"togglePinnedThead","click tbody tr":"highlightRow"},t.prototype.initialize=function(){var e=this;return this.setElement(this.template()),this.$table=this.$("table"),this.$thead=this.$("thead"),this.$tbody=this.$("tbody"),this.$pinnedThead=this.$(".pinned-thead"),n(window).on("resize",function(){return e.resizePinnedThead(),e.resizeBody()})},t.prototype.setBody=function(e,t){var n,r,i,s,o,u,a,f;t==null&&(t=!1),r=[];for(s=0,u=e.length;s<u;s++){i=e[s],r.push("<tr>"),f=i.values;for(o=0,a=f.length;o<a;o++)n=f[o],n||(n="<span class=no-data>(no data)</span>"),r.push("<td>"+n+"</td>");r.push("</tr>")}return t?this.$tbody.append(r.join("")):this.$tbody.html(r.join("")),this.resizeBody(),this.resizePinnedThead()},t.prototype.setHeader=function(e){var t,r,i,s,o,u,a,f;i=[],s=[];for(a=0,f=e.length;a<f;a++)t=e[a],u=n("<th data-id="+t.id+">"+t.name+"</th>"),r=n("<div data-id="+t.id+">"+t.name+"</div>"),t.direction&&(t.direction==="desc"?(u.append(n("<i class=icon-chevron-down></i>")),r.append(n("<i class=icon-chevron-down></i>"))):(u.append(n("<i class=icon-chevron-up></i>")),r.append(n("<i class=icon-chevron-up></i>"))),u.data("direction",t.direction),u.addClass(t.direction),r.data("direction",t.direction),r.addClass(t.direction)),i.push(u),s.push(r);return this.$pinnedThead.empty(),this.$thead.html((o=n("<tr>")).append.apply(o,i)),this.$pinnedThead.append.apply(this.$pinnedThead,s)},t.prototype.resizePinnedThead=function(){var e,t=this;return e=this.$thead.width(),this.$thead.find("th").each(function(r,i){var s,o;return o=n(i),s=n(t.$pinnedThead.children()[r]),s.css("width",o.width()/e*100+"%")})},t.prototype.resizeBody=function(){return this.$table.height()>n("#main-area").height()?this.$el.removeClass("short"):this.$el.addClass("short")},t.prototype.togglePinnedThead=function(e){var t,n;t=this.$el.scrollTop(),n=this.$pinnedThead.is(":visible");if(t<=0&&n)return this.$pinnedThead.hide();if(!n)return this.$pinnedThead.show()},t.prototype.highlightRow=function(e){var t;return t=n(e.target).parent(),t.toggleClass("highlight")},t}(i.View),s});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("routes/review",["environ","mediator","jquery","underscore","backbone","serrano","views/columns","views/table"],function(e,t,n,r,i,s,o,u){var a,f,l;return f=r.template('<button class=btn title="Show/Hide Columns"><i class=icon-list alt="Show/Hide Columns"></i></button>'),a=function(e){function r(){return this.loadData=__bind(this.loadData,this),l=r.__super__.constructor.apply(this,arguments),l}return __extends(r,e),r.prototype.id="review-area",r.prototype.options={perPage:100},r.prototype.events={"click table thead th":"sort","click .pinned-thead div":"sort"},r.prototype.deferred={loadData:!0},r.prototype.initialize=function(){var e,i=this;return r.__super__.initialize.apply(this,arguments),this.$el.hide().appendTo("#main-area .inner"),this.$toolbar=n("<ul>").addClass("nav pull-right").hide().appendTo("#subnav .container-fluid"),this.columns=new o({collection:App.DataConcept}),this.columns.$el.appendTo("body"),e=n(f()).on("click",function(e){return i.columns.show()}),this.$toolbar.append(n("<li>").html(e)),this.table=new u,this.$el.append(this.table.el),this.table.$("#report-table").scroller({autofill:!0,container:this.table.$el,trigger:function(){return i.loadData(!0)}}),t.subscribe(s.DATAVIEW_SYNCED,function(){return i.loadData()}),t.subscribe(s.DATACONTEXT_SYNCED,function(){return i.loadData()}),this.page=1,this.perPage=this.options.perPage},r.prototype.load=function(){this.$el.fadeIn(100),this.$toolbar.fadeIn(100);if(this.tableScrollTop)return this.table.$el.scrollTop(this.tableScrollTop)},r.prototype.unload=function(){return this.tableScrollTop=this.table.$el.scrollTop(),this.$el.hide(),this.$toolbar.hide()},r.prototype.loadData=function(e){var t,n=this;e==null&&(e=!1);if(e&&this.page===this.numPages)return;return t=""+App.urls.preview+"?per_page="+this.perPage,e?t=""+t+"&page="+(this.page+1):this.table.$el.addClass("loading"),i.ajax({url:t,success:function(t){return e?n.page++:(n.page=1,n.numPages=t.num_pages,n.table.setHeader(t.keys)),n.table.setBody(t.objects,e)},complete:function(){return n.table.$el.removeClass("loading"),n.table.$("#report-table").scroller("reset")}})},r.prototype.sort=function(e){var r,i,o,u;return r=n(e.target),(u=r.data("direction"))?u==="asc"?i="desc":i=null:i="asc",r.data("direction",i),r.removeClass(u).addClass(i),i?o=[[r.data("id"),i]]:o=[],t.publish(s.DATAVIEW_ORDERING,o)},r}(i.View)});