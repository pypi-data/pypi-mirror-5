var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("router",["environ","jquery","underscore","backbone"],function(e,t,n,r){var i,s,o,u;return i=!1,s=function(e){function t(){return u=t.__super__.constructor.apply(this,arguments),u}return __extends(t,e),t.prototype.registeredRoutes={},t.prototype.loadedRoutes=[],t.prototype.register=function(e,t,r){if(this.registeredRoutes[t]!=null)throw new Error(""+t+" view already registered");this.registeredRoutes[t]=r;if(e===!1){typeof r.load=="function"&&r.load(),typeof r.resolve=="function"&&r.resolve();return}return this.route(e,t,function(){var e,r,s,o,u,a,f,l;if(!i){i=!0,l=this.loadedRoutes;for(u=0,a=l.length;u<a;u++)f=l[u],typeof (e=this.registeredRoutes[f]).unload=="function"&&e.unload(),typeof (r=this.registeredRoutes[f]).pending=="function"&&r.pending();this.loadedRoutes=[],n.defer(function(){return i=!1})}return typeof (s=this.registeredRoutes[t]).load=="function"&&s.load(),typeof (o=this.registeredRoutes[t]).resolve=="function"&&o.resolve(),this.loadedRoutes.push(t)})},t}(r.Router),o=new s}),define("serrano/channels",[],function(){return{DATACONTEXT_CHANGED:"datacontext/changed",DATACONTEXT_SYNCING:"datacontext/syncing",DATACONTEXT_SYNCED:"datacontext/synced",DATACONTEXT_PAUSE:"datacontext/pause",DATACONTEXT_RESUME:"datacontext/resume",DATACONTEXT_ADD:"datacontext/add",DATACONTEXT_REMOVE:"datacontext/remove",DATACONTEXT_CLEAR:"datacontext/clear",DATACONTEXT_HISTORY:"datacontext/history",DATAVIEW_CHANGED:"dataview/changed",DATAVIEW_SYNCING:"dataview/syncing",DATAVIEW_SYNCED:"dataview/synced",DATAVIEW_PAUSE:"dataview/pause",DATAVIEW_RESUME:"dataview/resume",DATAVIEW_COLUMNS:"dataview/columns",DATAVIEW_ORDERING:"dataview/ordering",DATAVIEW_HISTORY:"dataview/history"}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("serrano/datafield",["backbone"],function(e){var t,n,r,i;return t=function(e){function t(){return r=t.__super__.constructor.apply(this,arguments),r}return __extends(t,e),t}(e.Model),n=function(e){function n(){return i=n.__super__.constructor.apply(this,arguments),i}return __extends(n,e),n.prototype.model=t,n}(e.Collection),{DataField:t,DataFields:n}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("serrano/dataconcept",["backbone"],function(e){var t,n,r,i;return t=function(e){function t(){return r=t.__super__.constructor.apply(this,arguments),r}return __extends(t,e),t}(e.Model),n=function(e){function n(){return i=n.__super__.constructor.apply(this,arguments),i}return __extends(n,e),n.prototype.model=t,n}(e.Collection),{DataConcept:t,DataConcepts:n}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__slice=[].slice,__bind=function(e,t){return function(){return e.apply(t,arguments)}};define("serrano/datacontext",["mediator","underscore","backbone","./channels"],function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d;return u=function(e){var t;return(e.type==="and"||e.type==="or")&&((t=e.children)!=null?t.length:void 0)>=2},f=function(e){return e.operator&&e.id&&e.value!=null},a=function(e){return e.composite===!0&&e.id},s=function(e){function n(){return h=n.__super__.constructor.apply(this,arguments),h}return __extends(n,e),n.prototype.validate=function(e){var t,n;if(u(e)||f(e)||a(e))return;for(t in e){n=e[t];if(n!=null)return"Unknown node type"}},n.prototype.toJSON=function(){var e,t;return e=null,this.isBranch()?e={type:this.get("type"),children:function(){var e,n,r,i;r=this.get("children"),i=[];for(e=0,n=r.length;e<n;e++)t=r[e],i.push(t.toJSON());return i}.call(this)}:this.isComposite()?e={id:this.get("id"),composite:this.get("composite")}:this.isCondition()&&(e={id:this.get("id"),operator:this.get("operator"),value:this.get("value")}),e},n.prototype.isRoot=function(){return this.parent==null},n.prototype.isEmpty=function(){return t.isEmpty(this.attributes)},n.prototype.isBranch=function(){return u(this.attributes)},n.prototype.isCondition=function(){return f(this.attributes)},n.prototype.isComposite=function(){return a(this.attributes)},n.prototype.siblings=function(){return this.isRoot()?!1:t.without(this.parent.get("children"),this)},n.prototype.promote=function(){var e,n,r,i=this;n=1<=arguments.length?__slice.call(arguments,0):[];if(n.length===0)throw new Error("At least one node must be supplied");return this.isRoot()?r="and":r=this.parent.get("type")==="and"?"or":"and",e=t.map([this.attributes].concat(__slice.call(n)),function(e){return l(e,i)}),this.clear({slient:!0}),this.set({type:r,children:e}),this},n.prototype.demote=function(){return this.isRoot()?!1:this.parent.isRoot()?this.siblings().length===0?(this.parent.clear({silent:!0}),this.parent.set(this.attributes),this.parent):!1:(this.parent.parent.get("children").push(this.remove()),this)},n.prototype.add=function(){var e,t;e=1<=arguments.length?__slice.call(arguments,0):[];if(!this.isBranch())throw new Error('Node is not a branch. Use "promote" to convert it into one');return(t=this.get("children")).push.apply(t,e),this},n.prototype.remove=function(){var e,t;return this.isRoot()?this.clear():(e=this.parent.get("children"),(t=e.indexOf(this))>=0&&(e.splice(t,1)[0],e.length===1&&e[0].demote())),this},n}(n.Model),l=function(e,n,r){var i,o;if(!e||t.isEmpty(e))o=new s;else if(e instanceof s)o=e;else if(u(e))o=new s({type:e.type}),i=t.map(e.children,function(e){return l(e,o,r)}),o.set({children:i});else if(f(e))o=new s(e);else{if(!a(e))throw new Error("Unknown node type");o=new s(e)}return n&&(o.parent=n),typeof r=="function"&&r(o),o},c=function(e,t){var n,r,i,s,o,u,a;if(e.isBranch()){n=e.get("children"),u=t.children,a=[];for(r=s=0,o=u.length;s<o;r=++s)i=u[r],a.push(c(n[r],i));return a}return e.set(t)},i=function(n){function i(){return this._deferenceNode=__bind(this._deferenceNode,this),this._referenceNode=__bind(this._referenceNode,this),this._nodeSave=__bind(this._nodeSave,this),this.save=__bind(this.save,this),this.parse=__bind(this.parse,this),p=i.__super__.constructor.apply(this,arguments),p}return __extends(i,n),i.prototype.deferred={save:!0,clear:!0,add:!1,remove:!1},i.prototype.url=function(){return this.isNew()?i.__super__.url.apply(this,arguments):this.get("_links").self.href},i.prototype.initialize=function(){var n=this;i.__super__.initialize.apply(this,arguments),this.nodes==null&&(this.nodes={}),this.clientNodes==null&&(this.clientNodes={}),this.root==null&&(this.root=new s);if(this.isArchived()){this.resolve();return}return this.on("sync",function(){return this.resolve(),e.publish(r.DATACONTEXT_SYNCED,this,"success")}),this.on("error",function(){return e.publish(r.DATACONTEXT_SYNCED,this,"error")}),this.on("change",function(){return e.publish(r.DATACONTEXT_CHANGED,this)}),e.subscribe(r.DATACONTEXT_PAUSE,function(e){if(n.id===e||!e&&n.isSession())return n.pending()}),e.subscribe(r.DATACONTEXT_RESUME,function(e){if(n.id===e||!e&&n.isSession())return n.resolve()}),e.subscribe(r.DATACONTEXT_ADD,function(e,r){t.isNumber(e)||(r=e,e=null);if(n.id===e||!e&&n.isSession())return n.add(r)}),e.subscribe(r.DATACONTEXT_REMOVE,function(e,r){t.isNumber(e)||(r=e,e=null);if(n.id===e||!e&&n.isSession())return n.remove(r)}),e.subscribe(r.DATACONTEXT_CLEAR,function(e){if(n.id===e||!e&&n.isSession())return n.clear()}),this.resolve()},i.prototype.parse=function(e){return e&&(this.root?c(this.root,e.json):(this.nodes={},this.clientNodes={},this.root=l(e.json,null,this._referenceNode))),e},i.prototype.save=function(){return this.set("json",this.root.toJSON()),i.__super__.save.apply(this,arguments),e.publish(r.DATACONTEXT_SYNCING,this),this.pending()},i.prototype.toJSON=function(){var e;return e={id:this.id,name:this.get("name"),json:null,description:this.get("description"),keywords:this.get("keywords"),published:this.get("published"),archived:this.get("archived"),composite:this.get("composite"),session:this.get("session")},this.root&&!this.root.isEmpty()&&(e.json=this.root.toJSON()),e},i.prototype._nodeSave=function(e){if(e.get("id")!=null&&e.get("value")!=null)return this.save()},i.prototype._referenceNode=function(e){var t;if(e.id==null)return;return(t=this.nodes[e.id])||(t=this.nodes[e.id]=[]),t.indexOf(e)===-1&&t.push(e),this.clientNodes[e.cid]=e,e.on("change",this._nodeSave)},i.prototype._deferenceNode=function(e){var t,n;return(t=this.nodes[e.id])&&(n=t.indexOf(e))>=0&&t.splice(n,1),delete this.clientNodes[e.cid],e.off("change",this._nodeSave)},i.prototype.isSession=function(){return this.get("session")},i.prototype.isArchived=function(){return this.get("archived")},i.prototype.getNodes=function(e){return this.nodes[e]||[]},i.prototype.add=function(e){var t;if(!this.clientNodes[e.cid])return this._referenceNode(e),this.root.isEmpty()?this.root=e:this.root.isBranch()&&!this.root.id?this.root.get("children").push(e):(t=new s({type:"and",children:[this.root,e]}),this.root=t),this.save()},i.prototype.remove=function(e){var t,n;if(this.clientNodes[e.cid])return e===this.root?this.root=new s:this.root.isBranch()&&(t=this.root.get("children"),(n=t.indexOf(e))>=0&&t.splice(n,1)[0],t.length===1&&(this.root=t[0])),this._deferenceNode(e),this.save()},i.prototype.clear=function(){var e,t,n;n=this.clientNodes;for(e in n)t=n[e],t.off("change",this._nodeSave);return this.nodes={},this.clientNodes={},this.root.id?this.root=new s:this.root.clear(),this.save()},i}(n.Model),o=function(e){function t(){return d=t.__super__.constructor.apply(this,arguments),d}return __extends(t,e),t.prototype.model=i,t.prototype.initialize=function(){return t.__super__.initialize.apply(this,arguments),this.on("reset",function(e){var t,n,r,i;this.resolve(),i=e.models;for(n=0,r=i.length;n<r;n++)t=i[n],t.trigger("sync")})},t.prototype.getSession=function(){return this.filter(function(e){return e.get("session")})[0]},t.prototype.hasSession=function(){return!!this.getSession()},t}(n.Collection),{DataContextNode:s,DataContext:i,DataContexts:o}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("serrano/dataview",["environ","mediator","underscore","backbone","./channels"],function(e,t,n,r,i){var s,o,u,a;return s=function(e){function r(){return u=r.__super__.constructor.apply(this,arguments),u}return __extends(r,e),r.prototype.deferred={save:!0},r.prototype.url=function(){return this.isNew()?r.__super__.url.apply(this,arguments):this.get("_links").self.href},r.prototype.initialize=function(){var e=this;r.__super__.initialize.apply(this,arguments);if(this.isArchived()){this.resolve();return}return this.on("sync",function(){return this.resolve(),t.publish(i.DATAVIEW_SYNCED,this,"success")}),this.on("error",function(){return t.publish(i.DATAVIEW_SYNCED,this,"error")}),this.on("change",function(){return t.publish(i.DATAVIEW_CHANGED,this)}),t.subscribe(i.DATAVIEW_PAUSE,function(t){if(e.id===t||!t&&e.isSession())return e.pending()}),t.subscribe(i.DATAVIEW_RESUME,function(t){if(e.id===t||!t&&e.isSession())return e.resolve()}),t.subscribe(i.DATAVIEW_COLUMNS,function(t,r){var i;n.isArray(t)&&(r=t,t=null);if(e.id===t||!t&&e.isSession())return i=e.get("json")||{},i.columns=r,e.set("json",i),e.save()}),t.subscribe(i.DATAVIEW_ORDERING,function(t,r){var i;n.isArray(t)&&(r=t,t=null);if(e.id===t||!t&&e.isSession())return i=e.get("json")||{},i.ordering=r,e.set("json",i),e.save()}),this.resolve()},r.prototype.isSession=function(){return this.get("session")},r.prototype.isArchived=function(){return this.get("archived")},r.prototype.toJSON=function(){return{id:this.id,json:this.get("json"),session:this.get("session"),archived:this.get("archived"),published:this.get("published")}},r.prototype.save=function(){return r.__super__.save.apply(this,arguments),t.publish(i.DATAVIEW_SYNCING,this),this.pending()},r}(r.Model),o=function(e){function t(){return a=t.__super__.constructor.apply(this,arguments),a}return __extends(t,e),t.prototype.model=s,t.prototype.initialize=function(){return t.__super__.initialize.apply(this,arguments),this.on("reset",function(e){var t,n,r,i;this.resolve(),i=e.models;for(n=0,r=i.length;n<r;n++)t=i[n],t.trigger("sync")})},t.prototype.getSession=function(){return this.filter(function(e){return e.get("session")})[0]},t.prototype.hasSession=function(){return!!this.getSession()},t}(r.Collection),{DataView:s,DataViews:o}});var __slice=[].slice;define("serrano",["underscore","serrano/channels","serrano/datafield","serrano/dataconcept","serrano/datacontext","serrano/dataview"],function(){var e,t;return t=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],t.extend.apply(t,[{}].concat(__slice.call(e)))});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("models/datafield",["environ","serrano"],function(e,t){var n,r;return n=function(e){function t(){return r=t.__super__.constructor.apply(this,arguments),r}return __extends(t,e),t.prototype.url=App.urls.datafields,t.prototype.initialize=function(){return t.__super__.initialize.apply(this,arguments),this.on("reset",this.resolve),this.fetch()},t}(t.DataFields),App.DataField=new n});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("models/dataconcept",["environ","serrano"],function(e,t){var n,r;return n=function(e){function t(){return r=t.__super__.constructor.apply(this,arguments),r}return __extends(t,e),t.prototype.url=App.urls.dataconcepts,t.prototype.initialize=function(){return t.__super__.initialize.apply(this,arguments),this.on("reset",this.resolve),this.fetch()},t}(t.DataConcepts),App.DataConcept=new n});var __slice=[].slice;define("main",["environ","jquery","underscore","backbone","router","models/datafield","models/dataconcept"],function(e,t,n,r,i){var s,o;return o=App.routes,s=n.pluck(o,"module"),require(s,function(){var e,n,s,u,a,f,l,c,h,p;u=1<=arguments.length?__slice.call(arguments,0):[],l=App.root,n=App.head,a=window.location.pathname,f=a.length;for(s=h=0,p=o.length;h<p;s=++h){e=o[s];if(!e.module)continue;n==null&&e.route!==!1&&(n=e.route),i.register(e.route,e.name,new u[s](e.options)),e.route&&l==null&&(c=e.route.length,a.substr(f-c)===e.route&&(l=a.substr(0,f-c)))}return l==null&&(l=a),n==null&&(n=""),require(["session","models/datacontext","models/dataview"]),t(function(){var s,u,a,f;r.history.start({root:l,pushState:!0})||i.navigate(n,{replace:!0,trigger:!0}),u=t('<ul class="nav pull-left" />');for(a=0,f=o.length;a<f;a++){e=o[a];if(!e.module||e.route===!1)continue;s=t('<li><a href="'+l+e.route+'"                    data-route="'+e.route+'">'+e.label+"</a></li>"),u.append(s)}return u.appendTo("header .container-fluid"),t("body").on("click","[data-route]",function(e){var n;return e.preventDefault(),n=t(this).data("route"),i.navigate(n,{trigger:!0})})})})}),define("channels",[],function(){return{SESSION_SET:"session/set",SESSION_SYNCED:"session/synced",SESSION_LOAD:"session/load/{{ key }}"}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("session",["environ","mediator","channels","underscore","backbone"],function(e,t,n,r,i){var s,o,u;s=function(e){function i(){return u=i.__super__.constructor.apply(this,arguments),u}return __extends(i,e),i.prototype.url=App.urls.preferences,i.prototype.defaults={json:{}},i.prototype.initialize=function(){var e=this;return i.__super__.initialize.apply(this,arguments),t.subscribe(n.SESSION_SET,function(t,n){var r,i;return r=e.get("json"),(i=r.session)||(i=r.session={}),i[t]=n,e.save()}),this.on("sync",function(){return t.publish(n.SESSION_SYNCED)}),this.on("change",function(){return this.load()}),this.fetch()},i.prototype.load=function(){var e,i,s,o,u;s=this.get("json"),u=s.session||{};for(o in u)i=u[o],e=r.template(n.SESSION_LOAD,{key:o}),t.publish(e,i)},i}(i.Model),o=new s});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("models/datacontext",["underscore","serrano"],function(e,t){var n,r,i,s,o,u;return r=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return __extends(t,e),t.prototype.url=App.urls.datacontexts,t}(t.DataContexts),n=function(e){function t(){return u=t.__super__.constructor.apply(this,arguments),u}return __extends(t,e),t.prototype.url=App.urls.datacontextHistory,t}(t.DataContexts),i=new r,i.on("reset",function(){var e;if(!i.hasSession())return e={session:!0},e.json=App.defaults.datacontext,i.create(e)}),s=new n,i.fetch(),s.fetch(),App.DataContext=i});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("models/dataview",["underscore","serrano"],function(e,t){var n,r,i,s,o,u;return r=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments),o}return __extends(t,e),t.prototype.url=App.urls.dataviews,t}(t.DataViews),n=function(e){function t(){return u=t.__super__.constructor.apply(this,arguments),u}return __extends(t,e),t.prototype.url=App.urls.dataviewHistory,t}(t.DataViews),s=new r,s.on("reset",function(){var e;if(!s.hasSession())return e={session:!0},e.json=App.defaults.dataview,s.create(e)}),i=new n,s.fetch(),i.fetch(),App.DataView=s});