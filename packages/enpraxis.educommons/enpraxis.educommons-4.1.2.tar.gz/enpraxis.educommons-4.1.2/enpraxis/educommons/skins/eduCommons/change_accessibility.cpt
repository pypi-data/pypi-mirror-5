<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eduCommons">

  <metal:block fill-slot="top_slot">
    <metal:block tal:define="dummy python:request.RESPONSE.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate, post-check=0, pre-check=0');
                             dummy python:request.set('enable_border', 1);" />
  </metal:block>

  <body>

    <div metal:fill-slot="main"
         tal:define="errors nothing;
                     paths python:request.get('paths', ['/'.join(here.getPhysicalPath())]);
                     batch python:here.getObjectsFromPathList(paths,batch=True);
                     folders_in_publishing python:[o.getId for o in batch if o.isPrincipiaFolderish];
                     came_from python:request.get('HTTP_REFERER', here.absolute_url()).split('?')[0];
                     dummy python:request.set('orig_template', came_from);
                     is_publish_folder python:0;">

      <metal:block tal:condition="python: paths and not batch"
                   tal:replace="python:here.redirectToReferrer('The item(s) you selected are no longer available.')"/>

      <h1 class="documentFirstHeading" i18n:translate="">Accessibility process</h1>

      <p i18n:domain="eduCommons" i18n:translate="">
	Items should meet minimum accessibility requirements before publication. Please evaluate the content against the
	<span i18n:name="descr-accessibility-link">
	  <a href=""
	     target="blank"
	     tal:attributes="href string:$portal_url/help/accessibility-guidelines"
	     i18n:translate="">accessibility guidelines</a>
	  </span>, and set the flag accordingly.
      </p>

      <div id="content-core">

	<form id="edit_form"
              name="edit_form"
              method="post"
              action="accessibility_flag"
              tal:attributes="action string:${context/@@plone_context_state/object_url}/${template/getId}"
              tal:condition="not:python:paths and not batch">

          <fieldset i18n:domain="plone">
	    
            <legend i18n:translate="legend_publishing_details">Publishing Details</legend>
	    
            <div class="field" tal:condition="batch">
              <label for="" i18n:translate="label_affected_content">Affected content</label>

              <div tal:define="dummy python:request.set('ids_checked', 1);
                               use_view_action site_properties/typesUseViewActionInListings|python:();">
                <table id="sortable"
                       class="listing"
                       summary="Affected content"
                       i18n:attributes="summary summary_affected_content;">
                  <thead>
                    <metal:block tal:condition="batch|nothing">
                      <tr>
                        <th class="nosort">
                          <input class="noborder"
                                 type="checkbox"
                                 src="select_all_icon.gif"
                                 name="selectButton"
                                 title="Select all items"
                                 onClick="toggleSelect(this,'paths:list');"
                                     tal:attributes="src string:$portal_url/select_all_icon.gif"
                                 alt="Select all items"
                                 i18n:attributes="title label_select_all_items; alt label_select_all_items;"
				 />
                        </th>
                        <th class="nosort" i18n:translate="listingheader_title">
                          Title
                        </th>
                        <th class="nosort" i18n:translate="listingheader_size">
                          Size
                        </th>
                        <th class="nosort" i18n:translate="listingheader_modified">
                          Modified
                        </th>
                        <th class="nosort" i18n:translate="listingheader_status">
                          State
                        </th>
                      </tr>
                      </metal:block>
                  </thead>
		  
                  <metal:block tal:condition="batch|nothing">
                    <tbody tal:define="portal context/@@plone_portal_state/portal;
                                       getRelativeContentURL nocall:context/portal_url/getRelativeContentURL;
                                       normalizeString nocall:context/@@plone/normalizeString;
                                       wtool portal/portal_workflow;
                                       ">
                      <tal:items tal:repeat="item batch">
                        <tr tal:define="oddrow               repeat/item/odd;
                                        item_url             item/getURL|item/absolute_url;
                                        item_id              item/getId;
                                        item_path            item/getPath|python:'/'.join(item.getPhysicalPath());
                                        item_title_or_id     item/pretty_title_or_id;
                                        item_description     item/Description;
                                        item_type            item/portal_type;
                                        item_size            item/getObjSize;
                                        item_modified        item/ModificationDate;
                                        item_icon            python:plone_view.getIcon(item);
                                        item_type_class      python:'contenttype-' + normalizeString(item_type);
                                        item_wf_state        item/review_state|python: wtool.getInfoFor(item, 'review_state', '');
                                        item_state_title     python:wtool.getTitleForStateOnType(item_wf_state, item_type);
                                        item_wf_state_class  python:'state-' + normalizeString(item_wf_state);
                                        item_use_view        python:item_type in use_view_action;
                                        hasGetUrl            python:hasattr(item.aq_explicit, 'getURL');
                                        item_rel_url         python:hasGetUrl and item.getURL(relative=1) or getRelativeContentURL(item);
                                        browserDefaultResult context/browserDefault;
                                        isBrowserDefault     python:len(browserDefaultResult[1]) == 1 and item.id == context.browserDefault()[1][0];
                                        item_folderish       item/is_folderish|nothing"
                            tal:attributes="class python:test(oddrow, 'draggable even', 'draggable odd');
                                            id string:folder-contents-item-${item_id};" >
			  
                          <td class="notDraggable">
                            <input type="checkbox"
                                   class="noborder"
                                   name="paths:list" id="#"
                                   value="#"
                                   tal:attributes="value   item_path;
                                                   id      string:cb_$item_id;
                                                   checked python:test(request.get('ids_checked', False), 'checked', None);
                                                   alt     string:Select $item_title_or_id;
                                                   title   string:Select $item_title_or_id" />
                            <input type="hidden" name="obj_paths:list" value="#"
                                   tal:attributes="value item_rel_url" />
			    
                          </td>
                          <td tal:define="url python:test(item_use_view, item_url+'/view',
                                          test(item_folderish, item_url+'/folder_contents', item_url+'/'));">
                            <img tal:replace="structure item_icon/html_tag" />
                            <a href="#" tal:attributes="href  url;
                                                        title string:$item_type: $item_description;
                                                        class string:$item_wf_state_class $item_type_class;">
                              <strong tal:omit-tag="python:not isBrowserDefault">
                                <label tal:content="item_title_or_id"
                                       tal:attributes="for string:cb_$item_id">
                                  Item Title
                                </label>
                              </strong>
                            </a>
			    
                            <span class="state-expired"
                                  tal:condition="python:context.isExpired(item)"
                                  i18n:translate="time_expired">expired</span>
                          </td>
			  
                          <td>
                            <span tal:condition="not: item_size"> &nbsp; </span>
                            <span tal:condition="python:item_size>0"
                                  tal:content="item_size"
                                  tal:attributes="class item_wf_state_class"> size </span>
                          </td>
                          <td tal:define="toLocalizedTime nocall:context/@@plone/toLocalizedTime;"
                              tal:content="python:toLocalizedTime(item_modified, long_format=1)"
                              tal:attributes="class item_wf_state_class">
                            08/19/2001 03:01 AM
                          </td>
                          <td>
                            <span i18n:translate=""
                                  tal:condition="item_state_title"
                                  tal:content="item_state_title"
                                  tal:attributes="class item_wf_state_class" />
                            <span tal:condition="not: item_state_title">&nbsp;</span>
                          </td>
                        </tr>
                      </tal:items>
                    </tbody>
                  </metal:block>
		  
                </table>
	      </div>

            </div>

            <div class="field formSingleCheckbox"
		 tal:condition="folders_in_publishing|nothing">

              <input type="checkbox"
                     class="formElement"
                     id="include_children"
                     name="include_children"
                     tabindex=""
                     />

              <label for="include_contained_objects" i18n:translate="label_include_contained_objects">
		Include contained items
              </label>

              <div class="formHelp" i18n:domain="eduCommons"
                   i18n:translate="">
		If checked, eduCommons will attempt to change the accessibility status of all content in any selected folders and their subfolders.<br /> 
              </div>

            </div>
            <div class="field" i18n:domain="eduCommons">
              <label i18n:translate="">Accessibility Status</label>
              <div class="formHelp"
                   i18n:translate="">
		Choose to set the accessibility flag, or revoke accessibility.
              </div>
	      
              <input class="noborder"
                     id="accessibility_clear"
                     type="radio"
		     i18n:attributes="title"
                     name="accessibility_action"
                     title="Accessible"
                     value="True"
		     checked="checked"
                     />
              <label for="accessibility_clear"
                     i18n:translate="">
                Accessible</label>
              <br />
              <input class="noborder"
                     id="accessibility_revoke"
                     type="radio"
		     i18n:attributes="title"
                     name="accessibility_action"
                     title="Not Accessible"
                     value="False"
		     />
              <label for="accessibilty_revoke"
                     i18n:translate="">
                Not Accessible</label>
              <br />
	      
            </div>
	    
          <div class="formControls">
            <input class="context"
                   type="submit"
                   name="form.button.Accessible"
                   value="Save"
                   i18n:attributes="value label_save;"
		   />
            <input class="standalone"
                   type="submit"
                   name="form.button.Cancel"
                   value="Cancel"
                   i18n:attributes="value label_cancel;"
		   />
          </div>
	  

          <span tal:replace="nothing">
            ##### HIDDEN VARIABLES FOR THE FORM_TOOL -- CUT AND PASTE
            THESE INTO YOUR FORM ####
          </span>
          <input type="hidden" name="form.submitted" value="1" />
          <input type="hidden" name="orig_template"
                 tal:condition="request/orig_template|nothing"
                 tal:attributes="value request/orig_template" />
          <input type="hidden" name="folder_publish" value="1"
                 tal:condition="python:is_publish_folder" />
          
          </fieldset>

	</form>
      </div>
    </div>

  </body>
</html>
