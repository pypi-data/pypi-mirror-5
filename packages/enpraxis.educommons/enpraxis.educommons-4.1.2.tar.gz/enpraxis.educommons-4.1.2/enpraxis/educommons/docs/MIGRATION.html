<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>Migrating to eduCommons 3.2.1-final</title>
<link rel="stylesheet" href="./default.css" type="text/css" />
</head>
<body>
<div class="document" id="migrating-to-educommons-3-2-1-final">
<h1 class="title">Migrating to eduCommons 3.2.1-final</h1>

<div class="section" id="preparation">
<h1>Preparation</h1>
<p>A few things you should do before beginning the migration:</p>
<ol class="arabic simple">
<li>VERY IMPORTANT: SAVE A BACKUP OF YOUR Data.fs FILE, which is located in the [old instance home]/var directory of your eduCommons site. This file contains all of the content for your site. (This way you will able to restore your file from this Data.fs file if anything goes wrong.)</li>
<li>Verify that your current instance is eduCommons-3.1.1-final.</li>
</ol>
</div>
<div class="section" id="migration-of-educommons-3-1-1-final-to-3-2-1-final">
<h1>Migration of eduCommons 3.1.1-final to 3.2.1-final</h1>
<p>The migration eduCommons from version 3.1.1-final to version 3.2.1-final
includes the following:</p>
<ol class="arabic simple">
<li>Pre-migration of Data.fs in version 3.1.1-final</li>
<li>Movement of Data.fs file to a new 3.2.1-final instance</li>
<li>Migration to the eduCommons 3.2.1-final instance</li>
<li>Export/Import of eduCommons site to a new 3.2.1-final instance</li>
<li>Final steps</li>
</ol>
</div>
<div class="section" id="pre-migration-of-data-fs-in-version-3-1-1-final">
<h1>Pre-migration of Data.fs in version 3.1.1-final</h1>
<p>For this step, you will need:</p>
<ul class="simple">
<li>contentmigration Plone Add-on Product, available at <a class="reference external" href="http://pypi.python.org/packages/source/P/Products.contentmigration/Products.contentmigration-1.1.zip">http://pypi.python.org/packages/source/P/Products.contentmigration/Products.contentmigration-1.1.zip</a></li>
<li>to copy the migration source code found in version 3.2.1.  The file is located at eduCommons/extras/PreMigrate.py<ul>
<li>Copy this into [old instance]/Products/eduCommons/Extensions</li>
</ul>
</li>
</ul>
<p>Add contentmigration product by following these steps:</p>
<ol class="arabic simple">
<li>Download the product from the aforementioned pypi URL</li>
<li>Unzip the product. Products.contentmigration needs to be placed in the Products directory of your 3.1.1 instance. For example: /opt/Zope-2.10.6/edu311/Products. In addition, since it is currently only available as an egg, you will have to extract only the contentmigration directory into the aforementioned products dir. When you unzip the package from</li>
</ol>
<dl class="docutils">
<dt><a class="reference external" href="http://pypi.python.org/packages/source/P/Products.contentmigration/Products.contentmigration-1.1.zip">http://pypi.python.org/packages/source/P/Products.contentmigration/Products.contentmigration-1.1.zip</a>, it will look like a typical python egg:</dt>
<dd><ul class="first last simple">
<li>Products.contentmigration-1.1</li>
<li>--Products</li>
<li>----contentmigration</li>
</ul>
</dd>
</dl>
<p>That is the actual 'Zope2 Product' that needs to be moved into your 3.1.1 Products directory.</p>
<ol class="arabic simple" start="3">
<li>Restart zope</li>
</ol>
<p>Run the migration script by following these steps:</p>
<ol class="arabic simple">
<li>Open your 3.1.1-final eduCommons site in the ZMI. (click educommons Setup, then click Zope Management Interface.)</li>
<li>From the drop down menu, select &quot;External method&quot; and click the Add button.</li>
<li>Enter the following parameters:<ul>
<li>Id: PreMigrate</li>
<li>Title: PreMigrate</li>
<li>Module Name: PreMigrate</li>
<li>Function Name: pre_migrate_3_1_1_to_3_2_1</li>
</ul>
</li>
<li>Click Add</li>
<li>Click on the PreMigrate script you just added</li>
<li>Click the test tab.</li>
<li>Verify that the method ran successfully. (It should give you feedback.)</li>
</ol>
</div>
<div class="section" id="movement-of-data-fs-file-to-a-new-3-2-1-final-instance">
<h1>Movement of Data.fs file to a new 3.2.1-final instance</h1>
<p>For this step, you will move the Data.fs file from the old instance to
the new instance. First of all, install an eduCommons-3.2.1-final
instance using the installations instructions found in [new instance home]/eduCommons/docs/. Stop both sites. Then
copy the Data.fs file from the var directory of the old site to the
var/filestorage directory of the new site:</p>
<pre class="literal-block">
sudo cp -rvfp [old instance home]/var/Data.fs [new instance home]/var/filestorage
</pre>
</div>
<div class="section" id="migration-to-educommons-3-2-1-final-instance">
<h1>Migration to eduCommons 3.2.1-final instance</h1>
<p>eduCommons 3.2.1-final uses the portal_setup tool to perform the necessary upgrade from 3.1.1 to 3.2.1-final. Due to the fact that eduCommons and it's dependencies were moved to python eggs, we must start with a new eduCommons site. The migration script will then copy and past content and relevant settings to the new installation:</p>
<ol class="arabic simple">
<li>Navigate to the root of your ZMI instance and create a new eduCommons site called eduCommons321</li>
<li>Open your new 3.2.1-final eduCommons site in the ZMI. (click educommons Setup, then click Zope Management Interface.)</li>
<li>Navigate to portal_setup</li>
<li>Press the 'Upgrades' tab</li>
<li>From the drop down menu, select 'Products.eduCommons:default' and click Choose Profile button.</li>
<li>Choose the 'Migration :: 3.1.1 to 3.2.1' option</li>
<li>Press Upgrade</li>
</ol>
</div>
<div class="section" id="export-import-of-educommons-site-to-a-new-3-2-1-final-instance">
<h1>Export/Import of eduCommons site to a new 3.2.1-final instance</h1>
<p>You are now ready to transfer your migrated instance to the production environment.</p>
<ol class="arabic simple">
<li>Navigate to the root of your ZMI instance</li>
<li>Select the checkbox next to your new 3.2.1-final eduCommons site</li>
<li>Press Import/Export</li>
<li>If your production environment is on the same server as your migration environment, choose 'Save file to server', else
Download the file to your local machine. Dependent on the size of your site, this process may take a long time.</li>
<li>Move the .zexp into the import directory of your production site [production_site]parts/instance/import</li>
<li>Navigate to the ZMI of your production site</li>
<li>Press Import/Export</li>
<li>Select your .zexp from the drop down list, and press Import. Dependent on the size of your site, this process may take a long time.</li>
<li>If desired, rename your imported eduCommons321 site.</li>
</ol>
</div>
<div class="section" id="final-steps">
<h1>Final Steps</h1>
<p>Your site should now be migrated. Navigate to your site in the browser and ensure it has migrated.</p>
</div>
</div>
<div class="footer">
<hr class="footer" />
<a class="reference external" href="MIGRATION.txt">View document source</a>.
Generated on: 2009-08-18 05:41 UTC.
Generated by <a class="reference external" href="http://docutils.sourceforge.net/">Docutils</a> from <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> source.

</div>
</body>
</html>
