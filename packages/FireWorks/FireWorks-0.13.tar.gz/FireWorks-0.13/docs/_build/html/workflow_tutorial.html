
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Creating Workflows &mdash; FireWorks 0.13 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.13',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="FireWorks 0.13 documentation" href="index.html" />
    <link rel="next" title="Dynamic Workflows" href="dynamic_wf_tutorial.html" />
    <link rel="prev" title="Defining Jobs using FireTasks" href="firetask_tutorial.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dynamic_wf_tutorial.html" title="Dynamic Workflows"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="firetask_tutorial.html" title="Defining Jobs using FireTasks"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">FireWorks 0.13 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="creating-workflows">
<h1>Creating Workflows<a class="headerlink" href="#creating-workflows" title="Permalink to this headline">¶</a></h1>
<p>Thus far, the only way to run multiple jobs in sequence was to define a list of several FireTasks inside a single FireWork. In this tutorial, we&#8217;ll explore how Workflows let us define complex sequences of FireWorks. We&#8217;ll start with a simple example and then move to more complicated workflows.</p>
<p>This tutorial can be completed from the command line. Some knowledge of Python is helpful, but not required. In this tutorial, we will run examples on the central server for simplicity. One could just as easily run them on a FireWorker if you&#8217;ve set one up.</p>
<div class="section" id="the-simplest-workflow">
<h2>The simplest workflow<a class="headerlink" href="#the-simplest-workflow" title="Permalink to this headline">¶</a></h2>
<p>The simplest workflow consists of two jobs without any data dependency between them. The only constraint is that the second job should be executed after the first.</p>
<p>For example, we might want print the first two lines of Hamlet&#8217;s soliloquy to the standard out (e.g., your Terminal window). We can represent the workflow with the following diagram:</p>
<img alt="Hamlet WF" class="align-center" src="_images/hamlet_wf.png" style="width: 200px;" />
<p>Basically, we just want to ensure that <em>&#8220;To be, or not to be,&#8221;</em> is printed out before <em>&#8220;that is the question:&#8221;</em>. Let&#8217;s define and execute this workflow.</p>
<ol class="arabic">
<li><p class="first">Move to the <tt class="docutils literal"><span class="pre">workflow</span></tt> tutorial directory on your FireServer:</p>
<div class="highlight-python"><pre>cd &lt;INSTALL_DIR&gt;/fw_tutorials/workflow</pre>
</div>
</li>
<li><p class="first">The workflow is encapsulated in the <tt class="docutils literal"><span class="pre">hamlet_wf.yaml</span></tt> file. Look inside this file. The first section, labeled <tt class="docutils literal"><span class="pre">fws</span></tt>, contains a list of FireWork objects:</p>
<blockquote>
<div><ul class="simple">
<li>We define a FireWork with <tt class="docutils literal"><span class="pre">fw_id</span></tt> set to 1, and that prints <em>&#8220;To be, or not to be,&#8221;</em>.</li>
<li>We define another FireWork with <tt class="docutils literal"><span class="pre">fw_id</span></tt> set to 2, and that prints <em>&#8220;that is the question:&#8221;</em></li>
</ul>
<p>The second section, labeled <tt class="docutils literal"><span class="pre">links</span></tt>, connects these FireWorks into a workflow:</p>
<ul class="simple">
<li>In the <tt class="docutils literal"><span class="pre">links</span></tt> subsection, we are specifying that the child of FW with id 1 is the FW with id 2. This means hold off on running <em>&#8220;that is the question:&#8221;</em> until we&#8217;ve first run <em>&#8220;To be, or not to be,&#8221;</em>.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Let&#8217;s insert this workflow into our database:</p>
<div class="highlight-python"><pre>lpad reset &lt;TODAY'S DATE&gt;
lpad add hamlet_wf.yaml</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When you insert the Workflow into the database using the LaunchPad, the LaunchPad will echo back an <tt class="docutils literal"><span class="pre">id_map</span></tt> that tells you how <tt class="docutils literal"><span class="pre">fw_ids</span></tt> were reassigned. The value of the <tt class="docutils literal"><span class="pre">fw_id</span></tt> has no meaning or effect on the operation of FireWorks.</p>
</div>
</li>
<li><p class="first">Let&#8217;s look at our two FireWorks:</p>
<div class="highlight-python"><pre>lpad get_fw 1
lpad get_fw 2</pre>
</div>
</li>
<li><p class="first">You should notice that the FireWork that writes the first line of the text (<em>&#8220;To be, or not to be,&#8221;</em>) shows a state that is <em>READY</em> to run. In contrast, the FireWork that writes the second line is not yet <em>READY</em>. The second line will not run until the first line is complete.</p>
</li>
<li><p class="first">Let&#8217;s run the just first step of this workflow, and then examine the state of our FireWorks:</p>
<div class="highlight-python"><pre>rlaunch -s singleshot</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">-s</span></tt> option is a shortcut to the <tt class="docutils literal"><span class="pre">--silencer</span></tt> option that suppresses log messages.</p>
</div>
</li>
<li><p class="first">You should have seen the text <em>&#8220;To be, or not to be&#8221;</em> printed to your standard out. Let&#8217;s examine our FireWorks again to examine our new situation:</p>
<div class="highlight-python"><pre>lpad get_fw 1
lpad get_fw 2</pre>
</div>
</li>
<li><p class="first">We see now that the first step is <tt class="docutils literal"><span class="pre">COMPLETED</span></tt>, and the second step has automatically graduated from <tt class="docutils literal"><span class="pre">WAITING</span></tt> to <tt class="docutils literal"><span class="pre">READY</span></tt>.</p>
</li>
<li><p class="first">Let&#8217;s now launch a Rocket that will run the second FireWork of this Workflow:</p>
<div class="highlight-python"><pre>rlaunch -s singleshot</pre>
</div>
</li>
<li><p class="first">This should print the second step of the workflow (<em>&#8220;That is the question&#8221;</em>). You can verify that both steps are completed:</p>
<div class="highlight-python"><pre>lpad get_fw 1
lpad get_fw 2</pre>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Shakespeare purists will undoubtedly notice that I have mangled the first line of this soliloquy by splitting it into two lines. But at least we printed them in the correct order!</p>
</div>
</div>
<div class="section" id="a-diamond-workflow">
<h2>A Diamond Workflow<a class="headerlink" href="#a-diamond-workflow" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s continue with a very similar example, but make the workflow a little more intricate. We will now print the org chart of a company. Of course, CEOs should be printed before managers, and managers before interns:</p>
<img alt="Org chart WF" class="align-center" src="_images/org_wf.png" style="width: 400px;" />
<p>Let&#8217;s quickly define and execute this workflow.</p>
<ol class="arabic">
<li><p class="first">Stay in the same <tt class="docutils literal"><span class="pre">workflow</span></tt> tutorial directory on your FireServer and clean it up:</p>
<div class="highlight-python"><pre>cd &lt;INSTALL_DIR&gt;/fw_tutorials/workflow
rm FW.json</pre>
</div>
</li>
<li><p class="first">The workflow is encapsulated in the <tt class="docutils literal"><span class="pre">org_wf.yaml</span></tt> file. Look inside this file.</p>
<blockquote>
<div><ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">fws</span></tt> section should make sense - we have defined one FireWork for each position in the company (4 in total).</li>
<li>The <tt class="docutils literal"><span class="pre">links</span></tt> section should also make sense. The CEO has two children (the managers). The managers each have the same child (the intern). (The company appears to be quite the oligarchy!)</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Once everything makes sense, let&#8217;s add the workflow and run everything at once:</p>
<div class="highlight-python"><pre>lpad reset &lt;TODAY'S DATE&gt;
lpad add org_wf.yaml
rlaunch -s rapidfire</pre>
</div>
</li>
<li><p class="first">You should notice that the CEO correctly gets printed above the managers, who in turn are printed above the intern. There is no preference amongst the two managers as written; FireWorks might print either manager first. If you want to distinguish between them, you can use <a class="reference internal" href="priority_tutorial.html"><em>priorities</em></a>.</p>
</li>
<li><p class="first">Finally, you can clean up your rapid directory if you are not interested in saving the contents of each launch:</p>
<div class="highlight-python"><pre>rm -r launcher_*</pre>
</div>
</li>
</ol>
</div>
<div class="section" id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>Neither our <em>Hamlet</em> workflow nor our diamond workflow were particularly interesting; you could have achieved the same result by <a class="reference internal" href="firetask_tutorial.html"><em>running multiple FireTasks within a single FireWork</em></a>. Indeed, the single-FireWork solution with multiple FireTasks is conceptually much simpler than defining workflows. The design choice of using FireTasks versus a Workflow in such scenarios is discussed another tutorial. For example, you might want to use a Workflow if each step requires a different type of computing resource.</p>
<p>Meanwhile, you can continue on to the last step(!) of the core FireWorks tutorials, which better illustrates the power of workflows: <a class="reference internal" href="dynamic_wf_tutorial.html"><em>Dynamic workflows</em></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Creating Workflows</a><ul>
<li><a class="reference internal" href="#the-simplest-workflow">The simplest workflow</a></li>
<li><a class="reference internal" href="#a-diamond-workflow">A Diamond Workflow</a></li>
<li><a class="reference internal" href="#next-steps">Next steps</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="firetask_tutorial.html"
                        title="previous chapter">Defining Jobs using FireTasks</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="dynamic_wf_tutorial.html"
                        title="next chapter">Dynamic Workflows</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/workflow_tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dynamic_wf_tutorial.html" title="Dynamic Workflows"
             >next</a> |</li>
        <li class="right" >
          <a href="firetask_tutorial.html" title="Defining Jobs using FireTasks"
             >previous</a> |</li>
        <li><a href="index.html">FireWorks 0.13 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Anubhav Jain.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>