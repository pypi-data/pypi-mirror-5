

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>django-cms-search &mdash; django-cms-search 0.5.3 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.5.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="django-cms-search 0.5.3 documentation" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="#">django-cms-search 0.5.3 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="django-cms-search">
<h1>django-cms-search<a class="headerlink" href="#django-cms-search" title="Permalink to this headline">¶</a></h1>
<p>This package provides multilingual search indexes for easy Haystack integration
with <a class="reference external" href="http://www.django-cms.org">django CMS</a>.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>Django &gt;= 1.3</li>
<li>django CMS &gt;= 2.1.3</li>
<li>django-haystack &gt;= 1.2.4, &lt; 2.0 (support for 2.0 will be a priority once it is released)</li>
<li>django-classy-tags &gt;= 0.3.2</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>After installing django-cms-search through your package manager of choice, add
<tt class="xref py py-mod docutils literal"><span class="pre">cms_search</span></tt> to your <a class="reference external" href="http://readthedocs.org/docs/django/en/latest/ref/settings.html#std:setting-INSTALLED_APPS" title="(in Django v1.5)"><tt class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a>. That&#8217;s it.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Since version 0.5, the <tt class="docutils literal"><span class="pre">HaystackSearchApphook</span></tt> is not registered automatically
anymore. If you want do use the default app hook provided by django-cms-search,
add this (e.g. in <tt class="docutils literal"><span class="pre">models.py</span></tt>):</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cms_search.cms_app</span> <span class="kn">import</span> <span class="n">HaystackSearchApphook</span>
<span class="n">apphook_pool</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">HaystackSearchApphook</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For setting up Haystack, please refer to their
<a class="reference external" href="http://django-haystack.readthedocs.org/en/v1.2.7/">documentation</a>.</p>
<div class="section" id="customizing-the-index">
<h3>Customizing the Index<a class="headerlink" href="#customizing-the-index" title="Permalink to this headline">¶</a></h3>
<p>You can customize what parts of a <tt class="xref py py-class docutils literal"><span class="pre">CMSPlugin</span></tt> end up in
the index with two class attributes on <a class="reference external" href="http://readthedocs.org/docs/django-cms/en/2.1.3/extending_cms/api_references.html#cms.plugin_base.CMSPluginBase" title="(in django cms v2.1.3.final)"><tt class="xref py py-class docutils literal"><span class="pre">CMSPluginBase</span></tt></a>
subclasses:</p>
<dl class="attribute">
<dt id="search_fields">
<tt class="descname">search_fields</tt><a class="headerlink" href="#search_fields" title="Permalink to this definition">¶</a></dt>
<dd><p>a list of field names to index.</p>
</dd></dl>

<dl class="attribute">
<dt id="search_fulltext">
<tt class="descname">search_fulltext</tt><a class="headerlink" href="#search_fulltext" title="Permalink to this definition">¶</a></dt>
<dd><p>if <tt class="docutils literal"><span class="pre">True</span></tt>, the index renders the plugin and adds the result (sans HTML
tags) to the index.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Before version 0.6 of this library, this attributes had to be defined on
<tt class="xref py py-class docutils literal"><span class="pre">CMSPlugin</span></tt>. Starting with 0.6, it can also be defined
on <a class="reference external" href="http://readthedocs.org/docs/django-cms/en/2.1.3/extending_cms/api_references.html#cms.plugin_base.CMSPluginBase" title="(in django cms v2.1.3.final)"><tt class="xref py py-class docutils literal"><span class="pre">CMSPluginBase</span></tt></a>, for cases where one
<tt class="xref py py-class docutils literal"><span class="pre">CMSPlugin</span></tt> subclass is used by multiple
<a class="reference external" href="http://readthedocs.org/docs/django-cms/en/2.1.3/extending_cms/api_references.html#cms.plugin_base.CMSPluginBase" title="(in django cms v2.1.3.final)"><tt class="xref py py-class docutils literal"><span class="pre">CMSPluginBase</span></tt></a> subclasses with different search
requirements.</p>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="module-cms_search.search_helpers">
<span id="helpers"></span><h2>Helpers<a class="headerlink" href="#module-cms_search.search_helpers" title="Permalink to this headline">¶</a></h2>
<p>django-cms-search provides a couple of useful helpers to deal with multilingual
content.</p>
<dl class="class">
<dt id="cms_search.search_helpers.cms_search.search_helpers.indexes.MultiLanguageIndex">
<em class="property">class </em><tt class="descclassname">cms_search.search_helpers.indexes.</tt><tt class="descname">MultiLanguageIndex</tt><a class="headerlink" href="#cms_search.search_helpers.cms_search.search_helpers.indexes.MultiLanguageIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="http://readthedocs.org/docs/django-haystack/en/latest/searchindex_api.html#SearchIndex" title="(in Haystack v2.0)"><tt class="docutils literal"><span class="pre">SearchIndex</span></tt></a> that dynamically adds translated fields to
the search index.  An example for when this is useful is the app hook
infrastructure from django CMS. When a model&#8217;s
<a class="reference external" href="http://readthedocs.org/docs/django/en/latest/ref/models/instances.html#django.db.models.Model.get_absolute_url" title="(in Django v1.5)"><tt class="xref py py-meth docutils literal"><span class="pre">get_absolute_url()</span></tt></a> uses a url pattern that
is attached to an app hook, the URL varies depending on the language. A
usage example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">haystack</span> <span class="kn">import</span> <span class="n">indexes</span>
<span class="kn">from</span> <span class="nn">cms_search.search_helpers.indexes</span> <span class="kn">import</span> <span class="n">MultiLanguageIndex</span>

<span class="k">class</span> <span class="nc">NewsIndex</span><span class="p">(</span><span class="n">MultiLanguageIndex</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">use_template</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">model_attr</span><span class="o">=</span><span class="s">&#39;title&#39;</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">stored</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prepare_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">HaystackTrans</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;url&#39;</span><span class="p">,</span> <span class="s">&#39;title&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><a class="reference internal" href="#cms_search.search_helpers.cms_search.search_helpers.indexes.MultiLanguageIndex" title="cms_search.search_helpers.cms_search.search_helpers.indexes.MultiLanguageIndex"><tt class="xref py py-class docutils literal"><span class="pre">MultiLanguageIndex</span></tt></a>
dynamically creates translated fields. The name of the dynamic fields
is a concatenation of the original field name, an underscore and the
language code.</li>
<li>If you define a <tt class="xref py py-meth docutils literal"><span class="pre">prepare()</span></tt> method for a translated field, that
method will be called multiple times, with changing active language.</li>
<li>In the above example, you might want to catch
<tt class="xref py py-class docutils literal"><span class="pre">NoReverseMatch</span></tt> exceptions if you
don&#8217;t have activated the app hook for all languages defined in
<a class="reference external" href="http://readthedocs.org/docs/django/en/latest/ref/settings.html#std:setting-LANGUAGES" title="(in Django v1.5)"><tt class="docutils literal"><span class="pre">LANGUAGES</span></tt></a>.</li>
<li>The <a class="reference external" href="http://readthedocs.org/docs/django-haystack/en/latest/searchfield_api.html#SearchField.model_attr" title="(in Haystack v2.0)"><tt class="xref py py-attr docutils literal"><span class="pre">model_attr</span></tt></a> attribute is handled
somewhat specially. The index tries to find a field on the model
called <tt class="docutils literal"><span class="pre">model_attr</span> <span class="pre">+</span> <span class="pre">'_'</span> <span class="pre">+</span> <span class="pre">language_code</span></tt>. If it exists, it is used
as the translated value. But it isn&#8217;t possible to supply the name of
a model method and let the index call it with varying activated
languages. Use <tt class="xref py py-meth docutils literal"><span class="pre">prepare_myfieldname()</span></tt> for that case.</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>django CMS monkeypatches <a class="reference external" href="http://readthedocs.org/docs/django/en/latest/topics/http/urls.html#django.core.urlresolvers.reverse" title="(in Django v1.5)"><tt class="xref py py-func docutils literal"><span class="pre">django.core.urlresolvers.reverse()</span></tt></a> to
enable language namespaces. To ensure that this monkeypatching happens
before haystack autodiscovers your indexes, your <tt class="docutils literal"><span class="pre">search_sites.py</span></tt>
should look somewhat like this:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cms.models</span> <span class="kn">import</span> <span class="n">monkeypatch_reverse</span>
<span class="kn">import</span> <span class="nn">haystack</span>

<span class="n">monkeypatch_reverse</span><span class="p">()</span>
<span class="n">haystack</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>
</pre></div>
</div>
</div>
</dd></dl>

<dl class="class">
<dt id="cms_search.search_helpers.cms_search.search_helpers.fields.MultiLangTemplateField">
<em class="property">class </em><tt class="descclassname">cms_search.search_helpers.fields.</tt><tt class="descname">MultiLangTemplateField</tt><a class="headerlink" href="#cms_search.search_helpers.cms_search.search_helpers.fields.MultiLangTemplateField" title="Permalink to this definition">¶</a></dt>
<dd><p>A <tt class="xref py py-class docutils literal"><span class="pre">haystack.indexes.CharField</span></tt> subclass that renders the search
template in all languages defined in <a class="reference external" href="http://readthedocs.org/docs/django/en/latest/ref/settings.html#std:setting-LANGUAGES" title="(in Django v1.5)"><tt class="docutils literal"><span class="pre">LANGUAGES</span></tt></a> and
concatenates the result.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you plan to render django CMS placeholders in the template,
make sure to pass the <tt class="docutils literal"><span class="pre">needs_request</span></tt> argument to
<a class="reference internal" href="#cms_search.search_helpers.cms_search.search_helpers.fields.MultiLangTemplateField" title="cms_search.search_helpers.cms_search.search_helpers.fields.MultiLangTemplateField"><tt class="xref py py-meth docutils literal"><span class="pre">cms_search.search_helpers.fields.MultiLangTemplateField()</span></tt></a>.</p>
</div>
</dd></dl>

<div class="section" id="get-translated-value-template-tag">
<span id="std:templatetag-get_translated_value"></span><h3><tt class="docutils literal"><span class="pre">{%</span> <span class="pre">get_translated_value</span> <span class="pre">%}</span></tt> template tag<a class="headerlink" href="#get-translated-value-template-tag" title="Permalink to this headline">¶</a></h3>
<p>This template tag is most useful in combination with the
<a class="reference internal" href="#cms_search.search_helpers.cms_search.search_helpers.indexes.MultiLanguageIndex" title="cms_search.search_helpers.cms_search.search_helpers.indexes.MultiLanguageIndex"><tt class="xref py py-class docutils literal"><span class="pre">MultiLanguageIndex</span></tt></a>. You can use it
while looping through search results, and it will automatically pick up the
translated field for the current language or fall back to another available
language (in the order defined in <a class="reference external" href="http://readthedocs.org/docs/django/en/latest/ref/settings.html#std:setting-LANGUAGES" title="(in Django v1.5)"><tt class="docutils literal"><span class="pre">LANGUAGES</span></tt></a>). Example:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">load</span> <span class="nv">cms_search_tags</span> <span class="cp">%}</span>

<span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;search-results&quot;</span><span class="nt">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">result</span> <span class="k">in</span> <span class="nv">page.object_list</span> <span class="cp">%}</span>
        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">get_translated_value</span> <span class="nv">result</span> <span class="s2">&quot;url&quot;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="nt">&gt;</span><span class="cp">{%</span> <span class="k">get_translated_value</span> <span class="nv">result</span> <span class="s2">&quot;title&quot;</span> <span class="cp">%}</span><span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you plan to use this template tag, you have to add
<a class="reference internal" href="#module-cms_search.search_helpers" title="cms_search.search_helpers"><tt class="xref py py-mod docutils literal"><span class="pre">cms_search.search_helpers</span></tt></a> to your <a class="reference external" href="http://readthedocs.org/docs/django/en/latest/ref/settings.html#std:setting-INSTALLED_APPS" title="(in Django v1.5)"><tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a>.</p>
</div>
</div>
</div>
<div class="section" id="settings">
<h2>Settings<a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cms-search-index-base-class">
<h3>CMS_SEARCH_INDEX_BASE_CLASS<a class="headerlink" href="#cms-search-index-base-class" title="Permalink to this headline">¶</a></h3>
<p>Default: <a class="reference external" href="http://readthedocs.org/docs/django-haystack/en/latest/searchindex_api.html#SearchIndex" title="(in Haystack v2.0)"><tt class="xref py py-class docutils literal"><span class="pre">haystack.indexes.SearchIndex</span></tt></a></p>
<p>This setting can be used to add custom fields to the search index if the
included fields do not suffice. Make sure to provide the full path
to your <a class="reference external" href="http://readthedocs.org/docs/django-haystack/en/latest/searchindex_api.html#SearchIndex" title="(in Haystack v2.0)"><tt class="docutils literal"><span class="pre">SearchIndex</span></tt></a> subclass.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">django-cms-search</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#customizing-the-index">Customizing the Index</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-cms_search.search_helpers">Helpers</a><ul>
<li><a class="reference internal" href="#get-translated-value-template-tag"><tt class="docutils literal"><span class="pre">{%</span> <span class="pre">get_translated_value</span> <span class="pre">%}</span></tt> template tag</a></li>
</ul>
</li>
<li><a class="reference internal" href="#settings">Settings</a><ul>
<li><a class="reference internal" href="#cms-search-index-base-class">CMS_SEARCH_INDEX_BASE_CLASS</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="#">django-cms-search 0.5.3 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Divio AG.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>