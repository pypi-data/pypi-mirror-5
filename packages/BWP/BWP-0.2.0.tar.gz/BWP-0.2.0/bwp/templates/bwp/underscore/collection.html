{# Шаблон Underscore #}{% load bwp_verbatim %}{% verbatim %}
{% var _obj_add = 'object_add', _obj_delete = 'object_delete', _multiselect = true, _rowactions = true; %}
{% if (data.is_m2m) { _obj_add += '_m2m'; _obj_delete += '_m2m'; } %}
{% if (data instanceof classSelector) { %}
    {% if (!data.multiple) { _multiselect = false; } else { _rowactions = false; } %}
{% } %}
<table data-id="{{ data.id }}"
    class="table table-condensed table-striped table-bordered table-hover">
    <thead>
        <tr>
        {% if (_multiselect) { %}
            <th class="input-micro"><input type="checkbox" data-toggle="checkboxes"></th>
        {% } %}
        {% _.each(data.widgets, function(c) { %}
            {% var _label = c.label; if (_.strip(c.attr['class']) == 'input-mini') { _label = _.truncate(c.label, 6) } %}
            <th data-toggle="tooltip" class="{{ c.attr['class'] }}" title="{{ c.label }}">{{ _label }}</th>
        {% }); %}
        </tr>
    </thead>
    <tbody>
    {% _.each(data.paginator.object_list, function(obj) { %}
        <tr data-model="{{ obj.model }}" data-pk="{{ obj.pk }}">
        {% if (_multiselect) { %}
            <td><input type="checkbox" data-model="{{ obj.model }}" data-pk="{{ obj.pk }}"></td>
        {% } %}
            {% _.each(data.widgets, function(c, index) { %}
                <td class="{{ c.attr['class'] }}">
                {% if ((index == 0) && (_rowactions)) { %}
                    <div class="dropup">
                        <div class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#">
                        {% if (c.name == '__unicode__') { %}
                            {{ obj.__unicode__ }}
                        {% } else { %}
                            {{ obj.fields[c.name] }}
                        {% } %}
                        </div>
                        <ul class="dropdown-menu" role="menu">
                        {% if (data.perms.change) { %}
                            <li><a  tabindex="-1" href="#"
                                    data-action="object_open"
                                    data-model="{{ obj.model }}"
                                    data-pk="{{ obj.pk }}">
                                    <i class="icon-edit"> </i> Изменить
                                </a>
                            </li>
                        {% } %}
                        {% if (data.perms.add) { %}
                            <li><a  tabindex="-1" href="#"
                                    data-action="object_copy"
                                    data-model="{{ obj.model }}"
                                    data-pk="{{ obj.pk }}">
                                    <i class="icon-plus"> </i> Копировать
                                </a>
                            </li>
                        {% } %}
                        {% if ((data.perms.add) && (data.meta.has_clone)) { %}
                            <li><a  tabindex="-1" href="#"
                                    data-action="object_clone"
                                    data-model="{{ obj.model }}"
                                    data-pk="{{ obj.pk }}">
                                    <i class="icon-pause"> </i> Клонировать
                                </a>
                            </li>
                        {% } %}
                        {% if (data.perms.delete) { %}
                            <li class="divider"></li>
                            <li><a  tabindex="-1" href="#"
                                    data-action="{{ _obj_delete }}"
                                    data-model="{{ obj.model }}"
                                    data-pk="{{ obj.pk }}"
                                    data-id="{{ data.id }}">
                                    <i class="icon-trash"> </i> Удалить
                                </a>
                            </li>
                        {% } %}
                        {% if (!_multiselect) { %}
                            <li><a  tabindex="-1" href="#"
                                    data-action="object_select"
                                    data-model="{{ obj.model }}"
                                    data-unicode="{{ obj.__unicode__ }}"
                                    data-pk="{{ obj.pk }}">
                                    <i class="icon-ok"> </i> Выбрать
                                </a>
                            </li>
                        {% } %}
                        </ul>
                    </div>
                {% } else { %}
                    {% if (c.name == '__unicode__') { %}
                        {{ obj.__unicode__ }}
                    {% } else { %}
                        {% if ($.type(obj.fields[c.name]) === 'boolean') { %}
                            {% if (obj.fields[c.name]) { %}
                                <i class="icon-ok"></i>
                            {% } else { %}
                                <i class="icon-ban-circle"></i>
                            {% } %}
                        {% } else { %}
                            {{ obj.fields[c.name] }}
                        {% } %}
                    {% } %}
                {% } %}
                </td>
            {% }); %}
        </tr>
    {% }); %}
    </tbody>
</table>
<div id="pagination_{{ data.id }}">
    <div class="pagination pagination-right pagination-mini">
        <ul>
            {% _.each(data.paginator.page_range, function(page) { %}
                {% if (page == data.paginator.number) { %}
                <li class="active"><a href="#" data-action="collection_page" data-page="{{ page }}" data-id="{{ data.id }}">{{ page }}</a></li>
                {% } else if (isNaN(page)) { %}
                <li class="disabled"><a href="#">...</a></li>
                {% } else { %}
                <li><a href="#" data-action="collection_page" data-page="{{ page }}" data-id="{{ data.id }}">{{ page }}</a></li>
                {% } %}
            {% }); %}
        </ul>
    </div>
</div>
{% endverbatim %}
