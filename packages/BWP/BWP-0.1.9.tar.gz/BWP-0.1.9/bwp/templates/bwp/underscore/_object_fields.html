{# Шаблон Underscore #}{% load bwp_verbatim %}{% verbatim %}
<fieldset>
    {% _.each(data.widgets, function(widget) { %}
        {% if (!widget.hidden) { %}
            <div class="control-group">
                <label class="control-label" for="field_{{ data.id }}_{{ widget.name }}">
                    {% if (widget.attr.required) {%}<b>{{ widget.label }}</b>
                    {% } else { %}{{ widget.label }}{%}%}
                </label>
                <div class="controls">
        {% } %}
        {% if ((widget.tag == 'input') || (widget.tag == 'textarea')) { %}
            {% var _val = _.escape(data.fields[widget.name]) || '' %}
            <{{ widget.tag }} id="field_{{ data.id }}_{{ widget.name }}"
                name="{{ widget.name }}"
                data-id="{{ data.id }}"
                data-action="object_change"
            {% _.each(widget.attr, function(val, key) { %}
                {{ key }}="{{ val }}"
            {% }); %}
            {% if (widget.attr.type && (widget.attr.type == 'checkbox')) { %}
                {% if (data.fields[widget.name]) { %}checked="checked"{% } %}
            {% } else if (widget.tag == 'textarea') { %}
                >{{ _val }}</{{ widget.tag }}
            {% } else { %}
                value="{{ _val }}"
            {% } %}>
        {% } else if ((widget.tag == 'select') && (!widget.attr.multiple)) { %}
            {% var _val = data.fields[widget.name] || ['',''] %}
            {% var _val0 = _.escape(_val[0]) %}
            {% var _val1 = _.escape(_val[1]) %}
            <div class="input-prepend input-append">
                {%/* Кнопка значения и названия */%}
                <button name="{{ widget.name }}" value="{{ _val0 }}"
                    data-model="{{ widget.model }}"
                    disabled="disabled"
                    {% _.each(widget.attr, function(val, key) { %}
                        {% if (! key in {'type':0, 'name':0}) { %}
                            {{ key }}="{{ val }}"
                        {% } %}
                    {% }); %}
                    class="btn {{ widget.attr['class'] || 'input-medium' }}"
                    data-action="object_change"
                    data-id="{{ data.id }}">{{ _val1 }}
                </button>
                {%/* Кнопка сброса */%}
                <button class="btn" data-action="field_clear">
                    <i class="icon-remove"></i>
                </button>
                {%/* Кнопка поиска */%}
                <button class="btn" data-action="field_select">
                    <i class="icon-search"></i>
                </button>
            </div>
        {% } else if ((widget.tag == 'select') && (widget.attr.multiple)) { %}
            <select name="{{ widget.name }}"
                data-model="{{ widget.model }}"
                disabled="disabled"
                {% _.each(widget.attr, function(val, key) { %}
                    {% if (! key in {'type':0, 'name':0}) { %}
                        {{ key }}="{{ val }}"
                    {% } %}
                {% }); %}
                class="{{ widget.attr['class'] }}"
                data-action="object_change"
                data-id="{{ data.id }}">{{ data.fields[widget.name] }}
                </select>
        {% } %}
        {% if (!widget.hidden) { %}
                </div>
            </div>
        {% } %}
    {% }); %}
</fieldset>
{% endverbatim %}

{# Кнопки действий #}
<div class="control-group">
    <div class="controls">
        <div class="btn-group">
            {% include "bwp/underscore/_button_delete.html" %}
            {% include "bwp/underscore/_button_reset.html" %}
            {% include "bwp/underscore/_button_apply.html" %}
            {% include "bwp/underscore/_button_save.html" %}
        </div>
    </div>
</div>
