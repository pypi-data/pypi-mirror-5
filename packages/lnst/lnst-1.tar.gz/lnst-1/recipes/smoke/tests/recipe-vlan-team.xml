<lnstrecipe xmlns:xi="http://www.w3.org/2003/XInclude">
    <network>
        <host id="1">
            <define>
                <alias name="testip" value="192.168.100.240/24"/>
            </define>
            <interfaces>
    <eth id="if-1" label="net"/>
    <vlan id="testiface">
        <options>
            <option name="vlan_tci" value="10"/>
        </options>
        <slaves>
            <slave id="if-1"/>
        </slaves>
        <addresses>
            <address value="{$testip}"/>
        </addresses>
    </vlan>
</interfaces>

        </host>
        <host id="2">
            <define>
                <alias name="testip" value="192.168.100.215/24"/>
            </define>
            <interfaces>
    <eth id="if-1" label="net"/>
    <eth id="if-2" label="net"/>
    <team id="testiface">
        <options>
            <option name="teamd_config">
                {
                    "runner": {"name": "roundrobin"}
                }
            </option>
        </options>
        <slaves>
            <slave id="if-1"/>
            <slave id="if-2"/>
        </slaves>
        <addresses>
             <address value="{$testip}"/>
        </addresses>
    </team>
</interfaces>

        </host>
    </network>
    
<task>
    <run bg_id="1" expect="fail" host="1" module="IcmpPing" timeout="30">
        <options>
            <option name="addr" value="{ip(2,testiface)}"/>
            <option name="count" value="40"/>
            <option name="interval" value="0.2"/>
            <option name="limit_rate" value="95"/>
        </options>
    </run>
    <ctl_wait seconds="5"/>
    <intr bg_id="1" host="1"/>
</task>

<task>
    <run command="[ `ip -o link | grep {devname(1,testiface)} | wc -l` -gt 0 ]" host="1" timeout="30"/>
    <!-- This does not yet work for non-eth devices -->
    <!--<command machine_id="1" timeout="30" type="exec"
             value="[ `ip -o link | grep {hwaddr(1,testiface)} | wc -l` -gt 0 ]"/>-->
</task>
<task>
    <run expect="fail" host="1" module="IcmpPing" timeout="30">
        <options>
            <option name="addr" value="{ip(2,testiface)}"/>
            <option name="count" value="40"/>
            <option name="interval" value="0.2"/>
            <option name="limit_rate" value="95"/>
        </options>
    </run>
</task>

<task>
    <config host="1">
        <options>
            <option name="/proc/sys/net/ipv4/igmp_max_memberships" value="5"/>
            <option name="/proc/sys/net/ipv4/igmp_max_memberships" value="6"/>
            <option name="/proc/sys/net/ipv4/igmp_max_memberships" value="7"/>
            <option name="/proc/sys/net/ipv4/igmp_max_memberships" value="8"/>
        </options>
    </config>
</task>
</lnstrecipe>
