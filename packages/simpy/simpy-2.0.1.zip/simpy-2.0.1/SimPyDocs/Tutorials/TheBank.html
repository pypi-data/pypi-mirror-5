<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The Bank Tutorial Part 1: Examples of SimPy Simulation &mdash; SimPy v2.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="SimPy v2.0.1 documentation" href="../index.html" />
    <link rel="up" title="SimPy Tutorials" href="../SimPy_Tutorials.html" />
    <link rel="next" title="The Bank Tutorial part 2: More examples of SimPy Simulation" href="TheBank2.html" />
    <link rel="prev" title="SimPy Tutorials" href="../SimPy_Tutorials.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="TheBank2.html" title="The Bank Tutorial part 2: More examples of SimPy Simulation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../SimPy_Tutorials.html" title="SimPy Tutorials"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">SimPy v2.0.1 documentation</a> &raquo;</li>
          <li><a href="../SimPy_Tutorials.html" accesskey="U">SimPy Tutorials</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-bank-tutorial-part-1-examples-of-simpy-simulation">
<h1>The Bank Tutorial Part 1: Examples of SimPy Simulation<a class="headerlink" href="#the-bank-tutorial-part-1-examples-of-simpy-simulation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<span id="index-0"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://simpy.sourceforge.net/">SimPy</a> is used to develop a simple simulation of a bank with a
number of tellers.  This Python package provides <em>Processes</em> to model
active components such as messages, customers, trucks, and planes. It
has three classes to model facilities where congestion might occur:
<em>Resources</em> for ordinary queues, <em>Levels</em> for the supply of quantities
of material, and <em>Stores</em> for collections of individual items. Only
examples of <em>Resources</em> are described here. It also provides
<em>Monitors</em> and <em>Tallys</em> to record data like queue lengths and delay
times and to calculate simple averages.  It uses the standard Python
random package to generate random numbers.</p>
<p>Starting with SimPy 2.0 an object-oriented programmer&#8217;s interface was
added to the package. It is quite compatible with the current
procedural approach which is used in the models described here.</p>
<p>SimPy can be obtained from: <a class="reference external" href="http://sourceforge.net/projects/simpy">http://sourceforge.net/projects/simpy</a>.
The examples run with SimPy version 1.5 and later.  This tutorial is
best read with the SimPy Manual or Cheatsheet at your side for
reference.</p>
<p>Before attempting to use SimPy you should be familiar with the <a class="reference external" href="http://www.Python.org">Python</a>
language. In particular you should be able to use <em>classes</em>. Python is
free and available for most machine types. You can find out more about
it at the <a class="reference external" href="http://www.Python.org">Python web site</a>.  SimPy is compatible with Python version
2.3 and later.</p>
</div>
<div class="section" id="a-single-customer">
<h2>A  single Customer<a class="headerlink" href="#a-single-customer" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we model a simple bank with customers arriving at
random. We develop the model step-by-step, starting out simply, and
producing a running program at each stage. The programs we develop are
available without line numbers and ready to go, in the
<tt class="docutils literal"><span class="pre">bankprograms</span></tt> directory. Please copy them, run them and improve
them - and in the tradition of open-source software suggest your
modifications to the SimPy users list. Object-orented versions of all
the models are included in the same directory.</p>
<p>A simulation should always be developed to answer a specific question;
in these models we investigate how changing the number of bank servers
or tellers might affect the waiting time for customers.</p>
<div class="section" id="a-customer-arriving-at-a-fixed-time">
<span id="index-1"></span><h3>A Customer arriving at a fixed time<a class="headerlink" href="#a-customer-arriving-at-a-fixed-time" title="Permalink to this headline">¶</a></h3>
<p>We first model a single customer who arrives at the bank for a visit,
looks around at the decor for a time and then leaves.  There is no
queueing. First we will assume his arrival time and the time he spends
in the bank are fixed.</p>
<p>We define a <tt class="docutils literal"><span class="pre">Customer</span></tt> class derived from the SimPy <tt class="docutils literal"><span class="pre">Process</span></tt>
class. We create a <tt class="docutils literal"><span class="pre">Customer</span></tt> object, <tt class="docutils literal"><span class="pre">c</span></tt> who arrives at the bank
at simulation time <tt class="docutils literal"><span class="pre">5.0</span></tt> and leaves after a fixed time of <tt class="docutils literal"><span class="pre">10.0</span></tt>
minutes.</p>
<p>Examine the following listing which is a complete runnable Python
script, except for the line numbers.  We use comments to divide the
script up into sections. This makes for clarity later when the
programs get more complicated.  Line 1 is a normal Python
documentation string; line 2 imports the SimPy simulation code.</p>
<p id="index-2">The <tt class="docutils literal"><span class="pre">Customer</span></tt> class definition, lines 6-12, defines our
customer class and has the required generator method (called
<tt class="docutils literal"><span class="pre">visit</span></tt>) (line 9) having a <tt class="docutils literal"><span class="pre">yield</span></tt> statement (line
11)). Such a method is called a Process Execution Method (PEM) in
SimPy.</p>
<p>The customer&#8217;s <tt class="docutils literal"><span class="pre">visit</span></tt> PEM, lines 9-12, models his
activities.  When he arrives (it will turn out to be a &#8216;he&#8217; in this
model), he will print out the simulation time, <tt class="docutils literal"><span class="pre">now()</span></tt>, and his name
(line 10). The function <tt class="docutils literal"><span class="pre">now()</span></tt> can be used at any time in the
simulation to find the current simulation time though it cannot be
changed by the programmer. The customer&#8217;s name will be set when the
customer is created later in the script (line 22).</p>
<p>He then stays in the bank for a fixed simulation time <tt class="docutils literal"><span class="pre">timeInBank</span></tt>
(line 11).  This is achieved by the <tt class="docutils literal"><span class="pre">yield</span>
<span class="pre">hold,self,timeInBank</span></tt> statement.  This is the first of the special
simulation commands that <tt class="docutils literal"><span class="pre">SimPy</span></tt> offers.</p>
<p>After a simulation time of <tt class="docutils literal"><span class="pre">timeInBank</span></tt>, the program&#8217;s execution
returns to the line after the <tt class="docutils literal"><span class="pre">yield</span></tt> statement, line 12. The
customer then prints out the current simulation time and his
name. This completes the declaration of the <tt class="docutils literal"><span class="pre">Customer</span></tt> class.</p>
<p>Line 21 calls <tt class="docutils literal"><span class="pre">initialize()</span></tt> which sets up the simulation
system ready to receive <tt class="docutils literal"><span class="pre">activate</span></tt> calls. In line 22, we create
a customer, <tt class="docutils literal"><span class="pre">c</span></tt>, with name <tt class="docutils literal"><span class="pre">Klaus</span></tt>. All SimPy Processes have a
<tt class="docutils literal"><span class="pre">name</span></tt> attribute. We <tt class="docutils literal"><span class="pre">activate</span></tt> <tt class="docutils literal"><span class="pre">Klaus</span></tt> in line 23
specifying the object (<tt class="docutils literal"><span class="pre">c</span></tt>) to be activated, the call of the action
routine (<tt class="docutils literal"><span class="pre">c.visit(timeInBank</span> <span class="pre">=</span> <span class="pre">10.0)</span></tt>) and that it is to be activated
at time  5 (<tt class="docutils literal"><span class="pre">at</span> <span class="pre">=</span> <span class="pre">5.0</span></tt>). This will activate
<tt class="docutils literal"><span class="pre">Klaus</span></tt> exactly <tt class="docutils literal"><span class="pre">5</span></tt> minutes after the current time, in this case
after the start of the simulation at <tt class="docutils literal"><span class="pre">0.0</span></tt>. The call of an action
routine such as <tt class="docutils literal"><span class="pre">c.visit</span></tt> can specify the values of arguments, here
the <tt class="docutils literal"><span class="pre">timeInBank</span></tt>.</p>
<p>Finally the call of <tt class="docutils literal"><span class="pre">simulate(until=maxTime)</span></tt> in line 24 will
start the simulation. This will run until the simulation time is
<tt class="docutils literal"><span class="pre">maxTime</span></tt> unless stopped beforehand either by the
<tt class="docutils literal"><span class="pre">stopSimulation()</span></tt> command or by running out of events to execute
(as will happen here). <tt class="docutils literal"><span class="pre">maxTime</span></tt> was set to <tt class="docutils literal"><span class="pre">100.0</span></tt> in line
16.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot; bank01: The single non-random Customer &quot;&quot;&quot;</span>           
<span class="kn">from</span> <span class="nn">SimPy.Simulation</span> <span class="kn">import</span> <span class="o">*</span>                           

<span class="c">## Model components -----------------------------        </span>

<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>                                 
    <span class="sd">&quot;&quot;&quot; Customer arrives, looks around and leaves &quot;&quot;&quot;</span>
        
    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeInBank</span><span class="p">):</span>                          
        <span class="k">print</span> <span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s">&quot; Here I am&quot;</span>               
        <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">timeInBank</span>                       
        <span class="k">print</span> <span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s">&quot; I must leave&quot;</span>            

<span class="c">## Experiment data ------------------------------</span>

<span class="n">maxTime</span> <span class="o">=</span> <span class="mf">100.0</span>     <span class="c"># minutes                            </span>
<span class="n">timeInBank</span> <span class="o">=</span> <span class="mf">10.0</span>   <span class="c"># mean, minutes</span>

<span class="c">## Model/Experiment ------------------------------</span>

<span class="n">initialize</span><span class="p">()</span>                                             
<span class="n">c</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Klaus&quot;</span><span class="p">)</span>                               
<span class="n">activate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">timeInBank</span><span class="p">),</span><span class="n">at</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>                   
<span class="n">simulate</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">maxTime</span><span class="p">)</span>                                  
</pre></div>
</td></tr></table></div>
<p>The short trace printed out by the <tt class="docutils literal"><span class="pre">print</span></tt> statements shows the
result. The program finishes at simulation time <tt class="docutils literal"><span class="pre">15.0</span></tt> because there are
no further events to be executed. At the end of the <tt class="docutils literal"><span class="pre">visit</span></tt> routine,
the customer has no more actions and no other objects or customers are
active.</p>
<div class="highlight-python"><pre>5.0 Klaus  Here I am
15.0 Klaus  I must leave
</pre>
</div>
</div>
<div class="section" id="a-customer-arriving-at-random">
<span id="index-3"></span><h3>A Customer arriving at random<a class="headerlink" href="#a-customer-arriving-at-random" title="Permalink to this headline">¶</a></h3>
<p>Now we extend the model to allow our customer to arrive at a random
simulated time though we will keep the time in the bank at 10.0, as
before.</p>
<p>The change occurs in line 3 of the program and in lines 22,
25, and 26. In line 3 we import from the standard
Python <tt class="docutils literal"><span class="pre">random</span></tt> module to give us <tt class="docutils literal"><span class="pre">expovariate</span></tt> to generate the
random time of arrival. We also import the <tt class="docutils literal"><span class="pre">seed</span></tt> function to
initialize the random number stream to allow control of the random
numbers.  In line 22 we provide an initial seed of <tt class="docutils literal"><span class="pre">99999</span></tt>. An
exponential random variate, <tt class="docutils literal"><span class="pre">t</span></tt>, is generated in line 25. Note
that the Python Random module&#8217;s <tt class="docutils literal"><span class="pre">expovariate</span></tt> function uses the rate
(that is, <tt class="docutils literal"><span class="pre">1.0/mean</span></tt>) as the argument. The generated random variate,
<tt class="docutils literal"><span class="pre">t</span></tt>, is used in Line 26 as the <tt class="docutils literal"><span class="pre">at</span></tt> argument to the
<tt class="docutils literal"><span class="pre">activate</span></tt> call.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot; bank05: The single Random Customer &quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">SimPy.Simulation</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">expovariate</span><span class="p">,</span> <span class="n">seed</span>                     

<span class="c">## Model components ------------------------           </span>

<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Customer arrives at a random time,</span>
<span class="sd">        looks around  and then leaves &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeInBank</span><span class="p">):</span>       
        <span class="k">print</span> <span class="n">now</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s">&quot; Here I am&quot;</span>             
        <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">timeInBank</span>
        <span class="k">print</span> <span class="n">now</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s">&quot; I must leave&quot;</span>          

<span class="c">## Experiment data -------------------------</span>

<span class="n">maxTime</span> <span class="o">=</span> <span class="mf">100.0</span>    <span class="c"># minutes                                    </span>
<span class="n">timeInBank</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="c">## Model/Experiment ------------------------------</span>

<span class="n">seed</span><span class="p">(</span><span class="mf">99999</span><span class="p">)</span>                                            
<span class="n">initialize</span><span class="p">()</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Klaus&quot;</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">expovariate</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">5.0</span><span class="p">)</span>                               
<span class="n">activate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">timeInBank</span><span class="p">),</span><span class="n">at</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>                 
<span class="n">simulate</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">maxTime</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The result is shown below. The customer now arrives at time
10.5809. Changing the seed value would change that time.</p>
<div class="highlight-python"><pre>10.5809228279 Klaus  Here I am
20.5809228279 Klaus  I must leave
</pre>
</div>
<p>The display looks pretty untidy. In the next example I will try and
make it tidier.</p>
</div>
</div>
<div class="section" id="more-customers">
<span id="index-4"></span><h2>More Customers<a class="headerlink" href="#more-customers" title="Permalink to this headline">¶</a></h2>
<p>Our simulation does little so far.  To consider a simulation with
several customers we return to the simple deterministic model and add
more <tt class="docutils literal"><span class="pre">Customers</span></tt>.</p>
<p>The program is almost as easy as the first example (<a class="reference internal" href="#a-customer-arriving-at-a-fixed-time">A Customer
arriving at a fixed time</a>). The main change is in lines
22-27 where we create, name, and activate three
customers. We also increase the maximum simulation time to <tt class="docutils literal"><span class="pre">400</span></tt>
(line 16 and referred to in line 29). Observe that we need
only one definition of the <tt class="docutils literal"><span class="pre">Customer</span></tt> class and create several
objects of that class. These will act quite independently in this
model.</p>
<p>Each customer stays for a different <tt class="docutils literal"><span class="pre">timeinbank</span></tt> so, instead of
setting a common value for this we set it for each customer. The
customers are started at different times (using <tt class="docutils literal"><span class="pre">at=</span></tt>). <tt class="docutils literal"><span class="pre">Tony's</span></tt>
activation time occurs before <tt class="docutils literal"><span class="pre">Klaus's</span></tt>, so <tt class="docutils literal"><span class="pre">Tony</span></tt> will arrive
first even though his activation statement appears later in the
script.</p>
<p>As promised, the print statements have been changed to use Python
string formatting (lines 10 and 12). The statements look
complicated but the output is much nicer.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot; bank02: More Customers &quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">SimPy.Simulation</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c">## Model components ------------------------             </span>

<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Customer arrives, looks around and leaves &quot;&quot;&quot;</span>
        
    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeInBank</span><span class="o">=</span><span class="mf">0</span><span class="p">):</span>       
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Here I am&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>   
        <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">timeInBank</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: I must leave&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> 

<span class="c">## Experiment data -------------------------</span>

<span class="n">maxTime</span> <span class="o">=</span> <span class="mf">400.0</span>  <span class="c"># minutes                             </span>

<span class="c">## Model/Experiment ------------------------------</span>

<span class="n">initialize</span><span class="p">()</span>

<span class="n">c1</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Klaus&quot;</span><span class="p">)</span>                              
<span class="n">activate</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c1</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">timeInBank</span><span class="o">=</span><span class="mf">10.0</span><span class="p">),</span><span class="n">at</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Tony&quot;</span><span class="p">)</span>
<span class="n">activate</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span><span class="n">c2</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">timeInBank</span><span class="o">=</span><span class="mf">7.0</span><span class="p">),</span><span class="n">at</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">c3</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Evelyn&quot;</span><span class="p">)</span>
<span class="n">activate</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span><span class="n">c3</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">timeInBank</span><span class="o">=</span><span class="mf">20.0</span><span class="p">),</span><span class="n">at</span><span class="o">=</span><span class="mf">12.0</span><span class="p">)</span>         

<span class="n">simulate</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">maxTime</span><span class="p">)</span>                                
</pre></div>
</td></tr></table></div>
<p>The trace produced by the program is shown below.  Again the
simulation finishes before the <tt class="docutils literal"><span class="pre">400.0</span></tt> specified in the <tt class="docutils literal"><span class="pre">simulate</span></tt>
call.</p>
<div class="highlight-python"><pre> 2.0000 Tony: Here I am
 5.0000 Klaus: Here I am
 9.0000 Tony: I must leave
12.0000 Evelyn: Here I am
15.0000 Klaus: I must leave
32.0000 Evelyn: I must leave
</pre>
</div>
<div class="section" id="many-customers">
<span id="index-5"></span><h3>Many Customers<a class="headerlink" href="#many-customers" title="Permalink to this headline">¶</a></h3>
<p>Another change will allow us to have more customers. As it is
tedious to give a specially chosen name to each one, we will
call them <tt class="docutils literal"><span class="pre">Customer00,</span> <span class="pre">Customer01,...</span></tt> and use a separate
<tt class="docutils literal"><span class="pre">Source</span></tt> class to create and activate them. To make things clearer
we do not use the random numbers in this model.</p>
<p id="index-6">The following listing shows the new program. Lines 6-13
define a <tt class="docutils literal"><span class="pre">Source</span></tt> class. Its PEM, here called <tt class="docutils literal"><span class="pre">generate</span></tt>, is
defined in lines 9-13.  This PEM has a couple of arguments:
the <tt class="docutils literal"><span class="pre">number</span></tt> of customers to be generated and the Time Between
Arrivals, <tt class="docutils literal"><span class="pre">TBA</span></tt>. It consists of a loop that creates a sequence
of numbered <tt class="docutils literal"><span class="pre">Customers</span></tt> from <tt class="docutils literal"><span class="pre">0</span></tt> to <tt class="docutils literal"><span class="pre">(number-1)</span></tt>, inclusive. We
create a customer and give it a name in line 11. It is
then activated at the current simulation time (the final argument of
the <tt class="docutils literal"><span class="pre">activate</span></tt> statement is missing so that the default value of
<tt class="docutils literal"><span class="pre">now()</span></tt> is used as the time). We also specify how long the customer
is to stay in the bank. To keep it simple, all customers stay
exactly <tt class="docutils literal"><span class="pre">12</span></tt> minutes.  After each new customer is activated, the
<tt class="docutils literal"><span class="pre">Source</span></tt> holds for a fixed time (<tt class="docutils literal"><span class="pre">yield</span> <span class="pre">hold,self,TBA</span></tt>)
before creating the next one (line 13).</p>
<p>A <tt class="docutils literal"><span class="pre">Source</span></tt>, <tt class="docutils literal"><span class="pre">s</span></tt>, is created in line 32 and activated at line
33 where the number of customers to be generated is set to
<tt class="docutils literal"><span class="pre">maxNumber</span> <span class="pre">=</span> <span class="pre">5</span></tt> and the interval between customers to <tt class="docutils literal"><span class="pre">ARRint</span> <span class="pre">=</span>
<span class="pre">10.0</span></tt>. Once started at time <tt class="docutils literal"><span class="pre">0.0</span></tt> it creates customers at intervals
and each customer then operates independently of the others:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot; bank03: Many non-random Customers &quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">SimPy.Simulation</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c">## Model components ------------------------</span>

<span class="k">class</span> <span class="nc">Source</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>                              
    <span class="sd">&quot;&quot;&quot; Source generates customers regularly &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">TBA</span><span class="p">):</span>                  
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Customer</span><span class="si">%02d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
            <span class="n">activate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">timeInBank</span><span class="o">=</span><span class="mf">12.0</span><span class="p">))</span>
            <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">TBA</span>                     

<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Customer arrives, looks around and leaves &quot;&quot;&quot;</span>
        
    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeInBank</span><span class="p">):</span>       
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Here I am&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">timeInBank</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: I must leave&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c">## Experiment data -------------------------</span>

<span class="n">maxNumber</span> <span class="o">=</span> <span class="mf">5</span>
<span class="n">maxTime</span> <span class="o">=</span> <span class="mf">400.0</span> <span class="c"># minutes                                    </span>
<span class="n">ARRint</span> <span class="o">=</span> <span class="mf">10.0</span>   <span class="c"># time between arrivals, minutes </span>

<span class="c">## Model/Experiment ------------------------------</span>

<span class="n">initialize</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">Source</span><span class="p">()</span>                                             
<span class="n">activate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">maxNumber</span><span class="p">,</span>                   
                      <span class="n">TBA</span><span class="o">=</span><span class="n">ARRint</span><span class="p">),</span><span class="n">at</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>             
<span class="n">simulate</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">maxTime</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The output is:</p>
<div class="highlight-python"><pre> 0.0000 Customer00: Here I am
10.0000 Customer01: Here I am
12.0000 Customer00: I must leave
20.0000 Customer02: Here I am
22.0000 Customer01: I must leave
30.0000 Customer03: Here I am
32.0000 Customer02: I must leave
40.0000 Customer04: Here I am
42.0000 Customer03: I must leave
52.0000 Customer04: I must leave
</pre>
</div>
</div>
<div class="section" id="many-random-customers">
<h3>Many Random Customers<a class="headerlink" href="#many-random-customers" title="Permalink to this headline">¶</a></h3>
<p id="index-7">We now extend this model to allow arrivals at random. In simulation this
is usually interpreted as meaning that the times between customer
arrivals are distributed as exponential random variates. There is
little change in our program, we use a <tt class="docutils literal"><span class="pre">Source</span></tt> object, as before.</p>
<p>The exponential random variate is generated in line 14 with
<tt class="docutils literal"><span class="pre">meanTBA</span></tt> as the mean Time Between Arrivals and used in line
15. Note that this parameter is not exactly intuitive. As already
mentioned, the Python <tt class="docutils literal"><span class="pre">expovariate</span></tt> method uses the <em>rate</em> of
arrivals as the parameter not the average interval between them. The
exponential delay between two arrivals gives pseudo-random
arrivals. In this model the first customer arrives at time <tt class="docutils literal"><span class="pre">0.0</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">seed</span></tt> method is called to initialize the random number stream
in the <tt class="docutils literal"><span class="pre">model</span></tt> routine (line 33).  It is possible to leave this
call out but if we wish to do serious comparisons of systems, we must
have control over the random variates and therefore control over the
seeds. Then we can run identical models with different seeds or
different models with identical seeds.  We provide the seeds as
control parameters of the run. Here a seed is assigned in line 33
but it is clear it could have been read in or manually entered on an
input form.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot; bank06: Many Random Customers &quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">SimPy.Simulation</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">expovariate</span><span class="p">,</span><span class="n">seed</span>            

<span class="c">## Model components ------------------------</span>

<span class="k">class</span> <span class="nc">Source</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Source generates customers at random &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">meanTBA</span><span class="p">):</span>       
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Customer</span><span class="si">%02d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
            <span class="n">activate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">timeInBank</span><span class="o">=</span><span class="mf">12.0</span><span class="p">))</span> 
            <span class="n">t</span> <span class="o">=</span> <span class="n">expovariate</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">meanTBA</span><span class="p">)</span>      
            <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span>                  

<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Customer arrives, looks round and leaves &quot;&quot;&quot;</span>
        
    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeInBank</span><span class="o">=</span><span class="mf">0</span><span class="p">):</span>       
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Here I am&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">timeInBank</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: I must leave&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c">## Experiment data -------------------------</span>

<span class="n">maxNumber</span> <span class="o">=</span> <span class="mf">5</span>
<span class="n">maxTime</span> <span class="o">=</span> <span class="mf">400.0</span> <span class="c"># minutes                                   </span>
<span class="n">ARRint</span> <span class="o">=</span> <span class="mf">10.0</span>   <span class="c"># mean arrival interval, minutes  </span>

<span class="c">## Model/Experiment ------------------------------</span>

<span class="n">seed</span><span class="p">(</span><span class="mf">99999</span><span class="p">)</span>                                    
<span class="n">initialize</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Source&#39;</span><span class="p">)</span>                      
<span class="n">activate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">maxNumber</span><span class="p">,</span>
                      <span class="n">meanTBA</span><span class="o">=</span><span class="n">ARRint</span><span class="p">),</span><span class="n">at</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>  
<span class="n">simulate</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">maxTime</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>with the following output:</p>
<div class="highlight-python"><pre> 0.0000 Customer00: Here I am
12.0000 Customer00: I must leave
21.1618 Customer01: Here I am
32.8968 Customer02: Here I am
33.1618 Customer01: I must leave
33.3790 Customer03: Here I am
36.3979 Customer04: Here I am
44.8968 Customer02: I must leave
45.3790 Customer03: I must leave
48.3979 Customer04: I must leave
</pre>
</div>
</div>
</div>
<div class="section" id="a-service-counter">
<span id="index-8"></span><h2>A Service counter<a class="headerlink" href="#a-service-counter" title="Permalink to this headline">¶</a></h2>
<p>So far, the model has been more like an art gallery, the customers
entering, looking around, and leaving. Now they are going to require
service from the bank clerk. We extend the model to include a service
counter which will be modelled as an object of SimPy&#8217;s <tt class="docutils literal"><span class="pre">Resource</span></tt>
class with a single resource unit.  The actions of a <tt class="docutils literal"><span class="pre">Resource</span></tt> are
simple: a customer <tt class="docutils literal"><span class="pre">requests</span></tt> a unit of the resource (a clerk). If
one is free he gets service (and removes the unit). If there is no
free clerk the customer joins the queue (managed by the resource
object) until it is their turn to be served. As each customer
completes service and <tt class="docutils literal"><span class="pre">releases</span></tt> the unit, the clerk can start
serving the next in line.</p>
<div class="section" id="one-service-counter">
<span id="index-9"></span><h3>One Service counter<a class="headerlink" href="#one-service-counter" title="Permalink to this headline">¶</a></h3>
<p>The service counter is created as a <tt class="docutils literal"><span class="pre">Resource</span></tt> (<tt class="docutils literal"><span class="pre">k</span></tt>) in line
38. This is provided as an argument to the <tt class="docutils literal"><span class="pre">Source</span></tt> (line
45) which, in turn, provides it to each customer it creates and
activates (line 14).</p>
<p>The actions involving the <tt class="docutils literal"><span class="pre">counter</span></tt> in the customer&#8217;s PEM are:</p>
<ul class="simple">
<li>the <tt class="docutils literal"><span class="pre">yield</span> <span class="pre">request</span></tt> statement in line 25. If the server is
free then the customer can start service immediately and the code
moves on to line  26. If the server is busy, the customer is
automatically queued by the  Resource. When it eventually comes
available the PEM moves on to line 26.</li>
<li>the <tt class="docutils literal"><span class="pre">yield</span> <span class="pre">hold</span></tt> statement in line 28 where the operation of
the service counter is modelled. Here the service time is a fixed
<tt class="docutils literal"><span class="pre">timeInBank</span></tt>.  During this period the customer is being served.</li>
<li>the <tt class="docutils literal"><span class="pre">yield</span> <span class="pre">release</span></tt> statement in line 29. The current
customer completes service and the service counter becomes available
for any remaining customers in the queue.</li>
</ul>
<p>Observe that the service counter is used with the pattern (<tt class="docutils literal"><span class="pre">yield</span>
<span class="pre">request..</span></tt>; <tt class="docutils literal"><span class="pre">yield</span> <span class="pre">hold..</span></tt>; <tt class="docutils literal"><span class="pre">yield</span> <span class="pre">release..</span></tt>).</p>
<p>To show the effect of the service counter on the activities of the
customers, I have added line 22 to record when the customer
arrived and line 26 to record the time between arrival in the
bank and starting service. Line 26 is <em>after</em> the <tt class="docutils literal"><span class="pre">yield</span>
<span class="pre">request</span></tt> command and will be reached only when the request is
satisfied. It is <em>before</em> the <tt class="docutils literal"><span class="pre">yield</span> <span class="pre">hold</span></tt> that corresponds to the
start of service. The variable <tt class="docutils literal"><span class="pre">wait</span></tt> will record how long the
customer waited and will be 0 if he received service at once. This
technique of saving the arrival time in a variable is common. So the
<tt class="docutils literal"><span class="pre">print</span></tt> statement also prints out how long the customer waited in
the bank before starting service.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot; bank07: One Counter,random arrivals &quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">SimPy.Simulation</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">expovariate</span><span class="p">,</span> <span class="n">seed</span>

<span class="c">## Model components ------------------------</span>

<span class="k">class</span> <span class="nc">Source</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Source generates customers randomly &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">meanTBA</span><span class="p">,</span><span class="n">resource</span><span class="p">):</span>     
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Customer</span><span class="si">%02d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
            <span class="n">activate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">timeInBank</span><span class="o">=</span><span class="mf">12.0</span><span class="p">,</span>
                               <span class="n">res</span><span class="o">=</span><span class="n">resource</span><span class="p">))</span>          
            <span class="n">t</span> <span class="o">=</span> <span class="n">expovariate</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">meanTBA</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span>

<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Customer arrives, is served and  leaves &quot;&quot;&quot;</span>
        
    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeInBank</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>       
        <span class="n">arrive</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>       <span class="c"># arrival time        </span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Here I am     &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">request</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">res</span>                       
        <span class="n">wait</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">arrive</span>  <span class="c"># waiting time        </span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Waited </span><span class="si">%6.3f</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">wait</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">timeInBank</span>               
        <span class="k">yield</span> <span class="n">release</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">res</span>                     
        
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Finished      &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c">## Experiment data -------------------------</span>

<span class="n">maxNumber</span> <span class="o">=</span> <span class="mf">5</span>                                      
<span class="n">maxTime</span> <span class="o">=</span> <span class="mf">400.0</span>  <span class="c"># minutes                                </span>
<span class="n">ARRint</span> <span class="o">=</span> <span class="mf">10.0</span>    <span class="c"># mean, minutes</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Resource</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Counter&quot;</span><span class="p">,</span><span class="n">unitName</span><span class="o">=</span><span class="s">&quot;Clerk&quot;</span><span class="p">)</span>     

<span class="c">## Model/Experiment ------------------------------</span>
<span class="n">seed</span><span class="p">(</span><span class="mf">99999</span><span class="p">)</span>
<span class="n">initialize</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="s">&#39;Source&#39;</span><span class="p">)</span>
<span class="n">activate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">maxNumber</span><span class="p">,</span>            
                      <span class="n">meanTBA</span><span class="o">=</span><span class="n">ARRint</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="n">k</span><span class="p">),</span><span class="n">at</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>        
<span class="n">simulate</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">maxTime</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Examining the trace we see that the first two customers get instant service but the others
have to wait. We still only have five customers (line 35) so we
cannot draw general conclusions.</p>
<div class="highlight-python"><pre>   0.000 Customer00: Here I am     
   0.000 Customer00: Waited  0.000
  12.000 Customer00: Finished      
  21.162 Customer01: Here I am     
  21.162 Customer01: Waited  0.000
  32.897 Customer02: Here I am     
  33.162 Customer01: Finished      
  33.162 Customer02: Waited  0.265
  33.379 Customer03: Here I am     
  36.398 Customer04: Here I am     
  45.162 Customer02: Finished      
  45.162 Customer03: Waited 11.783
  57.162 Customer03: Finished      
  57.162 Customer04: Waited 20.764
  69.162 Customer04: Finished      
</pre>
</div>
<span class="target" id="index-10"></span></div>
<div class="section" id="a-server-with-a-random-service-time">
<h3>A server with a random service time<a class="headerlink" href="#a-server-with-a-random-service-time" title="Permalink to this headline">¶</a></h3>
<p>This is a simple change to the model in that we retain the single
service counter but make the customer service time a random variable. As
is traditional in the study of simple queues we first assume an exponential service
time and set the mean to <tt class="docutils literal"><span class="pre">timeInBank</span></tt>.</p>
<p>The service time random variable, <tt class="docutils literal"><span class="pre">tib</span></tt>, is generated in line
26 and used in line 27. The argument to be used in the call
of <tt class="docutils literal"><span class="pre">expovariate</span></tt> is not the mean of the distribution,
<tt class="docutils literal"><span class="pre">timeInBank</span></tt>, but is the rate <tt class="docutils literal"><span class="pre">1/timeInBank</span></tt>.</p>
<p>We have also collected together a number of constants by defining a
number of appropriate variables and giving them values. These are in
lines 31 to 42.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot; bank08: A counter with a random service time &quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">SimPy.Simulation</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">expovariate</span><span class="p">,</span> <span class="n">seed</span>

<span class="c">## Model components ------------------------           </span>

<span class="k">class</span> <span class="nc">Source</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Source generates customers randomly &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">meanTBA</span><span class="p">,</span><span class="n">resource</span><span class="p">):</span>         
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Customer</span><span class="si">%02d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
            <span class="n">activate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">resource</span><span class="p">))</span>              
            <span class="n">t</span> <span class="o">=</span> <span class="n">expovariate</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">meanTBA</span><span class="p">)</span>               
            <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span>

<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Customer arrives, is served and leaves &quot;&quot;&quot;</span>
        
    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>                                
        <span class="n">arrive</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%8.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Here I am     &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">request</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span>                          
        <span class="n">wait</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">arrive</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%8.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Waited </span><span class="si">%6.3f</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">wait</span><span class="p">)</span>
        <span class="n">tib</span> <span class="o">=</span> <span class="n">expovariate</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">timeInBank</span><span class="p">)</span>            
        <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">tib</span>                          
        <span class="k">yield</span> <span class="n">release</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span>                         
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%8.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Finished      &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c">## Experiment data -------------------------         </span>

<span class="n">maxNumber</span> <span class="o">=</span> <span class="mf">5</span>
<span class="n">maxTime</span> <span class="o">=</span> <span class="mf">400.0</span> <span class="c"># minutes                                     </span>
<span class="n">timeInBank</span><span class="o">=</span><span class="mf">12.0</span> <span class="c"># mean, minutes                      </span>
<span class="n">ARRint</span> <span class="o">=</span> <span class="mf">10.0</span>   <span class="c"># mean, minutes                      </span>
<span class="n">theseed</span><span class="o">=</span> <span class="mf">12345</span>                                       

<span class="c">## Model/Experiment ------------------------------</span>

<span class="n">seed</span><span class="p">(</span><span class="n">theseed</span><span class="p">)</span>                                        
<span class="n">k</span> <span class="o">=</span> <span class="n">Resource</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Counter&quot;</span><span class="p">,</span><span class="n">unitName</span><span class="o">=</span><span class="s">&quot;Clerk&quot;</span><span class="p">)</span>       

<span class="n">initialize</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="s">&#39;Source&#39;</span><span class="p">)</span>
<span class="n">activate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">maxNumber</span><span class="p">,</span><span class="n">meanTBA</span><span class="o">=</span><span class="n">ARRint</span><span class="p">,</span> 
                      <span class="n">resource</span><span class="o">=</span><span class="n">k</span><span class="p">),</span><span class="n">at</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>           
<span class="n">simulate</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">maxTime</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>And the output:</p>
<div class="highlight-python"><pre>  0.0000 Customer00: Here I am     
  0.0000 Customer00: Waited  0.000
  8.7558 Customer01: Here I am     
 10.6770 Customer02: Here I am     
 22.7622 Customer03: Here I am     
 32.7477 Customer04: Here I am     
 55.0607 Customer00: Finished      
 55.0607 Customer01: Waited 46.305
 61.8905 Customer01: Finished      
 61.8905 Customer02: Waited 51.213
 83.7556 Customer02: Finished      
 83.7556 Customer03: Waited 60.993
108.7794 Customer03: Finished      
108.7794 Customer04: Waited 76.032
118.8254 Customer04: Finished      
</pre>
</div>
<p>This model with random arrivals and exponential service times is an
example of an M/M/1 queue and could rather easily be solved
analytically to calculate the steady-state mean waiting time and other
operating characteristics. (But not so easily solved for its transient
behavior.)</p>
</div>
</div>
<div class="section" id="several-service-counters">
<h2>Several Service Counters<a class="headerlink" href="#several-service-counters" title="Permalink to this headline">¶</a></h2>
<p>When we introduce several counters we must decide on a queue
discipline. Are customers going to make one queue or are they going to
form separate queues in front of each counter? Then there are
complications - will they be allowed to switch lines (jockey)? We
first consider a single queue with several counters and later consider
separate isolated queues. We will not look at jockeying.</p>
<div class="section" id="several-counters-but-a-single-queue">
<span id="index-11"></span><h3>Several Counters but a Single Queue<a class="headerlink" href="#several-counters-but-a-single-queue" title="Permalink to this headline">¶</a></h3>
<p>Here we model a bank whos customers arrive randomly and are to be
served at a group of counters, taking a random time for service, where
we assume that waiting customers form a single first-in first-out
queue.</p>
<p>The <em>only</em> difference between this model and the single-server model
is in line 42. We have provided two counters by increasing the
capacity of the <tt class="docutils literal"><span class="pre">counter</span></tt> resource to 2. These <em>units</em> of the
resource correspond to the two counters. Because both clerks cannot be
called <tt class="docutils literal"><span class="pre">Karen</span></tt>, we have used a general name of <tt class="docutils literal"><span class="pre">Clerk</span></tt>.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot; bank09: Several Counters but a Single Queue &quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">SimPy.Simulation</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">expovariate</span><span class="p">,</span> <span class="n">seed</span>

<span class="c">## Model components ------------------------           </span>

<span class="k">class</span> <span class="nc">Source</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Source generates customers randomly &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">meanTBA</span><span class="p">,</span><span class="n">resource</span><span class="p">):</span>      
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Customer</span><span class="si">%02d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
            <span class="n">activate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">resource</span><span class="p">))</span>            
            <span class="n">t</span> <span class="o">=</span> <span class="n">expovariate</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">meanTBA</span><span class="p">)</span>              
            <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span>

<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Customer arrives, is served and leaves &quot;&quot;&quot;</span>
        
    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>                                
        <span class="n">arrive</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%8.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Here I am     &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">request</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span>                          
        <span class="n">wait</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">arrive</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%8.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Waited </span><span class="si">%6.3f</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">wait</span><span class="p">)</span>
        <span class="n">tib</span> <span class="o">=</span> <span class="n">expovariate</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">timeInBank</span><span class="p">)</span>            
        <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">tib</span>                          
        <span class="k">yield</span> <span class="n">release</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span>                         
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%8.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Finished      &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c">## Experiment data -------------------------         </span>

<span class="n">maxNumber</span> <span class="o">=</span> <span class="mf">5</span>
<span class="n">maxTime</span> <span class="o">=</span> <span class="mf">400.0</span> <span class="c"># minutes                                      </span>
<span class="n">timeInBank</span> <span class="o">=</span> <span class="mf">12.0</span> <span class="c"># mean, minutes                      </span>
<span class="n">ARRint</span> <span class="o">=</span> <span class="mf">10.0</span>   <span class="c"># mean, minutes                      </span>
<span class="n">theseed</span> <span class="o">=</span> <span class="mf">12345</span>                                        

<span class="c">## Model/Experiment ------------------------------</span>

<span class="n">seed</span><span class="p">(</span><span class="n">theseed</span><span class="p">)</span>                                        
<span class="n">k</span> <span class="o">=</span> <span class="n">Resource</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="mf">2</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Counter&quot;</span><span class="p">,</span><span class="n">unitName</span><span class="o">=</span><span class="s">&quot;Clerk&quot;</span><span class="p">)</span>  

<span class="n">initialize</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="s">&#39;Source&#39;</span><span class="p">)</span>
<span class="n">activate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">maxNumber</span><span class="p">,</span><span class="n">meanTBA</span><span class="o">=</span><span class="n">ARRint</span><span class="p">,</span> 
                         <span class="n">resource</span><span class="o">=</span><span class="n">k</span><span class="p">),</span><span class="n">at</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>           
<span class="n">simulate</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">maxTime</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The waiting times in this model are much shorter than those for the
single service counter. For example, the waiting time for
<tt class="docutils literal"><span class="pre">Customer02</span></tt> has been reduced from <tt class="docutils literal"><span class="pre">51.213</span></tt> to <tt class="docutils literal"><span class="pre">12.581</span></tt>
minutes. Again we have too few customers processed to draw general
conclusions.</p>
<div class="highlight-python"><pre>  0.0000 Customer00: Here I am     
  0.0000 Customer00: Waited  0.000
  8.7558 Customer01: Here I am     
  8.7558 Customer01: Waited  0.000
 10.6770 Customer02: Here I am     
 20.6626 Customer03: Here I am     
 23.2580 Customer01: Finished      
 23.2580 Customer02: Waited 12.581
 30.0878 Customer02: Finished      
 30.0878 Customer03: Waited  9.425
 37.0790 Customer04: Here I am     
 51.9528 Customer03: Finished      
 51.9528 Customer04: Waited 14.874
 55.0607 Customer00: Finished      
 61.9988 Customer04: Finished      
</pre>
</div>
</div>
<div class="section" id="several-counters-with-individual-queues">
<span id="index-12"></span><h3>Several Counters with individual queues<a class="headerlink" href="#several-counters-with-individual-queues" title="Permalink to this headline">¶</a></h3>
<p>Each counter is now assumed to have its own queue.  The programming is
more complicated because the customer has to decide which queue to
join. The obvious technique is to make each counter a separate
resource and it is useful to make a list of resource objects (line
56).</p>
<p>In practice, a customer will join the shortest queue.  So we define
the Python function, <tt class="docutils literal"><span class="pre">NoInSystem(R)</span></tt> (lines 17-19) which
returns the sum of the number waiting and the number being served for
a particular counter, <tt class="docutils literal"><span class="pre">R</span></tt>. This function is used in line 28 to
list the numbers at each counter. It is then easy to find which
counter the arriving customer should join. We have also modified the
trace printout, line 29 to display the state of the system when
the customer arrives. We choose the shortest queue in lines
30-32 (the variable <tt class="docutils literal"><span class="pre">choice</span></tt>).</p>
<p>The rest of the program is the same as before.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot; bank10: Several Counters with individual queues&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">SimPy.Simulation</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">expovariate</span><span class="p">,</span><span class="n">seed</span>

<span class="c">## Model components ------------------------</span>

<span class="k">class</span> <span class="nc">Source</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Source generates customers randomly&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">interval</span><span class="p">,</span><span class="n">counters</span><span class="p">):</span>                   
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Customer</span><span class="si">%02d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
            <span class="n">activate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">counters</span><span class="p">))</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">expovariate</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">interval</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span>

<span class="k">def</span> <span class="nf">NoInSystem</span><span class="p">(</span><span class="n">R</span><span class="p">):</span>                                                  
    <span class="sd">&quot;&quot;&quot; Total number of customers in the resource R&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">waitQ</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">activeQ</span><span class="p">))</span>                            

<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Customer arrives, chooses the shortest queue</span>
<span class="sd">        is served and leaves</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">counters</span><span class="p">):</span>       
        <span class="n">arrive</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>
        <span class="n">Qlength</span> <span class="o">=</span> <span class="p">[</span><span class="n">NoInSystem</span><span class="p">(</span><span class="n">counters</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nc</span><span class="p">)]</span>      
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Here I am. </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">Qlength</span><span class="p">)</span>   
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nc</span><span class="p">):</span>                                         
            <span class="k">if</span> <span class="n">Qlength</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0</span> <span class="ow">or</span> <span class="n">Qlength</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">Qlength</span><span class="p">):</span>
                <span class="n">choice</span> <span class="o">=</span> <span class="n">i</span>  <span class="c"># the chosen queue number                </span>
                <span class="k">break</span>
                
        <span class="k">yield</span> <span class="n">request</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">counters</span><span class="p">[</span><span class="n">choice</span><span class="p">]</span>
        <span class="n">wait</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">arrive</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Waited </span><span class="si">%6.3f</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">wait</span><span class="p">)</span>
        <span class="n">tib</span> <span class="o">=</span> <span class="n">expovariate</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">timeInBank</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">tib</span>
        <span class="k">yield</span> <span class="n">release</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">counters</span><span class="p">[</span><span class="n">choice</span><span class="p">]</span>

        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%7.4f</span><span class="s"> </span><span class="si">%s</span><span class="s">: Finished&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c">## Experiment data -------------------------</span>

<span class="n">maxNumber</span> <span class="o">=</span> <span class="mf">5</span>
<span class="n">maxTime</span> <span class="o">=</span> <span class="mf">400.0</span> <span class="c"># minutes                                     </span>
<span class="n">timeInBank</span> <span class="o">=</span> <span class="mf">12.0</span> <span class="c"># mean, minutes                          </span>
<span class="n">ARRint</span> <span class="o">=</span> <span class="mf">10.0</span>   <span class="c"># mean, minutes                          </span>
<span class="n">Nc</span> <span class="o">=</span> <span class="mf">2</span>          <span class="c"># number of counters</span>
<span class="n">theseed</span> <span class="o">=</span> <span class="mf">12345</span>                                           
                                    
<span class="c">## Model/Experiment ------------------------------</span>

<span class="n">seed</span><span class="p">(</span><span class="n">theseed</span><span class="p">)</span>
<span class="n">kk</span> <span class="o">=</span> <span class="p">[</span><span class="n">Resource</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Clerk0&quot;</span><span class="p">),</span><span class="n">Resource</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Clerk1&quot;</span><span class="p">)]</span>   
<span class="n">initialize</span><span class="p">()</span>    
<span class="n">s</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="s">&#39;Source&#39;</span><span class="p">)</span>
<span class="n">activate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">maxNumber</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="n">ARRint</span><span class="p">,</span>
                      <span class="n">counters</span><span class="o">=</span><span class="n">kk</span><span class="p">),</span><span class="n">at</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">simulate</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">maxTime</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The results show how the customers choose the counter with the
smallest number. Unlucky <tt class="docutils literal"><span class="pre">Customer02</span></tt> who joins the wrong queue has
to wait until <tt class="docutils literal"><span class="pre">Customer00</span></tt> finishes at time <tt class="docutils literal"><span class="pre">55.067</span></tt>. There are,
however, too few arrivals in these runs, limited as they are to five
customers, to draw any general conclusions about the relative
efficiencies of the two systems.</p>
<div class="highlight-python"><pre> 0.0000 Customer00: Here I am. [0, 0]
 0.0000 Customer00: Waited  0.000
 8.7558 Customer01: Here I am. [1, 0]
 8.7558 Customer01: Waited  0.000
10.6770 Customer02: Here I am. [1, 1]
20.6626 Customer03: Here I am. [2, 1]
23.2580 Customer01: Finished
23.2580 Customer03: Waited  2.595
30.0878 Customer03: Finished
37.0790 Customer04: Here I am. [2, 0]
37.0790 Customer04: Waited  0.000
55.0607 Customer00: Finished
55.0607 Customer02: Waited 44.384
62.1029 Customer04: Finished
65.1067 Customer02: Finished
</pre>
</div>
</div>
</div>
<div class="section" id="monitors-and-gathering-statistics">
<span id="index-13"></span><h2>Monitors and Gathering Statistics<a class="headerlink" href="#monitors-and-gathering-statistics" title="Permalink to this headline">¶</a></h2>
<p>The traces of output that have been displayed so far are valuable for
checking that the simulation is operating correctly but would become
too much if we simulate a whole day. We do need to get results from
our simulation to answer the original questions. What, then, is the
best way to summarize the results?</p>
<p>One way is to analyze the traces elsewhere, piping the trace output,
or a modified version of it, into a <em>real</em> statistical program such as
<em>R</em> for statistical analysis, or into a file for later examination by
a spreadsheet. We do not have space to examine this thoroughly here.
Another way of presenting the results is to provide graphical
output.</p>
<p>SimPy offers an easy way to gather a few simple statistics such as
averages: the <tt class="docutils literal"><span class="pre">Monitor</span></tt> and <tt class="docutils literal"><span class="pre">Tally</span></tt> classes. The <tt class="docutils literal"><span class="pre">Monitor</span></tt>
records the values of chosen variables as time series.
(but see the comments in <a class="reference internal" href="#final-remarks">Final Remarks</a>).</p>
<div class="section" id="the-bank-with-a-monitor">
<span id="index-14"></span><h3>The Bank with a Monitor<a class="headerlink" href="#the-bank-with-a-monitor" title="Permalink to this headline">¶</a></h3>
<p>We now demonstrate a <tt class="docutils literal"><span class="pre">Monitor</span></tt> that records the average waiting
times for our customers. We return to the system with random arrivals,
random service times and a single queue and remove the old trace
statements.  In practice, we would make the printouts controlled by a
variable, say, <tt class="docutils literal"><span class="pre">TRACE</span></tt> which is set in the experimental data (or
read in as a program option - but that is a different story). This
would aid in debugging and would not complicate the data analysis. We
will run the simulations for many more arrivals.</p>
<p>A Monitor, <tt class="docutils literal"><span class="pre">wM</span></tt>, is created in line 42. It <tt class="docutils literal"><span class="pre">observes</span></tt> the
waiting time mentioned in line 24.  We run
<tt class="docutils literal"><span class="pre">maxNumber=50</span></tt> customers (in the call of <tt class="docutils literal"><span class="pre">generate</span></tt> in line
45) and have increased <tt class="docutils literal"><span class="pre">maxTime</span></tt> to <tt class="docutils literal"><span class="pre">1000</span></tt> minutes.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot; bank11: The bank with a Monitor&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">SimPy.Simulation</span> <span class="kn">import</span> <span class="o">*</span>                          
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">expovariate</span><span class="p">,</span><span class="n">seed</span>

<span class="c">## Model components ------------------------</span>

<span class="k">class</span> <span class="nc">Source</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Source generates customers randomly&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">interval</span><span class="p">,</span><span class="n">resource</span><span class="p">):</span>       
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Customer</span><span class="si">%02d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
            <span class="n">activate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">resource</span><span class="p">))</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">expovariate</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">interval</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span>

<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Customer arrives, is served and leaves &quot;&quot;&quot;</span>
        
    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>       
        <span class="n">arrive</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>
        <span class="k">yield</span> <span class="n">request</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span>
        <span class="n">wait</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">arrive</span>                       
        <span class="n">wM</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>                        
        <span class="n">tib</span> <span class="o">=</span> <span class="n">expovariate</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">timeInBank</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">tib</span>
        <span class="k">yield</span> <span class="n">release</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span>

<span class="c">## Experiment data -------------------------</span>

<span class="n">maxNumber</span> <span class="o">=</span> <span class="mf">50</span>
<span class="n">maxTime</span> <span class="o">=</span> <span class="mf">1000.0</span> <span class="c"># minutes                                      </span>
<span class="n">timeInBank</span> <span class="o">=</span> <span class="mf">12.0</span>  <span class="c"># mean, minutes                          </span>
<span class="n">ARRint</span> <span class="o">=</span> <span class="mf">10.0</span>    <span class="c"># mean, minutes                          </span>
<span class="n">Nc</span> <span class="o">=</span> <span class="mf">2</span>           <span class="c"># number of counters</span>
<span class="n">theseed</span> <span class="o">=</span> <span class="mf">12345</span>                                            
                                     
<span class="c">## Model/Experiment   ----------------------</span>

<span class="n">seed</span><span class="p">(</span><span class="n">theseed</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">Resource</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">Nc</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Clerk&quot;</span><span class="p">)</span>                     
<span class="n">wM</span> <span class="o">=</span> <span class="n">Monitor</span><span class="p">()</span>                                             
<span class="n">initialize</span><span class="p">()</span>    
<span class="n">s</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="s">&#39;Source&#39;</span><span class="p">)</span>
<span class="n">activate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">maxNumber</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="n">ARRint</span><span class="p">,</span>   
                      <span class="n">resource</span><span class="o">=</span><span class="n">k</span><span class="p">),</span><span class="n">at</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">simulate</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">maxTime</span><span class="p">)</span>                                    

<span class="c">## Result  ----------------------------------</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">wM</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span><span class="n">wM</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>                             
<span class="k">print</span> <span class="s">&quot;Average wait for </span><span class="si">%3d</span><span class="s"> completions was </span><span class="si">%5.3f</span><span class="s"> minutes.&quot;</span><span class="o">%</span> <span class="n">result</span> 
</pre></div>
</td></tr></table></div>
<p>The average waiting time for 50 customers in this 2-counter system is
more reliable (i.e., less subject to random simulation effects) than
the times we measured before but it is still not sufficiently reliable for
real-world decisions. We should also replicate the runs using different
random number seeds. The result of this run is:</p>
<div class="highlight-python"><pre>Average wait for  50 completions was 2.466 minutes.
</pre>
</div>
</div>
<div class="section" id="multiple-runs">
<span id="index-15"></span><h3>Multiple runs<a class="headerlink" href="#multiple-runs" title="Permalink to this headline">¶</a></h3>
<p>To get a number of independent measurements we must replicate the runs
using different random number seeds. Each replication must be
independent of previous ones so the Monitor and Resources must be
redefined for each run. We can no longer allow them to be global
objects as we have before.</p>
<p>We will define a function, <tt class="docutils literal"><span class="pre">model</span></tt> with a parameter <tt class="docutils literal"><span class="pre">runSeed</span></tt> so
that the random number seed can be different for different runs (lines
40-50). The contents of the function are the same as the
<tt class="docutils literal"><span class="pre">Model/Experiment</span></tt> section in the previous program except for one
vital change.</p>
<p>This is required since the Monitor, <tt class="docutils literal"><span class="pre">wM</span></tt>, is defined inside the
<tt class="docutils literal"><span class="pre">model</span></tt> function (line 43). A customer can no longer refer to
it. In the spirit of quality computer programming we will pass <tt class="docutils literal"><span class="pre">wM</span></tt>
as a function argument. Unfortunately we have to do this in two steps,
first to the <tt class="docutils literal"><span class="pre">Source</span></tt> (line 48) and then from the <tt class="docutils literal"><span class="pre">Source</span></tt> to
the <tt class="docutils literal"><span class="pre">Customer</span></tt> (line 13).</p>
<p><tt class="docutils literal"><span class="pre">model()</span></tt> is run for four different random-number seeds to get a set
of replications (lines 54-57).</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot; bank12: Multiple runs of the bank with a Monitor&quot;&quot;&quot;</span> 
<span class="kn">from</span> <span class="nn">SimPy.Simulation</span> <span class="kn">import</span> <span class="o">*</span> 
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">expovariate</span><span class="p">,</span><span class="n">seed</span>

<span class="c">## Model components ------------------------</span>

<span class="k">class</span> <span class="nc">Source</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Source generates customers randomly&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">interval</span><span class="p">,</span><span class="n">resource</span><span class="p">,</span><span class="n">mon</span><span class="p">):</span>       
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Customer</span><span class="si">%02d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
            <span class="n">activate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span><span class="n">M</span><span class="o">=</span><span class="n">mon</span><span class="p">))</span>          
            <span class="n">t</span> <span class="o">=</span> <span class="n">expovariate</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">interval</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span>

<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Customer arrives, is served and leaves &quot;&quot;&quot;</span>
        
    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">M</span><span class="p">):</span>       
        <span class="n">arrive</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>
        <span class="k">yield</span> <span class="n">request</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span>
        <span class="n">wait</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">arrive</span>
        <span class="n">M</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>                                
        <span class="n">tib</span> <span class="o">=</span> <span class="n">expovariate</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">timeInBank</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">tib</span>
        <span class="k">yield</span> <span class="n">release</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span>
 
<span class="c">## Experiment data -------------------------</span>

<span class="n">maxNumber</span> <span class="o">=</span> <span class="mf">50</span>
<span class="n">maxTime</span> <span class="o">=</span> <span class="mf">2000.0</span>  <span class="c"># minutes                                    </span>
<span class="n">timeInBank</span> <span class="o">=</span> <span class="mf">12.0</span>   <span class="c"># mean, minutes</span>
<span class="n">ARRint</span> <span class="o">=</span> <span class="mf">10.0</span>     <span class="c"># mean, minutes</span>
<span class="n">Nc</span> <span class="o">=</span> <span class="mf">2</span>            <span class="c"># number of counters</span>
<span class="n">theSeed</span> <span class="o">=</span> <span class="mf">393939</span>

<span class="c">## Model  ----------------------------------</span>

<span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="n">runSeed</span><span class="o">=</span><span class="n">theSeed</span><span class="p">):</span>                            
    <span class="n">seed</span><span class="p">(</span><span class="n">runSeed</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">Resource</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">Nc</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Clerk&quot;</span><span class="p">)</span>  
    <span class="n">wM</span> <span class="o">=</span> <span class="n">Monitor</span><span class="p">()</span>                                   

    <span class="n">initialize</span><span class="p">()</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="s">&#39;Source&#39;</span><span class="p">)</span>
    <span class="n">activate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">maxNumber</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="n">ARRint</span><span class="p">,</span> 
                          <span class="n">resource</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="n">mon</span><span class="o">=</span><span class="n">wM</span><span class="p">),</span><span class="n">at</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>         
    <span class="n">simulate</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">maxTime</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">wM</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span><span class="n">wM</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>                     

<span class="c">## Experiment/Result  ----------------------------------</span>

<span class="n">theseeds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">393939</span><span class="p">,</span><span class="mf">31555999</span><span class="p">,</span><span class="mf">777999555</span><span class="p">,</span><span class="mf">319999771</span><span class="p">]</span>         
<span class="k">for</span> <span class="n">Sd</span> <span class="ow">in</span> <span class="n">theseeds</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">Sd</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;Average wait for </span><span class="si">%3d</span><span class="s"> completions was </span><span class="si">%6.2f</span><span class="s"> minutes.&quot;</span><span class="o">%</span> <span class="n">result</span>  
</pre></div>
</td></tr></table></div>
<p>The results show some variation. Remember, though, that the system is still
only operating for 50 customers so the system may not be in
steady-state.</p>
<div class="highlight-python"><pre>Average wait for  50 completions was   2.75 minutes.
Average wait for  50 completions was   6.01 minutes.
Average wait for  50 completions was   5.53 minutes.
Average wait for  50 completions was   3.76 minutes.
</pre>
</div>
</div>
</div>
<div class="section" id="final-remarks">
<span id="index-16"></span><h2>Final Remarks<a class="headerlink" href="#final-remarks" title="Permalink to this headline">¶</a></h2>
<p>This introduction is too long and the examples are getting
longer. There is much more to say about simulation with <em>SimPy</em> but no
space. I finish with a list of topics for further study:</p>
<ul class="simple">
<li><strong>GUI input</strong>. Graphical input of simulation parameters could be an
advantage in some cases. <em>SimPy</em> allows this and programs using
these facilities have been developed (see, for example, program
<tt class="docutils literal"><span class="pre">MM1.py</span></tt> in the examples in the <em>SimPy</em> distribution)</li>
<li><strong>Graphical Output</strong>. Similarly, graphical output of results can
also be of value, not least in debugging simulation programs and
checking for steady-state conditions. SimPlot is useful here.</li>
<li><strong>Statistical Output</strong>. The <tt class="docutils literal"><span class="pre">Monitor</span></tt> class is useful in
presenting results but more powerful methods of analysis are often
needed. One solution is to output a trace and read that into a
large-scale statistical system such as <em>R</em>.</li>
<li><strong>Priorities and Reneging in queues</strong>. <em>SimPy</em> allows processes to
request units of resources under a priority queue discipline
(preemptive or not). It also allows processes to renege from a queue.</li>
<li><strong>Other forms of Resource Facilities</strong>. <em>SimPy</em> has two other
resource structures: <tt class="docutils literal"><span class="pre">Levels</span></tt> to hold bulk commodities, and
<tt class="docutils literal"><span class="pre">Stores</span></tt>   to contain an inventory of different object types.</li>
<li><strong>Advanced synchronization/scheduling commands</strong>. <em>SimPy</em> allows
process synchronization by events and signals.</li>
</ul>
</div>
<div class="section" id="acknowledgements">
<h2>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>I thank Klaus Muller, Bob Helmbold, Mukhlis Matti and other developers
and users of SimPy for improving this document by sending their
comments. I would be grateful for further suggestions or
corrections. Please send them to: <em>vignaux</em> at
<em>users.sourceforge.net</em>.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Python website: <a class="reference external" href="http://www.Python.org">http://www.Python.org</a></li>
<li>SimPy website: <a class="reference external" href="http://sourceforge.net/projects/simpy">http://sourceforge.net/projects/simpy</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/sm_SimPy_Logo.png" alt="Logo"/>
            </a></p>
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">The Bank Tutorial Part 1: Examples of SimPy Simulation</a><ul>
<li><a class="reference external" href="#introduction">Introduction</a></li>
<li><a class="reference external" href="#a-single-customer">A  single Customer</a><ul>
<li><a class="reference external" href="#a-customer-arriving-at-a-fixed-time">A Customer arriving at a fixed time</a></li>
<li><a class="reference external" href="#a-customer-arriving-at-random">A Customer arriving at random</a></li>
</ul>
</li>
<li><a class="reference external" href="#more-customers">More Customers</a><ul>
<li><a class="reference external" href="#many-customers">Many Customers</a></li>
<li><a class="reference external" href="#many-random-customers">Many Random Customers</a></li>
</ul>
</li>
<li><a class="reference external" href="#a-service-counter">A Service counter</a><ul>
<li><a class="reference external" href="#one-service-counter">One Service counter</a></li>
<li><a class="reference external" href="#a-server-with-a-random-service-time">A server with a random service time</a></li>
</ul>
</li>
<li><a class="reference external" href="#several-service-counters">Several Service Counters</a><ul>
<li><a class="reference external" href="#several-counters-but-a-single-queue">Several Counters but a Single Queue</a></li>
<li><a class="reference external" href="#several-counters-with-individual-queues">Several Counters with individual queues</a></li>
</ul>
</li>
<li><a class="reference external" href="#monitors-and-gathering-statistics">Monitors and Gathering Statistics</a><ul>
<li><a class="reference external" href="#the-bank-with-a-monitor">The Bank with a Monitor</a></li>
<li><a class="reference external" href="#multiple-runs">Multiple runs</a></li>
</ul>
</li>
<li><a class="reference external" href="#final-remarks">Final Remarks</a></li>
<li><a class="reference external" href="#acknowledgements">Acknowledgements</a></li>
<li><a class="reference external" href="#references">References</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="../SimPy_Tutorials.html"
                                  title="previous chapter">SimPy Tutorials</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="TheBank2.html"
                                  title="next chapter">The Bank Tutorial part 2: More  examples of SimPy Simulation</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/Tutorials/TheBank.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="TheBank2.html" title="The Bank Tutorial part 2: More examples of SimPy Simulation"
             >next</a> |</li>
        <li class="right" >
          <a href="../SimPy_Tutorials.html" title="SimPy Tutorials"
             >previous</a> |</li>
        <li><a href="../index.html">SimPy v2.0.1 documentation</a> &raquo;</li>
          <li><a href="../SimPy_Tutorials.html" >SimPy Tutorials</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2008, 2009; Klaus Muller, Tony Vignaux.
      Last updated on Apr 06, 2009.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.1.
    </div>
  </body>
</html>