<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
    <title>Test coverage report: auction.models.bases</title>
    <style type="text/css" media="screen">
      a
      {
        color: #3d707a;
      }
      
      a:hover, a:active
      {
        color: #bf7d18;
      }
    
      body 
      {
        font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
        font-size: 13px;
      }
      
      .nav 
      {
        font-size: 12px;
        margin-left: 50px;
      }

      .ignored
      {
        color: #707070;
      }

      .executed 
      {
        color: #3d9900;
      }

      .missed 
      {
        color: red;
        font-weight: bold;
      }

      .excluded 
      {
        color: #6090f0;
        font-weight: lighter;
      }
    
      #content-header 
      {
        font-size: 12px;
        padding: 18px 0 18px 50px;
      }

      #content-header h1 
      {
        font-size: 16px;
        margin: 10px 0 0 0;
        color: #909090;
      }
      
      #module-name
      {
        color: #583707;
      }
    
      #content-header p
      {
        font-size: 13px;
        margin: 0;
        color: #909090;
      }

      #content-header .normal 
      {
        color: #609030;
      }

      #content-header .warning 
      {
        color: #d0a000;
      }

      #content-header .critical 
      {
        color: red;
      }
      
      #source-listing 
      {
        margin-bottom: 24px;
      }

      #source-listing ol 
      {
        padding: 0 0 0 50px;
        width: 90%;
        font-family: monospace;
        list-style-position: outside;
      }

      #source-listing ol li 
      {
        line-height: 18px;
        font-size: small;
      }
        
      #source-listing ol code 
      {
        padding:  0 .001em 0 0; /* Firefox doesn't render empty li's properly */
        font-size: medium;
        white-space: pre;
      }
   </style>
  </head>

  <body>

<div class="nav">
  <a href="auction.models.auctionmodel.html">auction.models.auctionmodel</a> &lt;&lt;
  <a href="../index.html">index</a>
  &gt;&gt; <a href="auction.models.bidbasket.html">auction.models.bidbasket</a>
</div>

<div id="content-header">
  <h1>
    <span id="module-name">auction.models.bases</span>:
    125 total statements,
    <span class="normal">97.2% covered</span>
  </h1>
  <p>Generated: Mon 2013-04-29 18:13 CST</p>
  <p>Source file: /home/slam/workspace/django-auction/auction/models/bases.py</p>
  <p>
    Stats:
    <span class="executed">105 executed</span>,
    <span class="missed">3 missed</span>,
    <span class="excluded">17 excluded</span>,
    <span class="ignored">67 ignored</span> 
  </p> 
</div>

<div id="source-listing">
  <ol>
    <li class="excluded"><code>from decimal import Decimal</code></li>
<li class="excluded"><code>from django.db import models</code></li>
<li class="excluded"><code>from polymorphic.polymorphic_model import PolymorphicModel</code></li>
<li class="excluded"><code>from django.utils.translation import ugettext_lazy as _</code></li>
<li class="excluded"><code>from django.contrib.auth.models import User</code></li>
<li class="excluded"><code>from django.contrib.contenttypes.models import ContentType</code></li>
<li class="excluded"><code>from django.contrib.contenttypes import generic</code></li>
<li class="excluded"><code>from auction.utils.loader import get_model_string</code></li>
<li class="excluded"><code>from south.modelsinspector import add_introspection_rules</code></li>
<li class="excluded"><code>from django.conf import settings</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>add_introspection_rules([], ["^auction\.models\.bases\.CurrencyField"])</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class CurrencyField(models.DecimalField):</code></li>
<li class="executed"><code>    __metaclass__ = models.SubfieldBase</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def to_python(self, value):</code></li>
<li class="executed"><code>        try:</code></li>
<li class="executed"><code>            return super(CurrencyField, self).to_python(value=value).quantize(Decimal("0.01"))</code></li>
<li class="executed"><code>        except AttributeError:</code></li>
<li class="executed"><code>            return None</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class BaseAuction(PolymorphicModel):</code></li>
<li class="executed"><code>    name = models.CharField(max_length=255, verbose_name=_('Auction name'))</code></li>
<li class="executed"><code>    slug = models.SlugField(unique=True, verbose_name=_('Slug'))</code></li>
<li class="executed"><code>    start_date = models.DateTimeField(verbose_name=_('Start date'))</code></li>
<li class="executed"><code>    end_date = models.DateTimeField(verbose_name=_('End date'))</code></li>
<li class="executed"><code>    active = models.BooleanField(default=False, verbose_name=_('Active'))</code></li>
<li class="executed"><code>    total_bids = models.IntegerField(default=0, verbose_name=_('Total bids'))</code></li>
<li class="executed"><code>    date_added = models.DateTimeField(auto_now_add=True, verbose_name=_('Date added'))</code></li>
<li class="executed"><code>    last_modified = models.DateTimeField(auto_now=True, verbose_name=_('Last modified'))</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        abstract = True</code></li>
<li class="executed"><code>        app_label = 'auction'</code></li>
<li class="executed"><code>        verbose_name = _('Auction')</code></li>
<li class="executed"><code>        verbose_name_plural = _('Auctions')</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>    def __unicode__(self):</code></li>
<li class="excluded"><code>        return self.name</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class BaseBidBasket(models.Model):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    This models functions similarly to a shopping cart, except it expects a logged in user.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="executed"><code>    user = models.OneToOneField(User, related_name="%(app_label)s_%(class)s_related", verbose_name=_('User'))</code></li>
<li class="executed"><code>    date_added = models.DateTimeField(auto_now_add=True, verbose_name=_('Date added'))</code></li>
<li class="executed"><code>    last_modified = models.DateTimeField(auto_now=True, verbose_name=_('Last modified'))</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        abstract = True</code></li>
<li class="executed"><code>        app_label = 'auction'</code></li>
<li class="executed"><code>        verbose_name = _('Bid basket')</code></li>
<li class="executed"><code>        verbose_name_plural = _('Bid baskets')</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def add_bid(self, lot, amount):</code></li>
<li class="excluded"><code>        from auction.models import BidItem</code></li>
<li class="executed"><code>        self.save()</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>        if not lot.is_biddable:</code></li>
<li class="executed"><code>            return False</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>        try:</code></li>
<li class="executed"><code>            amount = Decimal(amount)</code></li>
<li class="missed"><code>        except Exception, e:</code></li>
<li class="missed"><code>            amount = Decimal('0')</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>        from auction.models.lot import Lot</code></li>
<li class="executed"><code>        item,created = BidItem.objects.get_or_create(bid_basket=self,</code></li>
<li class="ignored"><code>                                                     content_type=ContentType.objects.get_for_model(Lot),</code></li>
<li class="ignored"><code>                                                     lot_id=lot.pk)</code></li>
<li class="executed"><code>        if item:</code></li>
<li class="executed"><code>            item.amount=amount</code></li>
<li class="executed"><code>            item.save()</code></li>
<li class="executed"><code>        return item</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def update_bid(self, bid_basket_item_id, amount):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Update amount of bid. Delete bid if amount is 0.</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>        try:</code></li>
<li class="executed"><code>            amount = Decimal(amount)</code></li>
<li class="executed"><code>        except Exception, e:</code></li>
<li class="executed"><code>            amount = Decimal('0')</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>        bid_basket_item = self.bids.get(pk=bid_basket_item_id)</code></li>
<li class="executed"><code>        if not bid_basket_item.is_locked():</code></li>
<li class="executed"><code>            if amount == 0:</code></li>
<li class="executed"><code>                bid_basket_item.delete()</code></li>
<li class="ignored"><code>            else:</code></li>
<li class="executed"><code>                bid_basket_item.amount = amount</code></li>
<li class="executed"><code>                bid_basket_item.save()</code></li>
<li class="executed"><code>            self.save()</code></li>
<li class="executed"><code>        return bid_basket_item</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def delete_bid(self, bid_basket_item_id):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Delete a single item from bid basket.</code></li>
<li class="ignored"><code>        """</code></li>
<li class="executed"><code>        bid_basket_item = self.bids.get(pk=bid_basket_item_id)</code></li>
<li class="executed"><code>        if not bid_basket_item.is_locked():</code></li>
<li class="executed"><code>            bid_basket_item.delete()</code></li>
<li class="executed"><code>        return bid_basket_item</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def empty(self):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Remove all bids from bid basket.</code></li>
<li class="ignored"><code>        """</code></li>
<li class="executed"><code>        if self.pk:</code></li>
<li class="executed"><code>            bids = self.bids.all()</code></li>
<li class="executed"><code>            for bid in bids:</code></li>
<li class="executed"><code>                if not bid.is_locked():</code></li>
<li class="executed"><code>                    bid.delete()</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    @property</code></li>
<li class="ignored"><code>    def bids(self):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Used as accessor for abstract related (BaseBidItem.bid_items).</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code>        If you override BaseBidItem and use a label other than "auction"</code></li>
<li class="ignored"><code>        you will also need to set AUCTION_BIDBASKET_BIDS_RELATED_NAME.</code></li>
<li class="ignored"><code>        Example: foo_biditem_related</code></li>
<li class="ignored"><code>                 (where your label is "foo" and your model is "BidItem")</code></li>
<li class="ignored"><code>        """</code></li>
<li class="executed"><code>        bids = getattr(settings, 'AUCTION_BIDBASKET_BIDS_RELATED_NAME',</code></li>
<li class="ignored"><code>                       'auction_biditem_related')</code></li>
<li class="executed"><code>        return getattr(self, bids)</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    @property</code></li>
<li class="ignored"><code>    def total_bids(self):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        Returns total bids in basket.</code></li>
<li class="ignored"><code>        """</code></li>
<li class="missed"><code>        return len(self.bids.all())</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class BaseAuctionLot(PolymorphicModel):</code></li>
<li class="executed"><code>    name = models.CharField(max_length=255, verbose_name=_('Lot name'))</code></li>
<li class="executed"><code>    slug = models.SlugField(verbose_name=_('Slug'))</code></li>
<li class="executed"><code>    active = models.BooleanField(default=False, verbose_name=_('Active'))</code></li>
<li class="executed"><code>    is_biddable = models.BooleanField(default=False, verbose_name=_('Is biddable?'))</code></li>
<li class="executed"><code>    content_type = models.ForeignKey(ContentType, verbose_name=_('Content type'))</code></li>
<li class="executed"><code>    object_id = models.PositiveIntegerField(verbose_name=_('Object ID'))</code></li>
<li class="executed"><code>    content_object = generic.GenericForeignKey('content_type', 'object_id')</code></li>
<li class="executed"><code>    date_added = models.DateTimeField(auto_now_add=True, verbose_name=_('Date added'))</code></li>
<li class="executed"><code>    last_modified = models.DateTimeField(auto_now=True, verbose_name=_('Last modified'))</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        abstract = True</code></li>
<li class="executed"><code>        app_label = 'auction'</code></li>
<li class="executed"><code>        verbose_name = _('Auction lot')</code></li>
<li class="executed"><code>        verbose_name_plural = _('Auction lots')</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>    def __unicode__(self):</code></li>
<li class="excluded"><code>        return self.name</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    @property</code></li>
<li class="ignored"><code>    def is_locked(self):</code></li>
<li class="ignored"><code>        """</code></li>
<li class="ignored"><code>        This property is meant to be overwritten with your own logic. Bid baskets</code></li>
<li class="ignored"><code>        check this method to find out if a bid can be manipulated.</code></li>
<li class="ignored"><code>        """</code></li>
<li class="excluded"><code>        import auction.utils.generic</code></li>
<li class="executed"><code>        now = auction.utils.generic.get_current_time()</code></li>
<li class="executed"><code>        if self.content_object.end_date &lt;= now:</code></li>
<li class="executed"><code>            return True</code></li>
<li class="executed"><code>        return False</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>class BaseBidItem(models.Model):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    This is a holder for total number of bids and a pointer to</code></li>
<li class="ignored"><code>    item being bid on.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    bid_basket = models.ForeignKey(get_model_string("BidBasket"), related_name="%(app_label)s_%(class)s_related", verbose_name=_('Bid basket'))</code></li>
<li class="executed"><code>    content_type = models.ForeignKey(ContentType, related_name="%(app_label)s_%(class)s_related", verbose_name=_('Content type'))</code></li>
<li class="executed"><code>    lot_id = models.PositiveIntegerField(verbose_name=_('Lot ID'))</code></li>
<li class="executed"><code>    lot_object = generic.GenericForeignKey('content_type', 'lot_id')</code></li>
<li class="executed"><code>    amount = CurrencyField(max_digits=100, decimal_places=2, null=True, blank=True, verbose_name=_('Amount'))</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    class Meta:</code></li>
<li class="executed"><code>        abstract = True</code></li>
<li class="executed"><code>        app_label = 'auction'</code></li>
<li class="executed"><code>        verbose_name = _('Bid item')</code></li>
<li class="executed"><code>        verbose_name_plural = _('Bid items')</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    def is_locked(self):</code></li>
<li class="executed"><code>        return self.lot.is_locked</code></li>
<li class="ignored"><code></code></li>
<li class="executed"><code>    @property</code></li>
<li class="ignored"><code>    def lot(self):</code></li>
<li class="executed"><code>        return self.lot_object</code></li>
  </ol>
</div>

<div class="nav">
  <a href="auction.models.auctionmodel.html">auction.models.auctionmodel</a> &lt;&lt;
  <a href="../index.html">index</a>
  &gt;&gt; <a href="auction.models.bidbasket.html">auction.models.bidbasket</a>
</div>

  </body>
</html>

